<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.baoguoxiao.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录我的工作中碰到的坑">
<meta property="og:type" content="website">
<meta property="og:title" content="魔王卷子">
<meta property="og:url" content="http://www.baoguoxiao.com/page/2/index.html">
<meta property="og:site_name" content="魔王卷子">
<meta property="og:description" content="记录我的工作中碰到的坑">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="魔王卷子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.baoguoxiao.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>魔王卷子</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">魔王卷子</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">魔王卷子</p>
  <div class="site-description" itemprop="description">记录我的工作中碰到的坑</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">111</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/mac-build-web-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/mac-build-web-environment/" class="post-title-link" itemprop="url">mac搭建web环境</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-16 14:06:11" itemprop="dateCreated datePublished" datetime="2018-11-16T14:06:11+08:00">2018-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/mac/" itemprop="url" rel="index"><span itemprop="name">mac</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="homebrew"><a href="#homebrew" class="headerlink" title="homebrew"></a>homebrew</h2><p>在centos上有yum，ubuntu上有apt，而mac则是brew。这个并不是内置的。需要在终端执行命令进行安装。命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>安装之后就可以像是linux一样使用包管理了。包的列表可浏览 <a target="_blank" rel="noopener" href="https://formulae.brew.sh/formula/">https://formulae.brew.sh/formula/</a> 。</p>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p>安装命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure>

<p>启动nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start nginx</span><br></pre></td></tr></table></figure>

<p>重启nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart nginx</span><br></pre></td></tr></table></figure>

<p>停止nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services stop nginx</span><br></pre></td></tr></table></figure>

<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install php</span><br></pre></td></tr></table></figure>

<p>启动php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start php</span><br></pre></td></tr></table></figure>

<p>重启php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart php</span><br></pre></td></tr></table></figure>

<p>停止php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services stop php</span><br></pre></td></tr></table></figure>

<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install mysql</span><br></pre></td></tr></table></figure>

<p>启动命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start mysql</span><br></pre></td></tr></table></figure>

<p>重启命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart mysql</span><br></pre></td></tr></table></figure>

<p>停止命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services stop mysql</span><br></pre></td></tr></table></figure>

<h3 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h3><p>首先启动mysql服务器，然后执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure>

<p>如果出现如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VALIDATE PASSWORD COMPONENT can be used to <span class="built_in">test</span> passwords</span><br><span class="line">and improve security. It checks the strength of password</span><br><span class="line">and allows the <span class="built_in">users</span> to <span class="built_in">set</span> only those passwords <span class="built_in">which</span> are</span><br><span class="line">secure enough. Would you like to setup VALIDATE PASSWORD component?</span><br><span class="line"></span><br><span class="line">Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No: </span><br></pre></td></tr></table></figure>

<p>表示询问你是否需要安装密码验证插件，这里我输入<strong>y</strong>允许安装了。</p>
<p>接下来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">There are three levels of password validation policy:</span><br><span class="line"></span><br><span class="line">LOW    Length &gt;= 8</span><br><span class="line">MEDIUM Length &gt;= 8, numeric, mixed <span class="keyword">case</span>, and special characters</span><br><span class="line">STRONG Length &gt;= 8, numeric, mixed <span class="keyword">case</span>, special characters and dictionary                  file</span><br><span class="line"></span><br><span class="line">Please enter 0 = LOW, 1 = MEDIUM and 2 = STRONG:</span><br></pre></td></tr></table></figure>

<p>这里是要求制定密码强度，我这里选择是0，</p>
<p>接下来就是让我输入两边密码了，</p>
<p>因为我输入的密码比较简单，所以有了如下提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Estimated strength of the password: 50</span><br><span class="line">Do you wish to <span class="built_in">continue</span> with the password provided?(Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) :</span><br></pre></td></tr></table></figure>

<p>提示说这个密码的强度不高，询问是否真的使用这类强度的密码呢？我选择使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Remove anonymous <span class="built_in">users</span>? (Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) :</span><br></pre></td></tr></table></figure>

<p>是否移除匿名用户？肯定要移除啊。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Disallow root login remotely? (Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) :</span><br></pre></td></tr></table></figure>

<p>是否禁用root远程登录呢？肯定要禁用啊。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Remove <span class="built_in">test</span> database and access to it? (Press y|Y <span class="keyword">for</span> Yes, any other key <span class="keyword">for</span> No) :</span><br></pre></td></tr></table></figure>

<p>是否要移除test数据库(这是一个测试数据库)呢？肯定要移除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reload privilege tables now? (Press y|Y for Yes, any other key for No) :</span><br></pre></td></tr></table></figure>

<p>是否要重载权限表。嗯，要重载。</p>
<p>然后设置就完成了。</p>
<p>接下来我们就可以使用如下命令登录mysql了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

<h3 id="登录验证插件"><a href="#登录验证插件" class="headerlink" title="登录验证插件"></a>登录验证插件</h3><p>这里有个小问题，就是mysql的身份验证插件从之前的<code>mysql_native_password</code>更新为<code>caching_sha2_password</code>。</p>
<p>目前的PHP并不支持更新后的插件，所以可以参考我如下的文章使用之前的身份验证插件创建用户密码。</p>
<p>具体可以参考我的这一篇文章《<a href="/upgrade-mysql-to-8-0/" title="数据库升级">数据库升级</a>》.</p>
<h2 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h2><p>安装完成后，其实nginx并不能直接和php进行通信。一般通信的方式有两种，一种是通过监听端口(默认9000)，一种是监听socket。这里我们使用监听端口的方式。</p>
<p>因为php-fpm这边已经默认是监听127.0.0.1:9000端口了，所以这里只需要修改nginx配置即可。</p>
<p>首先打开<code>/usr/local/etc/nginx/nginx.conf</code></p>
<p>修改后的配置文件如下：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># server 部分修改如下</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80; # 修改端口为80</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    charset utf-8; # 设置默认字符集为utf-8</span><br><span class="line"></span><br><span class="line">    #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">    root   html;</span><br><span class="line">    index  index.php index.html index.htm; # 新增index.php</span><br><span class="line"></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name; // 修改`/script`为`$document_root`，该值为root定义的路径</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后打开<code>/usr/local/var/www</code>目录，新增<code>index.php</code>文件，内容如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<p>使用如下命令重启nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services restart nginx</span><br></pre></td></tr></table></figure>

<p>最后访问<code>localhost</code>就可以看到phpinfo正确显示的网页了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://brew.sh/">https://brew.sh/</a></li>
<li><a target="_blank" rel="noopener" href="https://formulae.brew.sh/formula/">https://formulae.brew.sh/formula/</a></li>
<li><a target="_blank" rel="noopener" href="https://mysqlserverteam.com/upgrading-to-mysql-8-0-default-authentication-plugin-considerations/">https://mysqlserverteam.com/upgrading-to-mysql-8-0-default-authentication-plugin-considerations/</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/view-local-ip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/view-local-ip/" class="post-title-link" itemprop="url">查看本机IP</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-15 11:08:12" itemprop="dateCreated datePublished" datetime="2018-11-15T11:08:12+08:00">2018-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/" itemprop="url" rel="index"><span itemprop="name">未分类</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有时候，在登录到云服务器之后，可能需要在终端查询该服务器的ip。</p>
<p>之前我都是用的 ip.cn ，但是感觉不行了。</p>
<p>现在提供一些其他的可选择项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ curl ipinfo.io</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;ip&quot;</span>: <span class="string">&quot;60.205.205.243&quot;</span>,</span><br><span class="line">  <span class="string">&quot;city&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;region&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;country&quot;</span>: <span class="string">&quot;CN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;loc&quot;</span>: <span class="string">&quot;34.7725,113.7270&quot;</span>,</span><br><span class="line">  <span class="string">&quot;org&quot;</span>: <span class="string">&quot;AS37963 Hangzhou Alibaba Advertising Co.,Ltd.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">$ curl cip.cc</span><br><span class="line">IP	: 60.205.205.243</span><br><span class="line">地址	: 中国  北京</span><br><span class="line">运营商	: 阿里云/电信/联通/移动/铁通/教育网</span><br><span class="line"></span><br><span class="line">数据二	: 北京市 | 阿里云BGP服务器</span><br><span class="line"></span><br><span class="line">数据三	: 中国北京北京市 | 阿里云</span><br><span class="line"></span><br><span class="line">URL	: http://www.cip.cc/60.205.205.243</span><br><span class="line">$ curl myip.ipip.net</span><br><span class="line">当前 IP：60.205.205.243  来自于：中国 北京 北京  阿里云/电信/联通/移动/铁通/教育网</span><br><span class="line"><span class="comment"># curl ifconfig.me</span></span><br><span class="line">60.205.205.243</span><br><span class="line">$ curl http://members.3322.org/dyndns/getip</span><br><span class="line">60.205.205.243</span><br></pre></td></tr></table></figure>

<p>相信还有这么多的URL。估计哪一个不行了，都能找到可替代的了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/mac-login-ali-cloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/mac-login-ali-cloud/" class="post-title-link" itemprop="url">mac 登录阿里云</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-15 11:03:51" itemprop="dateCreated datePublished" datetime="2018-11-15T11:03:51+08:00">2018-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/mac/" itemprop="url" rel="index"><span itemprop="name">mac</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在windows环境中，我们都是可以通过xshell实现证书登录的。</p>
<p>但是在mac中却没有相关的设置，那么如何使用mac进行证书登录呢。</p>
<p>首先，我们需要有一个私钥文件。</p>
<p>比如我的是aliyun.pem.</p>
<p>我将其存放在<code>/home/baoguoxiao/aliyun.pem</code>。</p>
<p>登录的命令则是如下这条:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i /home/baoguoxiao/aliyun.pem root@ip</span><br></pre></td></tr></table></figure>

<p>执行该命令的时候可能会提示如下错误:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Permissions 0755 <span class="keyword">for</span> <span class="string">&#x27;/home/baoguoxiao/aliyun.pem&#x27;</span> are too open.</span><br></pre></td></tr></table></figure>

<p>这个表示我们给与这个文件的权限太大了，所以需要对其设置只读权限。</p>
<p>执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 400 /home/baoguoxiao/aliyun.pem</span><br></pre></td></tr></table></figure>

<p>然后再次使用如上的<code>ssh</code>命令，就可以顺利的登录阿里云服务器了。</p>
<p>这样真的好棒。妈妈再也不用担心我的学习。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9270734/ssh-permissions-are-too-open-error">https://stackoverflow.com/questions/9270734/ssh-permissions-are-too-open-error</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/javascript-cover-entities-to-html/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/javascript-cover-entities-to-html/" class="post-title-link" itemprop="url">javascript将html实体转回</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-13 18:11:06" itemprop="dateCreated datePublished" datetime="2018-11-13T18:11:06+08:00">2018-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>有时候我们可能需要向html中传递html代码。但是因为我们的后台框架使用了laravel。所以我们在赋值的时候就会变成:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;$username&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>虽然我们使用自带的非转义的赋值方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;!! $username !!&#125;</span><br></pre></td></tr></table></figure>

<p>但是我的需求却是不能使用后面的这类方法。</p>
<p>通过谷歌，我了解到一种完美的办法，可以将转义后的代码再次转回来。</p>
<p>代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">htmlDecode</span>(<span class="params">input</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    e.<span class="property">innerHTML</span> = input;</span><br><span class="line">    <span class="keyword">return</span> e.<span class="property">childNodes</span>.<span class="property">length</span> === <span class="number">0</span> ? <span class="string">&quot;&quot;</span> : e.<span class="property">childNodes</span>[<span class="number">0</span>].<span class="property">nodeValue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只需要调用该方法就可以完美执行反转义了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">htmlDecode</span>(<span class="string">&quot;&amp;lt;img src=&#x27;myimage.jpg&#x27;&amp;gt;&quot;</span>); </span><br><span class="line"><span class="comment">// returns &quot;&lt;img src=&#x27;myimage.jpg&#x27;&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://css-tricks.com/snippets/javascript/unescape-html-in-js/">https://css-tricks.com/snippets/javascript/unescape-html-in-js/</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sentry-android-sdk-adaptation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sentry-android-sdk-adaptation/" class="post-title-link" itemprop="url">安卓适配</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-13 17:51:58" itemprop="dateCreated datePublished" datetime="2018-11-13T17:51:58+08:00">2018-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天下午一直在跟安卓调试sentry适配问题。发现了两个问题。现在记录如下：</p>
<h2 id="红米一直安装不上APP"><a href="#红米一直安装不上APP" class="headerlink" title="红米一直安装不上APP"></a>红米一直安装不上APP</h2><p>在开发的时候，发现红米一直安装不上APP。经过百度查询，发现是在开发设置中打开了<strong>启用MIUI优化</strong>设置，将其关掉，然后重启，然后接着开启<strong>USB安装</strong>，之前因为一直没网，没有注意这个，导致一些隐性的bug没有展示出来，粗心啊。</p>
<h2 id="安装页面没有DSN信息"><a href="#安装页面没有DSN信息" class="headerlink" title="安装页面没有DSN信息"></a>安装页面没有DSN信息</h2><p>一般在安装页面都会介绍DSN信息，但是安卓病没有提示，顿时不知道这个URL应该去哪找到了，在翻了好久之后，终于找到了位置。</p>
<p>路径为: Project details -&gt; Settings -&gt; Client Keys(DSN)</p>
<p>在这里面就可以拿到相关的DSN信息。</p>
<h2 id="官网提供的SDK不可用"><a href="#官网提供的SDK不可用" class="headerlink" title="官网提供的SDK不可用"></a>官网提供的SDK不可用</h2><p>这个问题就非常坑了。官网提供的SDK根本不可用，最后我们各种谷歌之后，终于发现了问题，原来该SDK已经在2013年就不维护了，必须转而使用raven-java。</p>
<p>现在粘贴相关代码：</p>
<p>Gradle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#x27;com.getsentry.raven:raven-android:8.0.1&#x27; # 实测compile不可用，必须替换为 api</span><br></pre></td></tr></table></figure>

<p>Permissions</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>实例化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.getsentry.raven.android.Raven;</span><br><span class="line"></span><br><span class="line"><span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="built_in">this</span>.getApplicationContext();</span><br><span class="line">Raven.init(ctx, <span class="string">&quot;YOUR-SENTRY-DSN&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>捕获错误</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;[&#x27;a&#x27;]&quot;</span>;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(json); <span class="comment">// 示例错误</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    Sentry.capture(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在测试过程中发现，接收到的错误信息有时候很及时，有时候就非常慢。推测可能是因为APP崩溃退出了，导致错误信息没有及时发出，所以会在下一次APP启动的时候，将相关的错误数据送出， 这样导致sentry接收到错误消息的时间较晚。</p>
<h2 id="参考URL"><a href="#参考URL" class="headerlink" title="参考URL"></a>参考URL</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.rokkincat.com/blog/2017/05/01/sentry-android-deprecation">https://www.rokkincat.com/blog/2017/05/01/sentry-android-deprecation</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.sentry.io/clients/java/modules/android/">https://docs.sentry.io/clients/java/modules/android/</a> 这个是官方地址，但是实际上该SDK不可用。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/install-docker-composer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/install-docker-composer/" class="post-title-link" itemprop="url">docker-compose安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-11 21:49:51" itemprop="dateCreated datePublished" datetime="2018-11-11T21:49:51+08:00">2018-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在安装docker-compose之前必须先检查是否已经安装好了docker。具体安装教程可阅读 <a href="/docker-study-notes-1-install/" title="docker学习笔记之一 安装">docker学习笔记之一 安装</a>。</p>
<p>运行此命令下载最新版本的docker-compose</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.23.1/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>可以看到我们上面下载的版本是1.23.1。这个可能很快就过期了，这个时候可以查看<a target="_blank" rel="noopener" href="https://github.com/docker/compose/releases">Releases</a>页面了解最新发布的版本，然后将最新发布的版本号替换上面命令中已知的版本号进行下载。</p>
<p>接下来我们对其设置执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<p>好了，这样就安装完成了。是不是非常简单。</p>
<p>最后我们检查看版本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose --version</span><br><span class="line">docker-compose version 1.23.1, build b02f1306</span><br></pre></td></tr></table></figure>

<p>end.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/ubuntu-apt-install-lrzsz/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/ubuntu-apt-install-lrzsz/" class="post-title-link" itemprop="url">Linux 终端上传下载文件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-11 21:29:08" itemprop="dateCreated datePublished" datetime="2018-11-11T21:29:08+08:00">2018-11-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Linux 与客户端之间进行文件互传是一个非常常见的功能。办法有很多，很多都是借助第三方功能，但是如果要求不使用第三方工具，那么可选项就很少了。下面介绍两种办法：</p>
<h2 id="lrzsz"><a href="#lrzsz" class="headerlink" title="lrzsz"></a><code>lrzsz</code></h2><p>其实我最钟意这个了。但是这个认终端。需要终端进行适配才可以。</p>
<blockquote>
<p>该命令对文件大小有限制，最大不能超过 4GB。我想一般人碰到这么大的文件，早就去想其他办法了吧。</p>
</blockquote>
<p>使用如下命令安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install lrzsz</span><br></pre></td></tr></table></figure>

<ul>
<li>使用方法：</li>
</ul>
<p>上传文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rz</span><br></pre></td></tr></table></figure>

<p>下载文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sz /path/file</span><br></pre></td></tr></table></figure>

<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a><code>scp</code></h2><p>这个其实就比 <code>lrzsz</code> 比较通用了。但是问题是每次我都得查询一下命令是啥。一般想不起来。</p>
<p>下载文件从远程服务器到本地目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp user@ip:/path/file /path</span><br></pre></td></tr></table></figure>

<p>上传文件从本地目录到远程服务器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp /path/file user@ip:/path </span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/37Y37/p/12020603.html">WebSSH 画龙点睛之 lrzsz 上传下载文件</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1849738">一文详解scp命令</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sentry-note-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sentry-note-1/" class="post-title-link" itemprop="url">sentry笔记整理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-11-07 17:37:21" itemprop="dateCreated datePublished" datetime="2018-11-07T17:37:21+08:00">2018-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/sentry/" itemprop="url" rel="index"><span itemprop="name">sentry</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>开源错误跟踪，帮助开发人员实时监控和修复崩溃。不断重复。提高效率。改善用户体验。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>相同错误合并</li>
<li>定制规则进行邮件通知</li>
<li>支持导入sourcemap自动解析和还原代码</li>
<li>多项目，多用户</li>
<li>友好的Web界面</li>
<li>支持主流的语言接口</li>
<li>权限管理</li>
<li>敏感信息过滤</li>
<li>受影响用户统计</li>
<li>WEB可视化设置，功能强大</li>
<li>…</li>
</ul>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>使用docker-compose命令一键进行部署。减少部署的错误率。</p>
<p>具体部署程序可查看<a target="_blank" rel="noopener" href="https://github.com/getsentry/onpremise">getsentry&#x2F;onpremise</a></p>
<p>使用nginx接受请求并对其进行转发。并使用了<code>ngx_http_realip_module</code>模块转发真实请求IP。</p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>sentry分为客户端和服务端。客户端嵌入到App中，当应用发生异常的情况时，就会向服务器端发送异常通知，服务器端则将信息记录到数据库汇总，并提供web方式，方便对异常进行查看和分析，避免需要登录服务器后台查看生硬的log文件。</p>
<h2 id="收集日志"><a href="#收集日志" class="headerlink" title="收集日志"></a>收集日志</h2><ul>
<li>客户端运行错误日志<ul>
<li>Android</li>
<li>IOS</li>
<li>HTML</li>
</ul>
</li>
<li>服务器端项目运行错误日志<ul>
<li>PHP</li>
</ul>
</li>
<li>Web环境错误日志<ul>
<li>PHP-fPM错误日志</li>
<li>Nginx错误日志</li>
</ul>
</li>
</ul>
<p>目前的日志捕获，都有相应的SDK，非常方便，不同的是客户端因为有代码混淆，所以，需要在sentry中上传相应sourcemap文件。</p>
<p>目前的PHP-FPM和Nginx错误日志没有现成的代码，这里需要一些时间进行编写代码处理相关错误。</p>
<h2 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h2><p>目前sentry有很多的SDK包。目前已经覆盖咱们产品线的有：</p>
<ul>
<li>Android</li>
<li>Swift</li>
<li>Objective-C</li>
<li>JavaScript</li>
<li>PHP</li>
<li>Laravel</li>
<li>…</li>
</ul>
<h2 id="组织架构"><a href="#组织架构" class="headerlink" title="组织架构"></a>组织架构</h2><p><strong>角色</strong></p>
<table>
<thead>
<tr>
<th align="center">行为[Action]</th>
<th align="center">会员[Member]</th>
<th align="center">管理员[Admin]</th>
<th align="center">经理[Manager]</th>
<th align="center">所有者[Owner ]</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Can view and act on issues, such as assigning&#x2F;resolving&#x2F;etc.</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以加入和离开团队[Can join and leave teams]</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以修改项目设置[Can change Project Settings]</td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以添加&#x2F;删除项目[Can add&#x2F;remove projects]</td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以编辑全局集成[Can edit Global Integrations]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以添加&#x2F;删除&#x2F;修改成员[Can add&#x2F;remove&#x2F;change members]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以添加&#x2F;删除团队[Can add&#x2F;remove teams]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以添加仓库[Can add Repositories]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以改变组织设置[Can change Organization Settings]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
<td align="center">✔️</td>
</tr>
<tr>
<td align="center">可以移除一个组织[Can remove an Organization]</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✔️</td>
</tr>
</tbody></table>
<p><em><strong>归属关系</strong></em></p>
<p>一个组织对应多个团队<br>一个团队对应多个项目<br>一个团队对应多个会员<br>一个会员属于多个团队<br>一个项目属于一个团队</p>
<h2 id="邮件通知"><a href="#邮件通知" class="headerlink" title="邮件通知"></a>邮件通知</h2><p>默认情况下，一旦异常发生，5分钟内就会有一封邮件发送到你的邮箱。包含了异常的大致描述。</p>
<p>目前的默认规则是当出现一个新的规则时候，30分钟内发送一次邮件通知。</p>
<p>对于发送邮件的规则可以进行新增&#x2F;编辑&#x2F;移除。</p>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><ul>
<li>不能作为日志的替代品。<br>sentry主要是为让我们专注于系统和程序的异常信息，提高排查效率，日志事件的量达到一个限制值的时候可能还会丢弃一些内容。官方也提倡正确设置sentry接收的日志level的等级时，也能继续旧的日志备份。</li>
<li>不是排查的万能工具<br>sentry是带有问题聚合功能的分析工具，所以如果样本提供的内容不全面。日志记录的质量不高的情况，对于错误的快速排查，可能没有实质性的帮助。</li>
<li>不能作为传统监控的替代品<br>与传统监控系统相比，sentry更依赖发出的日志报告，而另外一些隐藏的逻辑问题或者业务问题可能不会得到反馈的。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sentry-configuring-mail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sentry-configuring-mail/" class="post-title-link" itemprop="url">sentry配置邮件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-30 09:57:20" itemprop="dateCreated datePublished" datetime="2018-10-30T09:57:20+08:00">2018-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/sentry/" itemprop="url" rel="index"><span itemprop="name">sentry</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>sentry一个最大的好处就是可以使用邮件通知功能，如果没有邮件通知，那么我们自己上去看的话就非常麻烦了。</p>
<p>进行邮件推送需要我们提供邮件服务器。这里的话，我就用的是腾讯企业邮箱。</p>
<p>好了，下面说具体配置。</p>
<p>首先接上一篇文章 <a href="/sentry-install/" title="安装sentry">安装sentry</a>，我们将代码拉取到的目录是<code>/data/sentry</code>。</p>
<p>接下来我们就要里面这个文件夹里面的<code>docker-compose.yml</code>文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">x-defaults:</span> <span class="meta">&amp;defaults</span></span><br><span class="line">  <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">  <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">postgres</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">memcached</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">smtp</span></span><br><span class="line">  <span class="attr">env_file:</span> <span class="string">.env</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">SENTRY_MEMCACHED_HOST:</span> <span class="string">memcached</span></span><br><span class="line">    <span class="attr">SENTRY_REDIS_HOST:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">SENTRY_POSTGRES_HOST:</span> <span class="string">postgres</span></span><br><span class="line">    <span class="comment"># 从这里开始</span></span><br><span class="line">    <span class="attr">SENTRY_EMAIL_HOST:</span> <span class="string">smtp.exmail.qq.com</span></span><br><span class="line">    <span class="attr">SENTRY_EMAIL_USER:</span> <span class="string">example@mail.com</span></span><br><span class="line">    <span class="attr">SENTRY_SERVER_EMAIL:</span> <span class="string">example@mail.com</span></span><br><span class="line">    <span class="attr">SENTRY_EMAIL_PASSWORD:</span> <span class="string">password</span></span><br><span class="line">    <span class="attr">SENTRY_EMAIL_USE_TLS:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">SENTRY_EMAIL_PORT:</span> <span class="number">587</span></span><br><span class="line">    <span class="comment"># 这里结束</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">sentry-data:/var/lib/sentry/files</span></span><br></pre></td></tr></table></figure>

<p>这里介绍一下每个配置项的作用：</p>
<table>
<thead>
<tr>
<th align="center">配置项</th>
<th align="center">作用</th>
<th align="center">腾讯企业邮</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SENTRY_EMAIL_HOST</td>
<td align="center">SMTP服务器地址</td>
<td align="center">smtp.exmail.qq.com</td>
</tr>
<tr>
<td align="center">SENTRY_EMAIL_USER</td>
<td align="center">登录的邮箱账号</td>
<td align="center"><a href="mailto:&#101;&#120;&#x61;&#109;&#112;&#x6c;&#x65;&#64;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;">&#101;&#120;&#x61;&#109;&#112;&#x6c;&#x65;&#64;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;</a></td>
</tr>
<tr>
<td align="center">SENTRY_EMAIL_PASSWORD</td>
<td align="center">登录的邮箱密码</td>
<td align="center">password</td>
</tr>
<tr>
<td align="center">SENTRY_EMAIL_PORT</td>
<td align="center">登录的端口</td>
<td align="center">587</td>
</tr>
<tr>
<td align="center">SENTRY_EMAIL_USE_TLS</td>
<td align="center">是否使用ssl连接</td>
<td align="center">true</td>
</tr>
<tr>
<td align="center">SENTRY_SERVER_EMAIL</td>
<td align="center">发送的账户，跟<strong>SENTRY_EMAIL_USER</strong>相同</td>
<td align="center"><a href="mailto:&#x65;&#120;&#x61;&#109;&#x70;&#x6c;&#101;&#x40;&#x6d;&#x61;&#105;&#108;&#46;&#99;&#111;&#x6d;">&#x65;&#120;&#x61;&#109;&#x70;&#x6c;&#101;&#x40;&#x6d;&#x61;&#105;&#108;&#46;&#99;&#111;&#x6d;</a></td>
</tr>
</tbody></table>
<p>配置完成之后，需要重建服务。具体可以执行以下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br><span class="line">docker-composer up -d</span><br></pre></td></tr></table></figure>

<p>然后稍等一分钟就可以正常访问web页面了。</p>
<p>现在来测试一下。</p>
<p>进入页面，在左上角的你的昵称位置单击，选择Admin。</p>
<p>然后在左侧选择<strong>Mail</strong>，然后在最下面有一个测试设置。点击“向<a href="mailto:&#101;&#120;&#97;&#x6d;&#x70;&#x6c;&#x65;&#64;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;">&#101;&#120;&#97;&#x6d;&#x70;&#x6c;&#x65;&#64;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#99;&#111;&#109;</a>发送一封测试邮件”。如果收到的话，那么说明就配置成功了。</p>
<p>在配置问题中，如果有什么问题，可以过来跟我留言。</p>
<p>毕竟这个邮件通知我折腾了一下午才搞定。</p>
<p>哈哈</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sentry-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sentry-install/" class="post-title-link" itemprop="url">安装sentry</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-29 18:34:14" itemprop="dateCreated datePublished" datetime="2018-10-29T18:34:14+08:00">2018-10-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/sentry/" itemprop="url" rel="index"><span itemprop="name">sentry</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近公司内部需要新增一个日志系统。目前可选择的就是sentry和阿里云日志系统。我通过两个对比之后，感觉sentry日志更加好用。所以在这里记录一下相关的笔记。首先这一篇就是安装系列了。</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ul>
<li>docker </li>
<li>docker-compose</li>
<li>git</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>接下来的安装命令就非常简单了。</p>
<p>首先我们先创建目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /data</span><br></pre></td></tr></table></figure>

<p>然后拉取命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/getsentry/onpremise sentry</span><br></pre></td></tr></table></figure>

<p>然后进入目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> sentry</span><br></pre></td></tr></table></figure>

<p>首先我们修改一下映射端口。因为默认绑定端口是9000，因为我这台电脑启动了php-fpm服务绑定了9000端口，所以我这里需要将9000改成10000。具体相关配置如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*defaults</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;10000:9000&#x27;</span> <span class="comment"># 修改位置</span></span><br></pre></td></tr></table></figure>

<p>好了，接下来就是创建volumn。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume create --name=sentry-data &amp;&amp; docker volume create --name=sentry-postgres</span><br></pre></td></tr></table></figure>

<p>生成配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -n  .env.example .<span class="built_in">env</span></span><br></pre></td></tr></table></figure>

<p>创建服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose build</span><br></pre></td></tr></table></figure>

<p>生成秘钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --<span class="built_in">rm</span> web config generate-secret-key</span><br></pre></td></tr></table></figure>

<p>将生成的秘钥添加到<code>.env</code>中的<code>SENTRY_SECRET_KEY</code>项。</p>
<p>构建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose run --<span class="built_in">rm</span> web upgrade</span><br></pre></td></tr></table></figure>

<p>启动所有服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>好了，这样sentry就安装完成了。</p>
<h2 id="Nginx转发"><a href="#Nginx转发" class="headerlink" title="Nginx转发"></a>Nginx转发</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name abc.example.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">          proxy_set_header X-Real-IP  $remote_addr;</span><br><span class="line">          proxy_set_header Host-Real-IP  $http_host;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_set_header X-Real-Pcol http;</span><br><span class="line">          proxy_pass http://localhost:10000;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样我们就可以使用绑定的域名进行访问了。</p>
<h2 id="端口安全"><a href="#端口安全" class="headerlink" title="端口安全"></a>端口安全</h2><p>使用netstat命令查询端口状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># netstat -ntlp | grep 10000</span></span><br><span class="line">tcp6       0      0 :::10000                :::*                    LISTEN      22354/docker-proxy</span><br></pre></td></tr></table></figure>

<p>发现这个并没有绑定127.0.0.1。这里我并没有研究好如何绑定127.0.0.1。这里可以通过防火墙进行端口控制。比如阿里云的入网端口管理，或者centos的firewalld命令都可以进行控制。具体就不展开了。</p>
<p>PS：明天具体写如何配置邮件发送。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/ubuntu-apt-install-php-zip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/ubuntu-apt-install-php-zip/" class="post-title-link" itemprop="url">ubuntu安装php-zip扩展失败</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-10 23:10:25" itemprop="dateCreated datePublished" datetime="2018-10-10T23:10:25+08:00">2018-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我在安装php-zip扩展的时候提示以下错误消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install php-zip</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">Some packages could not be installed. This may mean that you have</span><br><span class="line">requested an impossible situation or <span class="keyword">if</span> you are using the unstable</span><br><span class="line">distribution that some required packages have not yet been created</span><br><span class="line">or been moved out of Incoming.</span><br><span class="line">The following information may <span class="built_in">help</span> to resolve the situation:</span><br><span class="line"></span><br><span class="line">The following packages have unmet dependencies:</span><br><span class="line"> php-zip : Depends: php7.2-zip but it is not going to be installed</span><br><span class="line">E: Unable to correct problems, you have held broken packages.</span><br></pre></td></tr></table></figure>

<p>通过谷歌，发现解决错误的方式很简单。</p>
<p>首先打开<code>vi /etc/apt/sources.list</code>，然后修改里面的内容如下所示：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deb http://archive.ubuntu.com/ubuntu bionic main universe</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu bionic-security main universe</span><br><span class="line">deb http://archive.ubuntu.com/ubuntu bionic-updates main universe</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update </span><br></pre></td></tr></table></figure>

<p>然后执行安装命令就好了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install php-zip</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  libzip4 php7.2-zip</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  libzip4 php-zip php7.2-zip</span><br><span class="line">0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.</span><br><span class="line">Need to get 63.9 kB of archives.</span><br><span class="line">After this operation, 204 kB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] y</span><br><span class="line">Get:1 http://archive.ubuntu.com/ubuntu bionic/universe amd64 libzip4 amd64 1.1.2-1.1 [37.8 kB]</span><br><span class="line">Get:2 http://ppa.launchpad.net/ondrej/php/ubuntu bionic/main amd64 php7.2-zip amd64 7.2.10-1+ubuntu18.04.1+deb.sury.org+1 [20.3 kB]</span><br><span class="line">Get:3 http://ppa.launchpad.net/ondrej/php/ubuntu bionic/main amd64 php-zip all 1:7.2+62+ubuntu18.04.1+deb.sury.org+3 [5,840 B]</span><br><span class="line">Fetched 63.9 kB <span class="keyword">in</span> 2s (39.4 kB/s)   </span><br><span class="line">Selecting previously unselected package libzip4:amd64.</span><br><span class="line">(Reading database ... 102709 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../libzip4_1.1.2-1.1_amd64.deb ...</span><br><span class="line">Unpacking libzip4:amd64 (1.1.2-1.1) ...</span><br><span class="line">Selecting previously unselected package php7.2-zip.</span><br><span class="line">Preparing to unpack .../php7.2-zip_7.2.10-1+ubuntu18.04.1+deb.sury.org+1_amd64.deb ...</span><br><span class="line">Unpacking php7.2-zip (7.2.10-1+ubuntu18.04.1+deb.sury.org+1) ...</span><br><span class="line">Selecting previously unselected package php-zip.</span><br><span class="line">Preparing to unpack .../php-zip_1%3a7.2+62+ubuntu18.04.1+deb.sury.org+3_all.deb ...</span><br><span class="line">Unpacking php-zip (1:7.2+62+ubuntu18.04.1+deb.sury.org+3) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> php7.2-fpm (7.2.10-1+ubuntu18.04.1+deb.sury.org+1) ...</span><br><span class="line">Setting up libzip4:amd64 (1.1.2-1.1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> libc-bin (2.27-3ubuntu1) ...</span><br><span class="line">Setting up php7.2-zip (7.2.10-1+ubuntu18.04.1+deb.sury.org+1) ...</span><br><span class="line"></span><br><span class="line">Creating config file /etc/php/7.2/mods-available/zip.ini with new version</span><br><span class="line">Setting up php-zip (1:7.2+62+ubuntu18.04.1+deb.sury.org+3) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> php7.2-fpm (7.2.10-1+ubuntu18.04.1+deb.sury.org+1) ...</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1064634/unable-to-install-php-mbstring">https://askubuntu.com/questions/1064634/unable-to-install-php-mbstring</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/programmer-must-read-books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/programmer-must-read-books/" class="post-title-link" itemprop="url">程序员必读书籍</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-08 16:13:33" itemprop="dateCreated datePublished" datetime="2018-10-08T16:13:33+08:00">2018-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>对于程序员来说，有哪些书籍是必读的呢？Stack Overflow 上有一个<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1711/what-is-the-single-most-influential-book-every-programmer-should-read?page=1&tab=active#tab-top">问题</a>，虽然被关闭了，但是这是设置一个热门的问题。我看到里面推荐的书都是英文的。所以对照着找了找国内的中文版。但是也是有一些翻译的名字我确实没有找到或者暂时还没有出中文版。所以在其中有什么错误的地方，请大家评论告诉我，我立即去更新。</p>
<h2 id="图书目录"><a href="#图书目录" class="headerlink" title="图书目录"></a>图书目录</h2><ul>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1477390/">代码大全（第2版）</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5387402/">程序员修炼之道</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1148282/">计算机程序的构造与解释</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1139336/">C程序设计语言</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20432061/">算法导论（第3版）</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1052241/">设计模式</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4262627/">重构</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26358448/">人月神话</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1130500/">计算机程序设计艺术</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3296317/">编译原理</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1291204/">哥德尔、艾舍尔、巴赫</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5442024/">代码整洁之道</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5387403/">Effective C++</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5908727/">More Effective C++</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20260928/">编码</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3227098/">编程珠玑</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/2248759/">修改代码的艺术</a></li>
<li>Peopleware by Demarco and Lister</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5355285/">编程人生</a></li>
<li>Surely You’re Joking, Mr. Feynman!</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3360807/">Effective Java</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4826290/">企业应用架构模式</a></li>
<li>The Little Schemer</li>
<li>The Seasoned Schemer</li>
<li>Why’s (Poignant) Guide to Ruby</li>
<li>The Inmates Are Running The Asylum: Why High Tech Products Drive Us Crazy and How to Restore the Sanity</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/11609943/">UNIX编程艺术</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/25735501/">测试驱动开发</a></li>
<li>Practices of an Agile Developer</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26313852/">点石成金</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/5348122/">敏捷软件开发</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26819666/">领域驱动设计</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26102860/">设计心理学</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1119904/">C++设计新思维</a></li>
<li>Best Software Writing I by Joel Spolsky</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6524000/">程序设计实践</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26268555/">程序员思维修炼</a></li>
<li>Software Estimation: Demystifying the Black Art by Steve McConnel</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4923179/">我编程，我快乐</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6860890/">黑客</a></li>
<li>Algorithms + Data Structures &#x3D; Programs</li>
<li>Writing Solid Code</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3590768/">JavaScript语言精粹</a></li>
<li>Getting Real by 37 Signals</li>
<li>Foundations of Programming by Karl Seguin</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1230412/">计算机图形学原理及实践:C语言描述(第2版)</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/2130190/">Java编程思想</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1998341/">计算机系统要素</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/20393327/">重构与模式</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/27096665/">现在操作系统(第4版)</a></li>
<li>The Annotated Turing</li>
<li>Things That Make Us Smart by Donald Norman</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1177969/">建筑的永恒之道</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1231972/">最后期限</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4604591/">C++程序设计语言</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26912767/">深入理解计算机系统(第3版)</a></li>
<li>Agile Principles, Patterns, and Practices in C# by Robert C. Martin</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4910582/">测试驱动的面向对象软件开发</a></li>
<li>Framework Design Guidelines by Brad Abrams</li>
<li>Object Thinking by Dr. David West</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26790211/">UNIX环境高级编程</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/25910539/">黑客与画家</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6851207/">新机器的灵魂</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26285940/">CLR via C#</a></li>
<li>Design Patterns in C# by Steve Metsker</li>
<li>Alice in Wonderland by Lewis Carol</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6811366/">禅与摩托车维修艺术</a></li>
<li>About Face - The Essentials of Interaction Design</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3735295/">未来是湿的</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1899158/">编程之道</a></li>
<li>Computational Beauty of Nature</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3406939/">编程精粹</a></li>
<li>Philip and Alex’s Guide to Web Publishing</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/11509672/">面向对象分析与设计</a></li>
<li>Computability by N. J. Cutland</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4719230/">编程之魂</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1059258/">道德经</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/4214142/">卓有成效的程序员</a></li>
<li>The Art of Deception by Kevin Mitnick</li>
<li>The Career Programmer: Guerilla Tactics for an Imperfect World by Christopher Duncan</li>
<li>Paradigms of Artificial Intelligence Programming: Case studies in Common Lisp</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26642310/">DOOM启世录</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1239654/">单元测试之道C#版</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/6983584/">怎样解题</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/3608208/">牧羊少年奇幻之旅</a></li>
<li>Smalltalk-80: The Language and its Implementation</li>
<li>Writing Secure Code (2nd Edition) by Michael Howard</li>
<li>Introduction to Functional Programming by Philip Wadler and Richard Bird</li>
<li>No Bugs! by David Thielen</li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/30184215/">重来</a></li>
<li><a target="_blank" rel="noopener" href="https://book.douban.com/subject/1231231/">JUnit in Action</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/php-chinese-characters-to-pinyin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/php-chinese-characters-to-pinyin/" class="post-title-link" itemprop="url">PHP汉字转拼音</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-10-08 10:36:25" itemprop="dateCreated datePublished" datetime="2018-10-08T10:36:25+08:00">2018-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>如果对多音字要求不高的话。可以使用如下方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;Any-Latin; NFD; [:Nonspacing Mark:] Remove; NFC; [:Punctuation:] Remove; Lower();&#x27;</span>;</span><br><span class="line"><span class="variable">$transliterator</span> = <span class="title class_">Transliterator</span>::<span class="title function_ invoke__">create</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$string</span> = <span class="string">&quot;garçon-étudiant-où-L&#x27;école&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$transliterator</span>-&gt;<span class="title function_ invoke__">transliterate</span>(<span class="variable">$string</span>); <span class="comment">// garconetudiantoulecole</span></span><br></pre></td></tr></table></figure>

<p>使用的什么原理，我还不清楚，具体可以等以后再去了解。</p>
<h2 id="参考地址"><a href="#参考地址" class="headerlink" title="参考地址"></a>参考地址</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.phalconphp.com/en/3.4/i18n#transliteration">https://docs.phalconphp.com/en/3.4/i18n#transliteration</a></li>
<li><a target="_blank" rel="noopener" href="http://userguide.icu-project.org/transforms/general">http://userguide.icu-project.org/transforms/general</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/react-native-runs-project-first-time/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/react-native-runs-project-first-time/" class="post-title-link" itemprop="url">react-native首次运行项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-27 22:47:01" itemprop="dateCreated datePublished" datetime="2018-09-27T22:47:01+08:00">2018-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/react-native/" itemprop="url" rel="index"><span itemprop="name">react-native</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这两天一直在看react。今天正好想着安装 react-native ，看看传说中的用JS写APP能用嘛。</p>
<p>接下来就是介绍使用情况。首先就是搭建NodeJS和JAVA环境。</p>
<p>创建项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">react-native init fiction</span><br><span class="line"><span class="built_in">cd</span> fiction</span><br><span class="line">react-native run-android</span><br></pre></td></tr></table></figure>

<p>当然中间第一次运行的时候会去谷歌下载一些包。这些就不表了。</p>
<p>接下来主要是表述一下中间遇到的坑。</p>
<h2 id="unable-to-load-script-from-assets-‘index-android-bundle’"><a href="#unable-to-load-script-from-assets-‘index-android-bundle’" class="headerlink" title="unable to load script from assets ‘index.android.bundle’"></a>unable to load script from assets ‘index.android.bundle’</h2><p>其实解决的办法很简单：</p>
<p>首先在<code>android/app/src/main</code>创建<code>assets</code>文件夹，然后执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn add @babel/runtime --dev</span><br><span class="line"></span><br><span class="line">react-native bundle --platform android --dev <span class="literal">false</span> --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res</span><br></pre></td></tr></table></figure>

<p>执行完成后，再次执行<code>react-native run-android</code>就能看到美丽的开机页面了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/docker-install-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/docker-install-mysql/" class="post-title-link" itemprop="url">docker安装mysql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-19 10:53:16" itemprop="dateCreated datePublished" datetime="2018-09-19T10:53:16+08:00">2018-09-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>记录一下自己使用docker安装mysql的过程。</p>
<p>首先我找到两个:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hub.docker.com/r/mysql/mysql-server/">https://hub.docker.com/r/mysql/mysql-server/</a></li>
<li><a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql/">https://hub.docker.com/_/mysql/</a></li>
</ul>
<p>我对比了一下。发现第一个是mysql官方推出的，而第二是docker自带library推出的。那么我肯定选择mysql官方推出的mysql了。</p>
<p>既然确定了要安装的包，那么就要开始拉取了。</p>
<ul>
<li>MySQL Server 5.5 (tag: 5.5, 5.5.61, 5.5.61-1.1.7) (mysql-server&#x2F;5.5&#x2F;Dockerfile)</li>
<li>MySQL Server 5.6 (tag: 5.6, 5.6.41, 5.6.41-1.1.7) (mysql-server&#x2F;5.6&#x2F;Dockerfile)</li>
<li>MySQL Server 5.7 (tag: 5.7, 5.7.23, 5.7.23-1.1.7) (mysql-server&#x2F;5.7&#x2F;Dockerfile)</li>
<li>MySQL Server 8.0, the latest GA (tag: 8.0, 8.0.12, 8.0.12-1.1.7, latest) (mysql-server&#x2F;8.0&#x2F;Dockerfile)</li>
<li>MySQL Server 8.0 for AArch64 (ARM64) (tag: 8.0-aarch64, 8.0.12-aarch64)</li>
</ul>
<p>上面是可以安装的版本。那么我肯定是安装latest的。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>那么执行代码如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql/mysql-server</span><br></pre></td></tr></table></figure>

<p>如果想要安装5.7版本的，可以执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql/mysql-server:5.7</span><br></pre></td></tr></table></figure>

<p>好了等待之后，就安装成功了，接下来，我们看看我们在本地存储的镜像。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker image <span class="built_in">ls</span></span><br><span class="line">REPOSITORY                                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mysql/mysql-server                              latest              1fdf3806e715        5 weeks ago         309MB</span><br></pre></td></tr></table></figure>

<p>接下来执行创建容器的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql1 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql/mysql-server:latest</span><br></pre></td></tr></table></figure>

<p>在这里要注意的是最后的<code>:latest</code>，这个是可省略的。如果刚才安装的是指定版本，比如5.7，那么我们就需要执行以下命令了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql1 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql/mysql-server:5.7</span><br></pre></td></tr></table></figure>

<p>好了，安装完成，就可以使用PHP进行连接测试了。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> \<span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:host=127.0.0.1;dbname=mysql&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select version()&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$item</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会提示如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Host &#x27;172.17.0.1&#x27; is not allowed to connect to this MySQL server</span><br></pre></td></tr></table></figure>

<p>那么我们只能登录mysql进行修改数据了，首先是登录mysql，密码就是我们设置的123456：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it mysql1 mysql -uroot -p</span><br><span class="line">Enter password:</span><br></pre></td></tr></table></figure>

<p>然后执行如下命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> &quot;root&quot;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>我们继续测试PHP脚本，发现链接就正常了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ php ./demo.php</span><br><span class="line">/Users/baoguoxiao/demo.php:5:</span><br><span class="line">array(2) &#123;</span><br><span class="line">  <span class="string">&#x27;version()&#x27;</span> =&gt;</span><br><span class="line">  string(6) <span class="string">&quot;8.0.12&quot;</span></span><br><span class="line">  [0] =&gt;</span><br><span class="line">  string(6) <span class="string">&quot;8.0.12&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs mysql1</span><br></pre></td></tr></table></figure>

<h2 id="登录shell"><a href="#登录shell" class="headerlink" title="登录shell"></a>登录shell</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql1 bash</span><br></pre></td></tr></table></figure>

<h2 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop mysql1</span><br></pre></td></tr></table></figure>

<h2 id="开启容器"><a href="#开启容器" class="headerlink" title="开启容器"></a>开启容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start mysql1</span><br></pre></td></tr></table></figure>

<h2 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart mysql1</span><br></pre></td></tr></table></figure>

<h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop mysql1</span><br><span class="line">docker <span class="built_in">rm</span> mysql1</span><br></pre></td></tr></table></figure>

<h2 id="从另外的容器中连接mysql"><a href="#从另外的容器中连接mysql" class="headerlink" title="从另外的容器中连接mysql"></a>从另外的容器中连接mysql</h2><p>暂无</p>
<h2 id="Docker-环境变量"><a href="#Docker-环境变量" class="headerlink" title="Docker 环境变量"></a>Docker 环境变量</h2><p>其实我们在创建container的时候就已经用了一个环境变量了，就是<code>MYSQL_ROOT_PASSWORD</code>，现在我们来介绍一些其他的环境变量</p>
<ul>
<li><p>MYSQL_RANDOM_ROOT_PASSWD</p>
<p>  该值默认为ture（除非<code>MYSQL_ROOT_PASSWORD</code>设置了或者<code>MYSQL_ALLOW_EMPTY_PASSWORD</code>设置为true了），意思是在启动docker容器时随机生成root密码。密码打印到日志中。查看随机密码的方式如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker logs mysql1 2&gt;&amp;1 | grep GENERATED</span><br><span class="line">GENERATED ROOT PASSWORD: Axegh3kAJyDLaRuBemecis&amp;EShOs</span><br></pre></td></tr></table></figure></li>
<li><p>MYSQL_ONETIME_PASSWORD </p>
<p>  默认为ture（除非<code>MYSQL_ROOT_PASSWORD</code>设置了或者<code>MYSQL_ALLOW_EMPTY_PASSWORD</code>设置为true了）root用户的密码设置为expired，必须先修改密码才能使用。</p>
</li>
<li><p>MYSQL_DATABSE</p>
<p>  指定在容器创建时同时创建数据库的名称。如果启动参数也有<code>MYSQL_USER</code>和<code>MSQL_PASSWORD</code>，则会创建用户并授予该数据库对应的用户权限。如果指定的数据库已经存在了，则该变量无效。</p>
</li>
<li><p>MYSQL_USER和MYSQL_PASSWORD</p>
<p>  该变量用户创建用户名和密码，并为该用户授予<code>MYSQL_DATABASE</code>变量指定的数据库的超级用户权限。如果两个变量没有设置，则其他会被忽略。如果两个变量都已设置但是没有设置<code>MYSQL_DATABASE</code>，则创建的用户没有任何权限。</p>
</li>
<li><p>MYSQL_ROOT_HOST</p>
<p>  默认情况下，MySQL会设置”root@localhost”账户，此账户只能从内部进行连接。要允许其他主机的根连接，就需要设置此变量了。例如，该值<code>172.17.0.1</code>(默认的docker网关IP)允许来自运行容器的主机的连接。但是该选项仅接受一条记录，但是允许使用通配符（例如，MYSQL_ROOT_HOST&#x3D;172.<em>.</em>.*或MYSQL_ROOT_HOST&#x3D;%）。</p>
</li>
<li><p>MYSQL_LOG_CONSOLE</p>
<p>  当变量为true时（MySQL8.0服务器容器的默认状态）,MySQL服务器的错误日志被重定向到stderr，以便错误日志进入docker容器的日志，并且可以使用<code>docker logs mysqld-container</code>进行查看。</p>
</li>
<li><p>MYSQL_ROOT_PASSWORD</p>
<p>  此变量指定为MySQL root账户设置的密码。在命令行上设置MySQL root密码是不安全的，因为可以通过<code>history</code>查看命令历史从而获取创建的密码。所以最好是试用默认设置。</p>
</li>
<li><p>MYSQL_ALLOW_EMPTY_PASSWORD</p>
<p>  默认为false，如果将其设置为true，则表示允许root用户使用空密码启动。但是在非开发环境设置此变量为true是不安全的，因为他会让MySQL实例完全不受保护，从而允许任何人都可以获得弯针的超级用户访问权限。最好试用默认设置。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/laravel-db-timezone/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/laravel-db-timezone/" class="post-title-link" itemprop="url">laravel中DB_TIIMEZONE中的坑</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-18 10:57:58" itemprop="dateCreated datePublished" datetime="2018-09-18T10:57:58+08:00">2018-09-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>首先介绍一下环境。</p>
<p>数据库：RDS(阿里云)-5.6<br>PHP：PHP7.2 + Lumen<br>系统：Ubuntu</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>);</span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;dns&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select * from table where date_format(from_unixtime(addtime),&#x27;%Y%m%d&#x27;) = &#x27;<span class="subst">&#123;$time&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们有一条上面的查询语句。在开发的时候没有任何问题，但是代码在上线后，突然爆出不能正确的查出相应的数据。但是数据确实存在。</p>
<p>当时我们处理这个问题是凌晨1点，并且是在家里。考虑可能是时区问题，但是因为太晚了，所以我们使用了另外一种方式去避免这个问题。并没有追查这个事情的具体原因。</p>
<p>正好白天有一点空闲，所以准备排查一下这个问题。</p>
<p>我的第一考虑就是时区的问题，但是我自己执行以下的查询语句，却是发现没有问题。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;dns&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">queru</span>(<span class="string">&quot;select now()&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以我把目标转向了lumen这个框架，我通过查询源码，发现有这么一段源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file_path: vendor/illuminate/database/Connectors/MySqlConnector.php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set the timezone on the connection.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \PDO  $connection</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  array  $config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">configureTimezone</span>(<span class="params"><span class="variable">$connection</span>, <span class="keyword">array</span> <span class="variable">$config</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$config</span>[<span class="string">&#x27;timezone&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$connection</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&#x27;set time_zone=&quot;&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;timezone&#x27;</span>].<span class="string">&#x27;&quot;&#x27;</span>)-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我就去看我的数据配置，找到这里：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file path: config/database.php</span></span><br><span class="line"><span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span>    =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span>      =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;localhost&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span>      =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PORT&#x27;</span>, <span class="number">3306</span>),</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_DATABASE&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_USERNAME&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span>   =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_CHARSET&#x27;</span>, <span class="string">&#x27;utf8mb4&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;collation&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_COLLATION&#x27;</span>, <span class="string">&#x27;utf8mb4_unicode_ci&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span>    =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PREFIX&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;timezone&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_TIMEZONE&#x27;</span>, <span class="string">&#x27;+00:00&#x27;</span>), <span class="comment">// 注意看这里</span></span><br><span class="line">    <span class="string">&#x27;strict&#x27;</span>    =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_STRICT_MODE&#x27;</span>, <span class="literal">false</span>),</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>然后再次修改自己的SQL进行尝试：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$time</span> = <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Ymd&#x27;</span>);</span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;dns&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;set time_zone= &#x27;+00:00&#x27;; select * from table where date_format(from_unixtime(addtime),&#x27;%Y%m%d&#x27;) = &#x27;<span class="subst">&#123;$time&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现时间就会变成CST时间了。</p>
<p>这样在该框架的路由中增加了该方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&quot;/test&quot;</span>, function() &#123;</span><br><span class="line">    <span class="keyword">return</span> \DB::<span class="title function_ invoke__">select</span>(<span class="string">&quot;select now()&quot;</span>)-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>发现返回的时间也是CST时间了。所以真相大白了。</p>
<p>我们上班的时间是白天十点以后，这样当天的时间减去八个小时候再去计算，最上面写的SQL中的where条件还是成立的，但是凌晨一点去计算的时候，却是查询的昨天的数据，所以where条件就不查询不到正确的数据了。</p>
<p>这个事情让我明白，要仔细了解一个框架，说不定一个小小的细节被遗漏，就会造成不可预料的后果。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/laravel-input-empty-value-to-null/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/laravel-input-empty-value-to-null/" class="post-title-link" itemprop="url">laravel中表单提交获取字段会将空值转换为null的解决方案</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-08 07:26:37" itemprop="dateCreated datePublished" datetime="2018-09-08T07:26:37+08:00">2018-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>今天在进行Laravel开发的时候，发现了比较坑的一点。<br>按照默认情况来说，比如表单提交，如果我们提交了这个字段，但是这个字段为空字符串。在Laravel中会自动转义成Null。这个为什么呢？</p>
<p>原来Laravel有个全局中间件，代码如下图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Illuminate</span>\<span class="title class_">Foundation</span>\<span class="title class_">Http</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConvertEmptyStringsToNull</span> <span class="keyword">extends</span> <span class="title">TransformsRequest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transform the given value.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  mixed  $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">transform</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">is_string</span>(<span class="variable">$value</span>) &amp;&amp; <span class="variable">$value</span> === <span class="string">&#x27;&#x27;</span> ? <span class="literal">null</span> : <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该中间件就会将空的参数值自动转为null。</p>
<p>那么对于这种问题应该如何解决呢？</p>
<h2 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h2><p>我们再写一个中间件，替换之前的中间件，里面可以排除指定字段不转为null。里面的数组可以更改成你需要不转的字段。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/Http/Middleware/NinjaAuther.php 新增文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NinjaAuther</span> <span class="keyword">extends</span> <span class="title">TransformsRequest</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Transform the given value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string  $key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  mixed  $value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">transform</span>(<span class="params"><span class="variable">$key</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$value</span>) &amp;&amp; !<span class="title function_ invoke__">in_array</span>(<span class="variable">$key</span>,  [<span class="string">&#x27;abc&#x27;</span>], <span class="literal">true</span>)) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable">$value</span> === <span class="string">&#x27;&#x27;</span> ? <span class="literal">null</span> : <span class="variable">$value</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/Http/Kernel.php 部分代码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$middleware</span> = [</span><br><span class="line">        <span class="title class_">\App\Http\Middleware\CheckForMaintenanceMode</span>::<span class="variable language_">class</span>,</span><br><span class="line">        <span class="title class_">\Illuminate\Foundation\Http\Middleware\ValidatePostSize</span>::<span class="variable language_">class</span>,</span><br><span class="line">        <span class="title class_">\App\Http\Middleware\TrimStrings</span>::<span class="variable language_">class</span>,</span><br><span class="line">        <span class="comment">// \Illuminate\Foundation\Http\Middleware\ConvertEmptyStringsToNull::class, // 这一条注释掉</span></span><br><span class="line">        \app/Http/Middleware/NinjaAuther.<span class="keyword">class</span>, <span class="comment">// 新增的记录</span></span><br><span class="line">        <span class="title class_">\App\Http\Middleware\TrustProxies</span>::<span class="variable language_">class</span>,</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>

<p>但是该中间件是全句性质的，所以我个人则更加倾向于第二种方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/Http/Controllers/StoreController.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Store</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StoreController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$store</span> = <span class="keyword">new</span> <span class="title class_">Store</span>();</span><br><span class="line">        <span class="variable">$store</span>-&gt;title = <span class="title function_ invoke__">strval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;title&quot;</span>)); <span class="comment">// 对获取的字段进行格式转换</span></span><br><span class="line">        <span class="variable">$store</span>-&gt;address = <span class="title function_ invoke__">strval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;address&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;longitude = <span class="title function_ invoke__">doubleval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;longitude&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;latitude = <span class="title function_ invoke__">doubleval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;latitude&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;introduction = <span class="title function_ invoke__">strval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;introduction&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;text = <span class="title function_ invoke__">strval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;text&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;status = <span class="title function_ invoke__">intval</span>(<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&quot;status&quot;</span>));</span><br><span class="line">        <span class="variable">$store</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上面这样，对指定格式进行显示转换。写的多了，可能会显得繁琐一些。不过感觉比较看的明白。</p>
<p>上面这种方案如何解决，就看大家的喜好了。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/46244438/how-to-ignore-specific-attributes-in-laravels-convertemptystringstonull">How to ignore specific attributes in Laravel’s ConvertEmptyStringsToNull?</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/upgrade-mysql-to-8-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/upgrade-mysql-to-8-0/" class="post-title-link" itemprop="url">数据库升级</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-22 22:55:19" itemprop="dateCreated datePublished" datetime="2018-08-22T22:55:19+08:00">2018-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天晚上去看服务器，发现数据库的版本是5.7的，看起来挺新的。但是MySQL已经出了8.0了，受不了心中的渴望，所以就直接把源切到8.0新版本了。中国有一些坑，在此记录一下。</p>
<h2 id="升级之后wordpress不能连接，提示Error-establishing-a-database-connection"><a href="#升级之后wordpress不能连接，提示Error-establishing-a-database-connection" class="headerlink" title="升级之后wordpress不能连接，提示Error establishing a database connection"></a>升级之后wordpress不能连接，提示Error establishing a database connection</h2><p>原因是mysql在更新之后，因为密码验证规则的修改，导致密码已经变成新版验证的密码了，但是PHP目前并不支持这个新版验证方式。所以解决办法就是使用指定的SQL进行修改密码。修改模式如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;user&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这样就可以了，不过执行之后出现了另外一个错误。。。</p>
<h2 id="执行设置密码SQL出现错误：ERROR-1146-42S02-Table-‘mysql-role-edges’-doesn’t-exist"><a href="#执行设置密码SQL出现错误：ERROR-1146-42S02-Table-‘mysql-role-edges’-doesn’t-exist" class="headerlink" title="执行设置密码SQL出现错误：ERROR 1146 (42S02): Table ‘mysql.role_edges’ doesn’t exist"></a>执行设置密码SQL出现错误：ERROR 1146 (42S02): Table ‘mysql.role_edges’ doesn’t exist</h2><p>原因就是升级数据库之后没有执行<code>mysql_upgrade</code>命令。</p>
<p>按照如下命令执行一下即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_upgrade -uuser -p</span><br></pre></td></tr></table></figure>

<p>执行完成之后，再次执行上面设置密码的命令，这样wordpress就可以正常访问了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/laravel-run-npm-install-fail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/laravel-run-npm-install-fail/" class="post-title-link" itemprop="url">Laravel执行npm install失败</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-19 00:16:13" itemprop="dateCreated datePublished" datetime="2018-08-19T00:16:13+08:00">2018-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>首先介绍一下我的环境。</p>
<p>我是在Windows10上进行开发。然后windows共享文件夹，ubuntu 18.04挂载共享文件夹。</p>
<p>环境：</p>
<ul>
<li>Laravel 5.6</li>
<li>PHP 7.2.7</li>
<li>NodeJS 8.10.0</li>
<li>npm 3.5.2</li>
</ul>
<p>还原场景：</p>
<p>在linux环境中执行<code>npm install</code>方法。会出现如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">npm WARN optional Skipping failed optional dependency /chokidar/fsevents:</span><br><span class="line">npm WARN notsup Not compatible with your operating system or architecture: fsevents@1.2.4</span><br><span class="line">npm WARN ajv-keywords@3.2.0 requires a peer of ajv@^6.0.0 but none was installed.</span><br><span class="line">npm ERR! Linux 4.15.0-30-generic</span><br><span class="line">npm ERR! argv <span class="string">&quot;/usr/bin/node&quot;</span> <span class="string">&quot;/usr/bin/npm&quot;</span> <span class="string">&quot;install&quot;</span></span><br><span class="line">npm ERR! node v8.10.0</span><br><span class="line">npm ERR! npm  v3.5.2</span><br><span class="line">npm ERR! path ../acorn/bin/acorn</span><br><span class="line">npm ERR! code ENOTSUP</span><br><span class="line">npm ERR! errno -95</span><br><span class="line">npm ERR! syscall symlink</span><br><span class="line"></span><br><span class="line">npm ERR! nospc ENOTSUP: operation not supported on socket, symlink <span class="string">&#x27;../acorn/bin/acorn&#x27;</span> -&gt; <span class="string">&#x27;/home/baoguoxiao/windows/food/node_modules/.bin/acorn&#x27;</span></span><br><span class="line">npm ERR! nospc This is most likely not a problem with npm itself</span><br><span class="line">npm ERR! nospc and is related to insufficient space on your system.</span><br><span class="line"></span><br><span class="line">npm ERR! Please include the following file with any support request:</span><br><span class="line">npm ERR!     /home/baoguoxiao/windows/food/npm-debug.log</span><br></pre></td></tr></table></figure>

<p>经过查询，发现是创建不能创建链接。经过查询，发现解决方法很简单。只要加上一个参数就好了。执行命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -no-bin-links</span><br></pre></td></tr></table></figure>

<p>错误很复杂，解决的办法却是很简单。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/37062847/npm-syscall-symlink-error-95-when-installing-node-sass-on-docker-for-windows">node.js - npm syscall symlink error -95 when installing node-sass on Docker for Windows - Stack Overflow</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/lumen-install-horizon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/lumen-install-horizon/" class="post-title-link" itemprop="url">lumen安装Horizon</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-14 11:10:23" itemprop="dateCreated datePublished" datetime="2018-08-14T11:10:23+08:00">2018-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 23:42:05" itemprop="dateModified" datetime="2022-08-20T23:42:05+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/lumen/" itemprop="url" rel="index"><span itemprop="name">lumen</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>昨天领导告诉我，要安装Horizon。但是我们使用的是lumen，官方的Horizon并不支持lumen。所以又去找第三方，结果发现已经八个月没有更新了。无奈尝试自己维护。发现一堆坑。根本填不完。今天早上想着去<a target="_blank" rel="noopener" href="https://packagist.org/">packagist</a>去淘淘。还真让我发现了一个正在维护的:<a target="_blank" rel="noopener" href="https://packagist.org/packages/kinsolee/horizon-lumen">horizon-lumen</a>。</p>
<p>一切安装就按照README.md上面的步骤进行安装就好了。</p>
<p>再此说下，中间碰到的坑。</p>
<p>在执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --provider=<span class="string">&quot;Laravel\Horizon\HorizonServiceProvider&quot;</span></span><br></pre></td></tr></table></figure>

<p>出现如下错误：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In Facade.php line <span class="number">218</span>:</span><br><span class="line"></span><br><span class="line">  A facade root has not been set.</span><br></pre></td></tr></table></figure>

<p>经过查询发现解决方案是在boorstrap&#x2F;app.php中的注释：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">withFacades</span>(); <span class="comment">// 去掉这一行的注释</span></span><br></pre></td></tr></table></figure>

<p>我发现这一行已经开启了，但是还是出现这个错误。然后我发现这一块的代码几乎放在了该文件的最后，所以我将其提到了文件的最前面，如下所示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">withEloquent</span>(); <span class="comment">// 这一行的下面</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">withFacades</span>(<span class="literal">true</span>,[</span><br><span class="line">    <span class="string">&#x27;Tymon\JWTAuth\Facades\JWTAuth&#x27;</span>             =&gt; <span class="string">&#x27;JWTAuth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Tymon\JWTAuth\Facades\JWTFactory&#x27;</span>          =&gt; <span class="string">&#x27;JWTFactory&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ZanySoft\Zip\ZipFacade&#x27;</span> =&gt; <span class="string">&#x27;Zip&#x27;</span>,</span><br><span class="line">    <span class="title class_">App\Providers\RongCloudServiceProvider</span>::<span class="variable language_">class</span> =&gt;  <span class="string">&#x27;RongCloud&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>这样就能正常安装上了。</p>
<p>还有一个问题是在访问仪表盘的时候，结果html代码是以文本来显示的。并没有使用html的方式展示内容。</p>
<p>经过分析，发现返回的header中没有<code>Content-type</code>选项。</p>
<p>所以写了一个中间件。代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * file path: app/Http/Middleware/HtmlMiddleware.php</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Closure  $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$response</span>-&gt;headers-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&quot;Content-Type&quot;</span>))) &#123; <span class="comment">// 当为空的时候才会添加header</span></span><br><span class="line">            <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=UTF-8&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为我这边使用了dingo，所以加上如上判断。</p>
<p>最后修改bootstrap&#x2F;app.php中的一处：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$app</span>-&gt;<span class="title function_ invoke__">middleware</span>([</span><br><span class="line">    <span class="title class_">\App\Http\Middleware\HtmlMiddleware</span>::<span class="variable language_">class</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>一切大功告成。</p>
<p>后记：</p>
<p>在分享给同事使用的时候，同事说出现这么一个错误：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The Mix manifest does not exist</span><br></pre></td></tr></table></figure>

<p>在我本地是正常啊，为啥同事就是不行呢。研究了半天。发现原因了。</p>
<p>因为在public文件夹里面有vendor文件夹。但是正好.gitignore中有一条规则将vendor&#x2F;给忽略了。所以需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add public/vendor -f <span class="comment"># 强制加入git版本追踪</span></span><br></pre></td></tr></table></figure>

<p>提交之后，让同事拉取代码，再去执行就可以了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备13027795号-1 </a>
  </div>

<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魔王卷子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
