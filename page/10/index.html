<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.baoguoxiao.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录我的工作中碰到的坑">
<meta property="og:type" content="website">
<meta property="og:title" content="魔王卷子">
<meta property="og:url" content="http://www.baoguoxiao.com/page/10/index.html">
<meta property="og:site_name" content="魔王卷子">
<meta property="og:description" content="记录我的工作中碰到的坑">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="魔王卷子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.baoguoxiao.com/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>魔王卷子</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">魔王卷子</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-阅读"><a href="/books.html" rel="section"><i class="fa fa-book fa-fw"></i>阅读</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="魔王卷子"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">魔王卷子</p>
  <div class="site-description" itemprop="description">记录我的工作中碰到的坑</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/mowangjuanzi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;mowangjuanzi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:baoguoxiao0538@hotmail.com" title="E-Mail → mailto:baoguoxiao0538@hotmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/mowangjuanzi/blog" class="github-corner" title="在 Github 上关注我" aria-label="在 Github 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/mongodb-replica-set/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/mongodb-replica-set/" class="post-title-link" itemprop="url">MongoDB副本集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:18" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:18+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/" itemprop="url" rel="index"><span itemprop="name">mongodb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于副本集的理论我就不介绍了。下面说下如何实现副本集的操作。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><ol>
<li>首先就是要安装mongoDB服务器了。我建议按照我之前写的<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000005176288">这篇文章</a>进行安装。</li>
<li>准备三台以上的服务器。然后同时安装MongoDB。我们三台服务器的IP分别是（10.55.160.91，10.55.160.92，10.55.160.93）</li>
</ol>
<h2 id="部署一个副本集"><a href="#部署一个副本集" class="headerlink" title="部署一个副本集"></a>部署一个副本集</h2><ol>
<li><p>修改配置文件。<br> 首先我们打开配置文件。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br></pre></td></tr></table></figure>
<p> 找到<code>bindIp: 127.0.0.1</code>这行，我们需要对这行进行注释。变成如下这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bindIp: 127.0.0.1  # Listen to local interface only, comment to listen on all interfaces.</span></span><br></pre></td></tr></table></figure>
<p> 因为这个<code>bindIp</code>代表只允许本机进行连接，然后不允许其他服务器进行连接，那么，下面就没有办法继续执行了。</p>
<p> 找到<code>#replication:</code>这行我们将其注释去掉，然后下面增加一行，变成下面这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replication:</span><br><span class="line">  replSetName: test</span><br></pre></td></tr></table></figure>
<p> <code>replSetName</code>表示副本集组的名字(<code>test</code>是我自己写的，你们也可以写你们自己的喜欢的名字)，比如，我们要将三台服务器进行关联，那么我们就要将三台服务器都设置为相同的名字。</p>
<p> 然后如果三台服务器的MongoDB都已经启动了，那么就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod restart</span><br></pre></td></tr></table></figure>
<p> 如果没有启动就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod start</span><br></pre></td></tr></table></figure>
</li>
<li><p>链接到任意一台服务器。<br> 我选择的是链接到<code>10.55.160.91</code>。也就是我现在正在操作的这一台服务器。然后登录：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure></li>
<li><p>初始化副本集。<br> 初始化副本集，我们需要使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.initiate/#rs.initiate"><code>rs.initiate()</code></a>方法。<br> 我现在需要添加的是三台服务器，我们可以执行以下方法：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">initiate</span>(&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">version</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">members</span>: [</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">0</span>, host : <span class="string">&quot;10.55.160.91:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">1</span>, host : <span class="string">&quot;10.55.160.92:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">2</span>, host : <span class="string">&quot;10.55.160.93:27017&quot;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p> 当返回值显示为如下的时候，就代表成功了：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ok&quot;</span> : <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>这样就完成了，是不是很简单。哈哈。</p>
</li>
</ol>
<p>然后你就发现你的输入命令的标题就变了。变成如下这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test</span>:<span class="variable constant_">OTHER</span>&gt;</span><br></pre></td></tr></table></figure>
<p>不管它，我们继续执行操作，执行<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>，查看当前状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">status</span>()</span><br></pre></td></tr></table></figure>
<p>查看返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:36.607Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">154</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;infoMessage&quot;</span> : <span class="string">&quot;could not find member to sync from&quot;</span>,</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531709</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:29Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们主要是看<code>members</code>字段里面的<code>stateStr</code>的值。</p>
<p>很幸运，我当前执行命令的服务器被推举为主服务器。</p>
<p>如果你们现在服务器显示当前的服务器的状态是:<code>SECONDARY</code>。表示该服务器是从服务器，我们需要查看哪台服务器为主服务器，也就是<code>&quot;stateStr&quot; : &quot;PRIMARY&quot;</code>。我们需要在主服务器才进行进行操作，当然，也有强行在从服务器进行操作的办法。这里先不说。</p>
<p>这样我们就可以在主服务器进行操作了。比如存储数据。</p>
<h2 id="添加成员"><a href="#添加成员" class="headerlink" title="添加成员"></a>添加成员</h2><p>比如现在又有了一台服务器(10.55.160.94)需要加入到这个副本集中。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.add/#rs.add"><code>rs.add()</code></a>进行添加服务器。</p>
<p>首先我们还是别忘了修改配置文件的步骤。。。。。。修改完成配置文件之后重启Mongod，然后在主服务器执行如下命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">add</span>(<span class="string">&quot;10.55.160.94:27017&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在执行该命令之后，可能会出现主服务器的选择，我们要注意主服务器是否已经变成了别的服务器。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>查看新的主服务器是什么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:53.913Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1207</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536383</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:26:23Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">71</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.059Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改服务器的优先级"><a href="#修改服务器的优先级" class="headerlink" title="修改服务器的优先级"></a>修改服务器的优先级</h2><p>比如我们新添加的服务器(10.55.160.94)，这个服务器的配置较高。我希望优先让它成为主服务器。我们可以通过如下方式进行修改：</p>
<p>首先我们可以通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.conf/#rs.conf"><code>rs.conf</code></a>来查看是第几个游标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">conf</span>()</span><br></pre></td></tr></table></figure>
<p>返回值如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;version&quot;</span> : <span class="number">6</span>,</span><br><span class="line">	<span class="string">&quot;protocolVersion&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;chainingAllowed&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="number">2000</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatTimeoutSecs&quot;</span> : <span class="number">10</span>,</span><br><span class="line">		<span class="string">&quot;electionTimeoutMillis&quot;</span> : <span class="number">10000</span>,</span><br><span class="line">		<span class="string">&quot;getLastErrorModes&quot;</span> : &#123;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;getLastErrorDefaults&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;w&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;wtimeout&quot;</span> : <span class="number">0</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;replicaSetId&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57e391736b7581c82cc75a83&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到它的游标是第3个(从0开始计算)。<br>我们可以这样进行修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">3</span>].<span class="property">priority</span> = <span class="number">10</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>过了一会，我们就看到主服务器变成(10.55.160.94)了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:48.348Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.535Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.674Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">3066</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:47.546Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加仲裁者服务器"><a href="#添加仲裁者服务器" class="headerlink" title="添加仲裁者服务器"></a>添加仲裁者服务器</h2><p>仲裁者服务器只参与投票，而不是进行数据的存储。别忘了定义副本集名称。</p>
<p>我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.addArb/#rs.addArb"><code>rs.addArb()</code></a>来进行添加一台新的服务器（10.55.160.95）为仲裁服务器。</p>
<p>命令如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">addArb</span>(<span class="string">&#x27;10.55.160.95&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>返回<code>&#123; &quot;ok&quot; : 1 &#125;</code>就正常执行了。这时我们通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>来看一下服务器的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.854Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">141</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">95</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.091Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">86</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.121Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">83</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.134Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">79</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:42.775Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到IP为<code>10.55.160.95</code>这台服务器，它的<code>stateStr</code>的值是<code>ARBITER</code>。这个就代表是仲裁者的角色。</p>
<h2 id="移除成员"><a href="#移除成员" class="headerlink" title="移除成员"></a>移除成员</h2><p>移除成员我们使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.remove/#rs.remove"><code>rs.remove()</code></a>方法就可以了。</p>
<p>比如我们要移除10.55.160.93。我们可以使用如下命令:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">remove</span>(<span class="string">&#x27;10.55.160.93:27017&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>rs.status()</code>查看一下返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:21Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1377</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1331</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.593Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.592Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1319</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.595Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.582Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1315</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.596Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:17.585Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现10.55.160.93这个服务器已经从副本集中消失了。</p>
<h2 id="更换副本集成员"><a href="#更换副本集成员" class="headerlink" title="更换副本集成员"></a>更换副本集成员</h2><p>我们可以使用如下办法进行快速更换成员：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">0</span>].<span class="property">host</span> = <span class="string">&quot;10.55.160.93&quot;</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>我们看之前被替换走的成员，它的状态已经变成这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;state&quot;</span> : <span class="number">10</span>,</span><br><span class="line">	<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;REMOVED&quot;</span>,</span><br><span class="line">	<span class="string">&quot;uptime&quot;</span> : <span class="number">3162</span>,</span><br><span class="line">	<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474602195</span>, <span class="number">1</span>),</span><br><span class="line">		<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:43:15Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">0</span>,</span><br><span class="line">	<span class="string">&quot;errmsg&quot;</span> : <span class="string">&quot;Our replica set config is invalid or we are not a member of it&quot;</span>,</span><br><span class="line">	<span class="string">&quot;code&quot;</span> : <span class="number">93</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/python3-interaction-back-button/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/python3-interaction-back-button/" class="post-title-link" itemprop="url">centos上Python3交互模式无法使用后退键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:04" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:04+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/python/pip/" itemprop="url" rel="index"><span itemprop="name">pip</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在CentOS（7.2）上安装了Python3用来学习，在进入交互模式之后，发现无法使用后退键。这特别的不方便。可以使用以下方法来解决问题：</p>
<p>首先安装一个包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install patch ncurses ncurses-devel</span><br></pre></td></tr></table></figure>

<p>然后使用pip安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install readline</span><br></pre></td></tr></table></figure>

<p>安装完成以后，我们就可以正常使用python了。也可以使用后退键和方向键了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/mysql-replicate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/mysql-replicate/" class="post-title-link" itemprop="url">mysql 复制</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:24:36" itemprop="dateCreated datePublished" datetime="2017-11-17T16:24:36+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>MySQL的复制功能是构建基于MySQL的大规模、高性能应用的基础。复制功能不仅有利于构建高性能的应用，同时也是高可用性、可扩展性、灾难恢复、备份以及数据仓库等工作的基础。</p>
<p>本文主要讲述复制如何工作，基本的复制如何搭建，复制的相关配置和优化复制服务器。</p>
<h2 id="复制的工作原理："><a href="#复制的工作原理：" class="headerlink" title="复制的工作原理："></a>复制的工作原理：</h2><p>简单来说，复制分为下面三个步骤：</p>
<ol>
<li>在主库上把数据更改记录到二进制日志中（这些记录被称为二进制日志事件）。</li>
<li>备库将主库上的日志复制到自己的中继日志（relay log）中。</li>
<li>备库读取中继日志中的事件，将其重放到备库数据之上。</li>
</ol>
<h2 id="配置复制"><a href="#配置复制" class="headerlink" title="配置复制"></a>配置复制</h2><p>为MySQL服务器配置复制非常简单。最基本的场景是新安装的主库和备库，总的来说分为以下几步：</p>
<ol>
<li>在每台服务器上创建复制账号。</li>
<li>配置主库和备库。</li>
<li>通知备库连接到主库并从主库复制数据。</li>
</ol>
<h3 id="创建复制账号"><a href="#创建复制账号" class="headerlink" title="创建复制账号"></a>创建复制账号</h3><p>MySQL 会赋予一个特殊的权限给复制线程。在备库运行的I&#x2F;O线程会建立一个到主库的TCP&#x2F;IP连接。这意味着必须在主库创建一个用户，并赋予一个合适的权限。</p>
<p>通过如下语句创建用户账号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave, replication client on *.* to repl@<span class="string">&#x27;10.55.160.%&#x27;</span> identified by <span class="string">&#x27;Pw12345.&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>请注意我们将这个账户限制在本地网络。因为这是一个特权账号。</p>
<p>复制账户只需要有主库上的 replication slave 权限，并不需要每一端都赋予 replication client 权限，为啥两端都要赋予呢：</p>
<ul>
<li>用来监控和管理复制的账号需要 replication client 权限，并且针对两个目的使用同一个账号更加容易。</li>
<li>如果在主库上建立了账号，然后从主库将数据克隆到备库上时，备库也就设置了 ———— 变成主库所需要的角色，方便后续有需要进行转换角色。</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在主库的 <code>my.cnf</code> 文件中增加或者修改如下内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log_bin</span>=mysql-bin</span><br><span class="line"><span class="attr">server_id</span>=<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>必须明确的指定一个唯一的服务器ID，默认服务器ID为1，使用默认值可能会导致和其它服务器的ID产生冲突，所以我们选择10来作为ID，一般的做法时使用服务器的末8位，但要保证它是不变且唯一的。最好选择一些有意义的约定并遵循。</p>
<p>如果之前没有在MySQL的配置中指定<code>log_bin</code>选项，需要重新启动MySQL。为了确认二进制日志文件是否已经创建，我们使用以下命令进行查看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">             File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">         Position: <span class="number">154</span></span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>需要在备库上的<code>my.cnf</code>文件中增加类似的配置，并且同样需要重启服务器：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log_bin<span class="operator">=</span>mysql<span class="operator">-</span>bin</span><br><span class="line">server_id<span class="operator">=</span><span class="number">11</span></span><br><span class="line">relay_log<span class="operator">=</span><span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysql<span class="operator">-</span>relay<span class="operator">-</span>bin</span><br><span class="line">log_slave_updates<span class="operator">=</span><span class="number">1</span></span><br><span class="line">read_only<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>从技术上来说，这些选项都不是必须的。其中一些选项只是显式的列出了默认值。事实上只有<code>server_id</code>时必需的。</p>
<p><code>log_bin</code>：默认情况下，它是根据机器名来命名的，但是如果机器名变化了可能会出现问题，为了简便起见，我们在主库和备库设置了同样的值。<br><code>relay_log</code>：指定中继日志的位置和命名。<br><code>slave_updates</code>：允许备库将其重放的事件也记录到自身的二进制日志中。<br><code>read_only</code>：该选项会阻止没有任何特权权限的线程修改数据。所以最好不要给用户超出需要的权限。但是并不是很实用，特别是那些需要在备库建表的应用。</p>
<h3 id="启动复制"><a href="#启动复制" class="headerlink" title="启动复制"></a>启动复制</h3><p>下面我们告诉备库如何连接到主库并重放其二进制日志。这一步不要通过<strong>my.cnf</strong>来配置，而是使用 <code>change master to</code> 语句。因为该语句完全替代了<strong>my.cnf</strong>中相应的配置而且允许以后指向别的主库的时候无需重启备库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;10.55.160.91&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;Pw12345.&#x27;</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">2</span> warnings (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>master_log_pos</strong>参数倍设置成0，因为要从日志的开头读起。我们可以通过<code>show slave status</code>语句来检查复制是否正确执行了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: <span class="keyword">No</span></span><br><span class="line">            Slave_SQL_Running: <span class="keyword">No</span></span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">              Relay_Log_Space: <span class="number">154</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="keyword">NULL</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">0</span></span><br><span class="line">                  Master_UUID: </span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: </span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><code>Slave_IO_State</code>、<code>Slave_IO_Running</code>、<code>Slave_SQL_Running</code>这三列显式当前备库尚未运行。</p>
<p>运行下面的命令进行复制：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>执行该命令没有显示错误，我们再用<code>show slave status</code>命令检查一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: <span class="keyword">No</span></span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">              Relay_Log_Space: <span class="number">154</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="keyword">NULL</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">1593</span></span><br><span class="line">                Last_IO_Error: Fatal error: The slave I<span class="operator">/</span>O thread stops because master <span class="keyword">and</span> slave have equal MySQL server UUIDs; these UUIDs must be different <span class="keyword">for</span> replication <span class="keyword">to</span> work.</span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">10</span></span><br><span class="line">                  Master_UUID: </span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: Slave has read <span class="keyword">all</span> relay log; waiting <span class="keyword">for</span> more updates</span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: <span class="number">161114</span> <span class="number">15</span>:<span class="number">28</span>:<span class="number">07</span></span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>看到这里报出一个错误：<code>Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work.</code>，其实这是因为我是用的虚拟机，然后直接进行复制的，倒是UUID相同，解决办法就是删除<code>auto.cnf</code>就好了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld stop</span><br><span class="line">Redirecting to /bin/systemctl stop  mysqld.service</span><br><span class="line">[root@localhost ~]# \rm /var/lib/mysql/auto.cnf </span><br><span class="line">[root@localhost ~]# service mysqld start</span><br><span class="line">Redirecting to /bin/systemctl start  mysqld.service</span><br></pre></td></tr></table></figure>

<p>然后我们继续上面的操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master <span class="keyword">to</span> send event</span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">472</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000003</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">685</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">472</span></span><br><span class="line">              Relay_Log_Space: <span class="number">892</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="number">0</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">10</span></span><br><span class="line">                  Master_UUID: a901199b<span class="operator">-</span>aa23<span class="number">-11e6</span><span class="number">-862e-000</span>c2943e6a3</span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: Slave has read <span class="keyword">all</span> relay log; waiting <span class="keyword">for</span> more updates</span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>这样就正常了。Slave_IO_State 显示正在等待从主库传递过来的事件，这意味着I&#x2F;O线程已经读取了主库所有的事件。</p>
<p>到此，一个全新的复制就搞定了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/yum-install-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/yum-install-mysql/" class="post-title-link" itemprop="url">yum 安装 mysql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:23:11" itemprop="dateCreated datePublished" datetime="2017-11-17T16:23:11+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>提示：以下命令都是在 <code>root</code> 账户下执行的命令。</p>
</blockquote>
<p>每次安装mysql的时候都非常痛苦。因为至少要编译半个小时，在想有没有什么简单的办法，我一查官方文档，真让我看到一个简单的yum的安装办法。现在步骤如下：</p>
<h2 id="删除已经存在的mysql"><a href="#删除已经存在的mysql" class="headerlink" title="删除已经存在的mysql"></a>删除已经存在的mysql</h2><p>我们执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mysql</span><br><span class="line">rpm -e mysql mysql-libs</span><br><span class="line">yum -y remove mysql-server mysql mysql-libs</span><br></pre></td></tr></table></figure>

<h2 id="配置源"><a href="#配置源" class="headerlink" title="配置源"></a>配置源</h2><p>首先我们需要获取分发源的地址（<a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/repo/yum/">点击此处</a>）。我现在提供 Red Hat&#x2F;Centos 连接如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat7/CentOS7</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat6/CentOS6</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el6-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat5/CentOS5</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el5-7.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 24</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc24-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 23</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc23-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 22</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc22-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>比如说我现在的系统是CentOS7，那么我就使用如下方法进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -ivh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line">获取http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line">警告：/var/tmp/rpm-tmp.yIWWrJ: 头V3 DSA/SHA1 Signature, 密钥 ID 5072e1f5: NOKEY</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:mysql57-community-release-el7-9  ################################# [100%]</span><br></pre></td></tr></table></figure>

<p>我们可以通过以下方法检测是否已经成功安装了rpm源：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br><span class="line">mysql-connectors-community/x86_64        MySQL Connectors Community           24</span><br><span class="line">mysql-tools-community/x86_64             MySQL Tools Community                38</span><br><span class="line">mysql57-community/x86_64                 MySQL 5.7 Community Server          146</span><br></pre></td></tr></table></figure>

<p>出现最后一行内容就表示已经安装成功了。</p>
<h2 id="选择安装版本"><a href="#选择安装版本" class="headerlink" title="选择安装版本"></a>选择安装版本</h2><blockquote>
<p>注意，默认安装源之后自动开启5.7系列的安装。如果你要安装的MySQL低于5.7那么可以通过本节来进行修改源，否则跳过本节即可。</p>
</blockquote>
<p>当你使用此方法进行安装MySQL的时候，会默认安装mysql的最新稳定版本（在我现在安装的时候，最新版本为5.7.16）。如果这就是你想要安装的，那么你就可以忽略这步了。如果想要安装以前的版本，比如5.6或者5.5，那么就可以用下面的方法来配置了。</p>
<p>首先我们先查看MySQL的那些源被禁用或者启用了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist all | grep mysql</span><br><span class="line">mysql-connectors-community/x86_64 MySQL Connectors Community         启用:    24</span><br><span class="line">mysql-connectors-community-source MySQL Connectors Community - Sourc 禁用</span><br><span class="line">mysql-tools-community/x86_64      MySQL Tools Community              启用:    38</span><br><span class="line">mysql-tools-community-source      MySQL Tools Community - Source     禁用</span><br><span class="line">mysql-tools-preview/x86_64        MySQL Tools Preview                禁用</span><br><span class="line">mysql-tools-preview-source        MySQL Tools Preview - Source       禁用</span><br><span class="line">mysql55-community/x86_64          MySQL 5.5 Community Server         禁用</span><br><span class="line">mysql55-community-source          MySQL 5.5 Community Server - Sourc 禁用</span><br><span class="line">mysql56-community/x86_64          MySQL 5.6 Community Server         禁用</span><br><span class="line">mysql56-community-source          MySQL 5.6 Community Server - Sourc 禁用</span><br><span class="line">mysql57-community/x86_64          MySQL 5.7 Community Server         启用:   146</span><br><span class="line">mysql57-community-source          MySQL 5.7 Community Server - Sourc 禁用</span><br><span class="line">mysql80-community/x86_64          MySQL 8.0 Community Server         禁用</span><br><span class="line">mysql80-community-source          MySQL 8.0 Community Server - Sourc 禁用</span><br></pre></td></tr></table></figure>

<p>比如我们看到现在启用的是5.7版本系列的。我们需要安装的是5.6系列的。那么我们就可以执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum-config-manager --disable mysql57-community</span><br><span class="line">-bash: yum-config-manager: 未找到命令</span><br></pre></td></tr></table></figure>

<p>提示没有找到命令，那么我们就需要安装执行以下命令来安装一个包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils </span><br></pre></td></tr></table></figure>

<p>执行成功之后就好了，那么我们继续执行上面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --disable mysql57-community</span><br><span class="line">yum-config-manager --enable mysql56-community</span><br></pre></td></tr></table></figure>

<p>我们看看现在的系统配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist enabled | grep mysql</span><br><span class="line">mysql-connectors-community/x86_64        MySQL Connectors Community           24</span><br><span class="line">mysql-tools-community/x86_64             MySQL Tools Community                38</span><br><span class="line">mysql56-community/x86_64                 MySQL 5.6 Community Server          289</span><br></pre></td></tr></table></figure>

<p>好了。下面就可以进行安装MySQL了。</p>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p>我这里也是使用MySQL5.7来安装的。</p>
<p>我们只需要执行以下命令就OK了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure>

<p>#MySQL 管理命令</p>
<p>使用下面的命令启动MySQL：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld start</span><br><span class="line">Redirecting to /bin/systemctl start  mysqld.service</span><br></pre></td></tr></table></figure>

<p>只要没有错误信息就表示已经正常启动了。</p>
<p>现在我们看以下MySQL的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld status</span><br><span class="line">Redirecting to /bin/systemctl status  mysqld.service</span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 一 2016-11-14 12:34:44 CST; 5min ago</span><br><span class="line">  Process: 35494 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 35421 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 35498 (mysqld)</span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           └─35498 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line">11月 14 12:34:39 localhost.localdomain systemd[1]: Starting MySQL Server...</span><br><span class="line">11月 14 12:34:44 localhost.localdomain systemd[1]: Started MySQL Server.</span><br></pre></td></tr></table></figure>

<p>这样表示已经正常启动了。</p>
<p>停止：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br></pre></td></tr></table></figure>

<p>重启：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>

<h2 id="修改MySQL密码"><a href="#修改MySQL密码" class="headerlink" title="修改MySQL密码"></a>修改MySQL密码</h2><p>我们首先查找一下MySQL的密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br><span class="line">2016-11-14T04:34:41.742516Z 1 [Note] A temporary password is generated for root@localhost: sNKz9yEdzw%/</span><br></pre></td></tr></table></figure>

<p>我们就可以看到我们的密码就是： **sNKz9yEdzw%&#x2F;**。</p>
<p>首先启动MySQL client:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.16</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span></span><br></pre></td></tr></table></figure>

<p>首先我们先查看一下数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line">ERROR <span class="number">1820</span> (HY000): You must reset your password <span class="keyword">using</span> <span class="keyword">ALTER</span> <span class="keyword">USER</span> statement before executing this statement.</span><br></pre></td></tr></table></figure>

<p>这里提示我们需要修改密码：</p>
<p>这里MySQL安装了 <a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.7/en/validate-password-plugin.html">validate_password</a>。这个插件要求密码至少包含一个大写字母，一个小写字母，一个数字和一个特殊字符，并且密码长度至少8个字符。</p>
<p>比如我们定义密码为 **Pw12345.**。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> password <span class="operator">=</span> password(<span class="string">&#x27;Pw12345.&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>然后我们就可以正常的执行SQL命令了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="使用Yum-安装其它的MySQL产品和组件"><a href="#使用Yum-安装其它的MySQL产品和组件" class="headerlink" title="使用Yum 安装其它的MySQL产品和组件"></a>使用Yum 安装其它的MySQL产品和组件</h2><p>我们查看一下有什么可以安装的MySQL产品和组件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum --disablerepo=\* --enablerepo=&#x27;mysql*-community*&#x27; list available</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">可安装的软件包</span><br><span class="line">mysql-community-bench.x86_64                                     5.6.34-2.el7                             mysql56-community         </span><br><span class="line">mysql-community-client.i686                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-client.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-common.i686                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-common.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-devel.i686                                       8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-devel.x86_64                                     8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded.i686                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded.x86_64                                  8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-compat.i686                             8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-compat.x86_64                           8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-devel.i686                              8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-devel.x86_64                            8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs.i686                                        8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs.x86_64                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs-compat.i686                                 8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs-compat.x86_64                               8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-release.noarch                                   el7-7                                    mysql57-community         </span><br><span class="line">mysql-community-server.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-test.x86_64                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-connector-odbc.x86_64                                      5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-odbc-debuginfo.x86_64                            5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-odbc-setup.x86_64                                5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python.noarch                                    2.0.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python.x86_64                                    2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python-cext.x86_64                               2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python-debuginfo.x86_64                          2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-router.x86_64                                              2.0.3-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-router-debuginfo.x86_64                                    2.0.3-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-utilities.noarch                                           1.6.4-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-utilities-extra.noarch                                     1.5.6-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-workbench-community.x86_64                                 6.3.8-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-workbench-community-debuginfo.x86_64                       6.3.8-1.el7                              mysql-tools-community</span><br></pre></td></tr></table></figure>

<p>我们可以使用以下命令来安装任何一个软件包，替换 <em>package-name</em> 为你要安装的软件包的名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install package-name</span><br></pre></td></tr></table></figure>

<p>例如：我们要安装 <code>mysql-community-libs</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-libs</span><br></pre></td></tr></table></figure>

<h2 id="禁止更新"><a href="#禁止更新" class="headerlink" title="禁止更新"></a>禁止更新</h2><p>我们在安装之后，为了能够正常运行，我们会禁止MySQL进行更新。因为在yum更新了MySQL之后，MySQL会自动重启。这对于我们来说是没有必要的，所以我们可以屏蔽更新。我们可以这样，将下列指定放到你的<code>/etc/yum.conf</code>文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exclude=mysql-community-client,mysql-community-common,mysql-community-libs,mysql-community-server</span><br></pre></td></tr></table></figure>

<h2 id="更新MySQL"><a href="#更新MySQL" class="headerlink" title="更新MySQL"></a>更新MySQL</h2><p>一般在生产环境，我们都是禁用更新的。所以说，这里只是作为一个参考。<br>我们需要执行的命令就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update mysql-server</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： 在使用 yum 更新之后，MySQL服务器会自动重启。</p>
</blockquote>
<h2 id="更新单个组件"><a href="#更新单个组件" class="headerlink" title="更新单个组件"></a>更新单个组件</h2><p>我们也可以指定更新单个组件。首先我们先运行以下命令来查看MySQL的组件列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@baoguoxiao ~]# yum list installed | grep &quot;^mysql&quot;</span><br><span class="line">mysql-community-client.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-common.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-libs.x86_64      5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-server.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql57-community-release.noarch el7-9                          installed</span><br></pre></td></tr></table></figure>

<p>我们可以使用以下命令来更新任何一个软件包，替换 <em>package-name</em> 为你要安装的软件包的名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update package-name</span><br></pre></td></tr></table></figure>

<p>例如：我们要安装 <code>mysql-community-client</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update mysql-community-client</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面实现了MySQL的默认安装，命令管理，修改密码，屏蔽更新以及更新。希望能对大家有所帮助。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/redis-geo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/redis-geo/" class="post-title-link" itemprop="url">Redis 的 GEO 特性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:14:41" itemprop="dateCreated datePublished" datetime="2017-11-17T16:14:41+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天看文档，无意中发现了 Redis 的一个新功能。<br>Redis 在 3.2 版本实现了一个地理位置计算的特性。</p>
<h2 id="版本要求"><a href="#版本要求" class="headerlink" title="版本要求"></a>版本要求</h2><p>Redis 3.2 或者更新</p>
<h2 id="添加和获取位置"><a href="#添加和获取位置" class="headerlink" title="添加和获取位置"></a>添加和获取位置</h2><h3 id="geoadd-添加位置"><a href="#geoadd-添加位置" class="headerlink" title="geoadd (添加位置)"></a>geoadd (添加位置)</h3><p>这个命令对于经纬度是有要求的:</p>
<ul>
<li>有效的经度从-180度到180度。</li>
<li>有效的纬度从-85.05112878度到85.05112878度。</li>
</ul>
<p>如果超出返回，那么命令就会返回一个错误.</p>
<p>添加命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD location-set longitude latitude name [longitude latitude name ...]</span><br></pre></td></tr></table></figure>

<p>这个可以同时添加多个位置。其中 <strong>location-set</strong> 是存储地理位置的集合名称，<strong>longitude</strong>，<strong>latitude</strong> 和 <strong>name</strong> 则是地理位置的精度、纬度、名字。</p>
<p>下面添加北京的地铁站的坐标：</p>
<p>添加单个位置如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd subways 116.404269 39.906543 qianmen</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>添加多个位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd subways 116.409465 39.939578 nanluoguxiang 116.402549 39.944163 shichahai 116.315934 40.005471 yuanmingyuan 116.399279 40.007208 aolinpikegongyuan</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>

<p>将坐标记录到位置集合之后，我们使用 <code>geopos</code> 命令来获取位置的名字和具体经纬度</p>
<p>获取命令如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOPOS location-set name [name ...]</span><br></pre></td></tr></table></figure>

<p>比如说，如果我们想要获取圆明园、前门的经纬度，那么我们就可以执行以下代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos subways yuanmingyuan qianmen</span><br><span class="line">1) 1) &quot;116.31593316793441772&quot;</span><br><span class="line">   2) &quot;40.00546983911101506&quot;</span><br><span class="line">2) 1) &quot;116.40426903963088989&quot;</span><br><span class="line">   2) &quot;39.90654220698316834&quot;</span><br></pre></td></tr></table></figure>

<h2 id="计算两个点之前的距离"><a href="#计算两个点之前的距离" class="headerlink" title="计算两个点之前的距离"></a>计算两个点之前的距离</h2><p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEODIST location-set location-x location-y [unit]</span><br></pre></td></tr></table></figure>

<p>可选参数 <code>unit</code> 用于指定计算距离时的单位，它的值为下面的一个：</p>
<ul>
<li>m 表示单位为米。</li>
<li>km 表示单位为千米。</li>
<li>mi 表示单位为英里。</li>
<li>ft 表示单位为英尺。</li>
</ul>
<p>比如我们要计算奥林匹克公园和圆明园的距离：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist subways yuanmingyuan aolinpikegongyuan</span><br><span class="line">&quot;7103.4924&quot;</span><br></pre></td></tr></table></figure>

<p>如果我们指定单位为 <strong>km</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist subways yuanmingyuan aolinpikegongyuan km</span><br><span class="line">&quot;7.1035&quot;</span><br></pre></td></tr></table></figure>

<h2 id="获取指定范围内的元素"><a href="#获取指定范围内的元素" class="headerlink" title="获取指定范围内的元素"></a>获取指定范围内的元素</h2><p>Redis 提供了两种方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS location-set longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [ASC|DESC] [COUNT count]</span><br><span class="line"></span><br><span class="line">GEORADIUSBYMEMBER location-set location radius m|km|ft|mi [WITHCOORD] [WITHDIST] [ASC|DESC] [COUNT count]</span><br></pre></td></tr></table></figure>

<p>这两个命令都是用来查找特定范围地点的功能，但是指定中心点的方式不同：<code>georadius</code> 使用的是用户给定的经纬度，而 <code>georadiusbymember</code> 则使用存储在位置集合里面的某个地点作为中心点。</p>
<ul>
<li>m|km|ft|mi 指定的是计算范围时的单位；</li>
<li>如果给定了可选的 WITHCOORD ， 那么命令在返回匹配的位置时会将位置的经纬度一并返回；</li>
<li>如果给定了可选的 WITHDIST ， 那么命令在返回匹配的位置时会将位置与中心点之间的距离一并返回；</li>
<li>在默认情况下， GEORADIUS 和 GEORADIUSBYMEMBER 的结果是未排序的， ASC 可以让查找结果根据距离从近到远排序， 而 DESC 则可以让查找结果根据从远到近排序；</li>
<li>COUNT 参数指定要返回的结果数量。</li>
</ul>
<p>命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：</p>
<ul>
<li>ASC: 根据中心的位置， 按照从近到远的方式返回位置元素。</li>
<li>DESC: 根据中心的位置， 按照从远到近的方式返回位置元素。</li>
</ul>
<p>比如说我们要返回指定坐标的10km内的位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km</span><br><span class="line">1) &quot;qianmen&quot;</span><br><span class="line">2) &quot;nanluoguxiang&quot;</span><br><span class="line">3) &quot;shichahai&quot;</span><br></pre></td></tr></table></figure>

<p>我们还需要获取位置与中心点的距离:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist</span><br><span class="line">1) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">3) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br></pre></td></tr></table></figure>

<p>我们需要返回按照最远距离排序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist desc</span><br><span class="line">1) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">3) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br></pre></td></tr></table></figure>

<p>我们只需要两个就够了，三个太多了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist desc count 2</span><br><span class="line">1) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist count 2</span><br><span class="line">1) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br></pre></td></tr></table></figure>

<p>获取前门10km附近的位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadiusbymember subways qianmen 10 km</span><br><span class="line">1) &quot;qianmen&quot;</span><br><span class="line">2) &quot;nanluoguxiang&quot;</span><br><span class="line">3) &quot;shichahai&quot;</span><br></pre></td></tr></table></figure>

<p>我们只是需要将其坐标换成集合名称中的会员名称就好了，用法跟之前的<code>georadius</code>相同。</p>
<p><code>georadius</code>和<code>georadiusbymember</code>执行的代价并不低，因此强烈建议为查询结果创建缓存。</p>
<h2 id="geohash"><a href="#geohash" class="headerlink" title="geohash"></a><code>geohash</code></h2><p>这个会返回一个11个字符的geohash字符串，使用内部52位表示。返回的geohashes具有以下特性:</p>
<ul>
<li>他们可以缩短从右边的字符。它将失去精度，但仍将指向同一地区。</li>
<li>它可以在 geohash.org 网站使用，网址<a target="_blank" rel="noopener" href="http://geohash.org/">http://geohash.org/</a><geohash-string>。查询例子：<a target="_blank" rel="noopener" href="http://geohash.org/sqdtr74hyu0">http://geohash.org/sqdtr74hyu0</a>.</li>
<li>与类似的前缀字符串是附近，但相反的是不正确的，这是可能的，用不同的前缀字符串附近。</li>
</ul>
<p>命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOHASH key member [member ...]</span><br></pre></td></tr></table></figure>

<p>例如我要查询前门的geohash:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geohash subways qianmen</span><br><span class="line">1) &quot;wx4g0bg02n0&quot;</span><br></pre></td></tr></table></figure>

<p>完了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/ubuntu-16-10-set-ssh-remote-access/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/ubuntu-16-10-set-ssh-remote-access/" class="post-title-link" itemprop="url">ubuntu 16.10 支持ssh远程访问</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 15:21:26" itemprop="dateCreated datePublished" datetime="2017-11-17T15:21:26+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>hell<br>sudo apt-get install openssh-server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后执行启动命令：</span><br><span class="line"></span><br><span class="line">````shell</span><br><span class="line">sudo systemctl start ssh</span><br></pre></td></tr></table></figure>

<h2 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h2><p>我们打开<code>/etc/rc.local</code>，加入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable ssh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果文件中如果有<code>exit 0</code>，一定要在其之前加入。</p>
</blockquote>
<p>这样我们的ubuntu就能正常远程访问了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/16/centos-build-lnmp-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/16/centos-build-lnmp-environment/" class="post-title-link" itemprop="url">如何搭建LNMP环境【编译版】</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 07:57:05" itemprop="dateCreated datePublished" datetime="2017-11-17T07:57:05+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-08 09:11:35" itemprop="dateModified" datetime="2022-04-08T09:11:35+08:00">2022-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="使用的版本"><a href="#使用的版本" class="headerlink" title="使用的版本"></a>使用的版本</h2><ul>
<li><code>centos-7.4</code></li>
<li><code>nginx-1.12.1</code></li>
<li><code>php-7.1.9</code></li>
<li><code>mysql-5.7.19</code></li>
</ul>
<blockquote>
<p>注意：MySQL5.7的安装需要1G的内存！！！否则会安装失败。</p>
</blockquote>
<h2 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h2><p>添加用户(添加用户和用户组 www 和 mysql，并且禁止登录)。</p>
<p>www用户主要是用来赋予nginx和php执行权限，mysql主要是赋予给mysql权限，禁止登录是为了防止用户有权限去操作www和mysql，一切为了安全：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd www</span><br><span class="line">useradd -s /sbin/nologin -g www www</span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -s /sbin/nologin -g mysql mysql</span><br></pre></td></tr></table></figure>

<h3 id="添加预安装包"><a href="#添加预安装包" class="headerlink" title="添加预安装包"></a>添加预安装包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget gcc gcc-c++ pcre-devel openssl-devel libxml2-devel libcurl-devel libjpeg-devel libpng-devel freetype-devel ncurses-devel libicu-devel libxslt-devel autoconf cmake </span><br></pre></td></tr></table></figure>

<p>我一般都会将安装包放到&#x2F;usr&#x2F;local&#x2F;src目录中，所以先执行下面的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br></pre></td></tr></table></figure>

<p>首先我们先下载必需的安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -c http://nginx.org/download/nginx-1.12.1.tar.gz</span><br><span class="line">wget -c http://cn2.php.net/distributions/php-7.1.9.tar.gz</span><br><span class="line">wget -c http://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-boost-5.7.19.tar.gz</span><br></pre></td></tr></table></figure>

<p>安装 nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxf nginx-1.12.1.tar.gz</span><br><span class="line">cd nginx-1.12.1</span><br><span class="line">./configure --user=www --group=www --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-http_gzip_static_module --with-http_sub_module</span><br><span class="line">make &amp;&amp; make install </span><br><span class="line">cd ../</span><br></pre></td></tr></table></figure>

<p>这样nginx就安装完成了，接下来我们安装PHP：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxf php-7.1.6.tar.gz</span><br><span class="line">cd php-7.1.6</span><br><span class="line">./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-config-file-scan-dir=/usr/local/php/conf.d --enable-fpm --with-fpm-user=www --with-fpm-group=www --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv-dir --with-freetype-dir=/usr/local/freetype --with-jpeg-dir --with-png-dir --with-zlib --with-libxml-dir=/usr --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --enable-inline-optimization --with-curl --enable-mbregex --enable-mbstring --enable-intl --enable-pcntl --enable-ftp --with-gd --enable-gd-native-ttf --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-xmlrpc --enable-zip --enable-soap --with-gettext --disable-fileinfo --enable-opcache --with-xsl</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cd ../</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>mcrypt</code>扩展已经过时了大约10年，并且用起来很复杂，所以将在PHP7.1中废弃，并且在PHP7.2中将被从核心代码中移除。所以本次并没有启用<code>mcrypt</code>扩展。</p>
</blockquote>
<p>这样php就安装完成了。然后接下来创建软连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/local/php/bin/php /usr/local/bin/php</span><br></pre></td></tr></table></figure>

<p>复制php.ini配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/php-7.1.6/php.ini-production /usr/local/php/etc/php.ini</span><br></pre></td></tr></table></figure>

<p>这时候php就已经安装完成了。接下来就是启用php-fpm服务了。</p>
<p>首先生成配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</span><br><span class="line">mv /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>

<p>启动php-fpm的准备工作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/src/php-7.1.6/sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line">chmod +x /etc/init.d/php-fpm</span><br><span class="line">chkconfig php-fpm on</span><br></pre></td></tr></table></figure>

<p>这个时候，使用如下命令就可以启动php-fpm了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service php-fpm start</span><br></pre></td></tr></table></figure>

<p>启动起来之后，编辑nginx配置文件，实现nginx的代理访问，找到如下代码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="comment">#   root           html;</span></span><br><span class="line"><span class="comment">#  fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line"><span class="comment">#  fastcgi_index  index.php;</span></span><br><span class="line"><span class="comment">#  fastcgi_param  SCRIPT_FILENAME  /script$fastcgi_script_name;</span></span><br><span class="line"><span class="comment">#  include        fastcgi_params;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>
<p>把前面的#注释符号去掉，把script改成$document_root，第二行 html 改成你的项目路径，这里我设置的<code>/home/www/default</code>，你也可以设置自己喜欢的目录 最终代码如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    root           /home/www/default<span class="comment">;</span></span><br><span class="line">    fastcgi_pass   127.0.0.1:9000<span class="comment">;</span></span><br><span class="line">    fastcgi_index  index.php<span class="comment">;</span></span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  /$document_root$fastcgi_script_name<span class="comment">;</span></span><br><span class="line">    include        fastcgi_params<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改完成之后，先执行nginx配置检测命令，如果没有错误就执行重新加载配置文件的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t #配置检测命令</span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload #动态加载配置命令</span><br></pre></td></tr></table></figure>

<p>我们去<code>/home/www/default</code>目录下创建一个php文件。浏览一下是否正常：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>记得对<code>/home/www/default</code>进行赋予 <strong><a target="_blank" rel="noopener" href="http://www.www/">www.www</a></strong> 权限:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown www.www /home/www/default -R</span><br></pre></td></tr></table></figure>

<p>如果能正确的显示php的当前信息，就说明我们工作已经完成了一大半了。下面接下来安装mysql：</p>
<p>mysql5.7.5之后版本都要安装boost包。所以我选择是下载已经自带boost安装包的mysql安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf mysql-boost-5.7.18.tar.gz</span><br><span class="line">cd mysql-5.7.18/</span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DSYSCONFDIR=/etc -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_EMBEDDED_SERVER=1 -DENABLED_LOCAL_INFILE=1 -DWITH_BOOST=boost -DENABLE_DOWNLOADS=1</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">chown -R mysql:mysql /usr/local/mysql #对mysql目录进行赋予权限</span><br><span class="line">cd ../</span><br></pre></td></tr></table></figure>

<p>mysql configure 安装参数解释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-DCMAKE_INSTALL_PREFIX=/usr/local/mysql #指定安装路径</span><br><span class="line">-DDEFAULT_CHARSET=utf8mb4 #默认使用utf8mb4字符</span><br><span class="line">-DDEFAULT_COLLATION=utf8mb4_general_ci #校验字符</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 #安装innodb引擎 </span><br><span class="line">-DWITH_BOOST=boost #指定boost的安装位置</span><br><span class="line">-DENABLE_DOWNLOADS #是否要下载可选的文件。例如，启用此选项（设置为1），cmake将下载谷歌所使用的测试套件运行单元测试。</span><br></pre></td></tr></table></figure>

<p>生成mysql配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure>

<p>对数据库进行初始化，这个时候初始化的时候，屏幕上会出现初始化的密码，记下来，如果错过了，可以通过查看<code>/root/.mysql_secret</code>来查看之前的初始化密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqld --initialize --user=mysql</span><br></pre></td></tr></table></figure>

<p>复制文件mysql.server 可以使用service 命令进行控制</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">service mysql start #启动mysql</span><br></pre></td></tr></table></figure>

<p>登录数据库修改密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysql -u root -p</span><br></pre></td></tr></table></figure>

<p>输入密码回车。登录成功后，输入以下字符，来修改密码，比如我要修改密码为<code>root</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="operator">=</span> password(<span class="string">&#x27;root&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>写一个php程序，来测试mysql是否能否正常连上MySQL：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:host=127.0.0.1;dbname=sys;port=3306&quot;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="keyword">array</span>(PDO::<span class="variable constant_">MYSQL_ATTR_INIT_COMMAND</span> =&gt; <span class="string">&#x27;set names utf8mb4&#x27;</span>, PDO::<span class="variable constant_">ATTR_TIMEOUT</span> =&gt; <span class="number">1</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$pdo</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果连接正常。那就表示我们的环境已经搭建完成了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备13027795号-1 </a>
  </div>

<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魔王卷子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
