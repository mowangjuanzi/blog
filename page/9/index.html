<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.baoguoxiao.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录我的工作中碰到的坑">
<meta property="og:type" content="website">
<meta property="og:title" content="魔王卷子">
<meta property="og:url" content="http://www.baoguoxiao.com/page/9/index.html">
<meta property="og:site_name" content="魔王卷子">
<meta property="og:description" content="记录我的工作中碰到的坑">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="魔王卷子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.baoguoxiao.com/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>魔王卷子</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">魔王卷子</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">魔王卷子</p>
  <div class="site-description" itemprop="description">记录我的工作中碰到的坑</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">96</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">102</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/php-compile-pdo-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/php-compile-pdo-mysql/" class="post-title-link" itemprop="url">php编译pdo_mysql扩展记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:44" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:44+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这次作死，直接用默认配置安装了php。什么扩展都没有添加。结果一直在编译缺失的各种扩展。但是最后还是失败了，仅用做记录用。</p>
<p>在编译到pdo_mysql扩展的时候，就搞不定了。</p>
<p>在进行<code>make</code>操作的时候，出现了如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/php_pdo_mysql_int.h:27:34: 致命错误：ext/mysqlnd/mysqlnd.h：没有那个文件或目录</span><br><span class="line"> # include &quot;ext/mysqlnd/mysqlnd.h&quot;</span><br><span class="line">                                  ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<h2 id="这是走的弯路"><a href="#这是走的弯路" class="headerlink" title="这是走的弯路"></a>这是走的弯路</h2><p>我以为是mysqlnd没有编译，我接着去编译mysqlnd扩展了。</p>
<p>然后在<code>./configure</code>的时候，结果又提示我：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: Cannot find OpenSSL&#x27;s &lt;evp.h&gt;</span><br></pre></td></tr></table></figure>

<p>我以为是openssl-devel没有安装，我接着安装openssl-devel:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon mysqlnd]# yum install openssl openssl-devel</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.bit.edu.cn</span><br><span class="line"> * epel: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * extras: mirror.bit.edu.cn</span><br><span class="line"> * updates: mirror.bit.edu.cn</span><br><span class="line">软件包 1:openssl-1.0.1e-60.el7.x86_64 已安装并且是最新版本</span><br><span class="line">软件包 1:openssl-devel-1.0.1e-60.el7.x86_64 已安装并且是最新版本</span><br><span class="line">无须任何处理</span><br></pre></td></tr></table></figure>

<p>结果提示我已经安装了，那我强行指定路径吧：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon mysqlnd]# ./configure --with-openssl=/usr/include/openssl</span><br><span class="line">configure: WARNING: unrecognized options: --with-openssl</span><br><span class="line">checking for grep that handles long lines and -e... /usr/bin/grep</span><br><span class="line">checking for egrep... /usr/bin/grep -E</span><br><span class="line">checking for a sed that does not truncate output... /usr/bin/sed</span><br><span class="line">checking for cc... cc</span><br><span class="line">checking whether the C compiler works... yes</span><br><span class="line">checking for C compiler default output file name... a.out</span><br><span class="line">checking for suffix of executables... </span><br><span class="line">checking whether we are cross compiling... no</span><br><span class="line">checking for suffix of object files... o</span><br><span class="line">checking whether we are using the GNU C compiler... yes</span><br><span class="line">checking whether cc accepts -g... yes</span><br><span class="line">checking for cc option to accept ISO C89... none needed</span><br><span class="line">checking how to run the C preprocessor... cc -E</span><br><span class="line">checking for icc... no</span><br><span class="line">checking for suncc... no</span><br><span class="line">checking whether cc understands -c and -o together... yes</span><br><span class="line">checking for system library directory... lib</span><br><span class="line">checking if compiler supports -R... no</span><br><span class="line">checking if compiler supports -Wl,-rpath,... yes</span><br><span class="line">checking build system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking host system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking target system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking for PHP prefix... /usr/local/php</span><br><span class="line">checking for PHP includes... -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib</span><br><span class="line">checking for PHP extension directory... /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012</span><br><span class="line">checking for PHP installed headers prefix... /usr/local/php/include/php</span><br><span class="line">checking if debug is enabled... no</span><br><span class="line">checking if zts is enabled... no</span><br><span class="line">checking for re2c... no</span><br><span class="line">configure: WARNING: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers.</span><br><span class="line">checking for gawk... gawk</span><br><span class="line">checking whether to enable mysqlnd... yes, shared</span><br><span class="line">checking whether to disable compressed protocol support in mysqlnd... yes</span><br><span class="line">checking for the location of libz... no</span><br><span class="line">checking for DSA_get_default_method in -lssl... no</span><br><span class="line">checking for X509_free in -lcrypto... yes</span><br><span class="line">checking for pkg-config... /usr/bin/pkg-config</span><br><span class="line">configure: error: Cannot find OpenSSL&#x27;s &lt;evp.h&gt;</span><br></pre></td></tr></table></figure>

<p>结果还是不行，这下两边路都走不通了，我就去网上查询了。结果还是查询不到什么有用的资料</p>
<h2 id="转回正道"><a href="#转回正道" class="headerlink" title="转回正道"></a>转回正道</h2><p>我后来想，我直接改源码试试看呢，把<code>include</code>加载文件写成绝对目录。</p>
<p>说干就干</p>
<p>我先看看这个报错的地方。</p>
<p>文件在**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;php_pdo_mysql_int.h:27:34**</p>
<p>我打开该文件，修改第27行的内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;ext/mysqlnd/mysqlnd.h&quot;</span></span></span><br><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;ext/mysqlnd/mysqlnd_libmysql_compat.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我的源代码的目录是**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;**，于是我就改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd.h&quot;</span></span></span><br><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_libmysql_compat.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我再进行编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">In file included from /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c:32:0:</span><br><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/php_pdo_mysql_int.h:69:39: 致命错误：ext/mysqlnd/mysqlnd_debug.h：没有那个文件或目录</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">include <span class="string">&quot;ext/mysqlnd/mysqlnd_debug.h&quot;</span></span></span><br><span class="line">                                       ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<p>发现有效果，报错的地方变了，我接着改，这里提示报错的地方还是：**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;php_pdo_mysql_int.h:69:39**，但是行数编程69了，我把69行改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_debug.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>继续，发现报错信息又变了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make </span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c:64:45: 致命错误：ext/mysqlnd/mysqlnd_reverse_api.h：没有那个文件或目录</span><br><span class="line"> #include &quot;ext/mysqlnd/mysqlnd_reverse_api.h&quot;</span><br><span class="line">                                             ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<p>我将文件**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;pdo_mysql.c:64:45**改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_reverse_api.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>继续编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make </span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_driver.c -o mysql_driver.lo </span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_driver.c  -fPIC -DPIC -o .libs/mysql_driver.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_statement.c -o mysql_statement.lo </span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_statement.c  -fPIC -DPIC -o .libs/mysql_statement.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=link cc -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -o pdo_mysql.la -export-dynamic -avoid-version -prefer-pic -module -rpath /usr/local/src/php-7.0.14/ext/pdo_mysql/modules  pdo_mysql.lo mysql_driver.lo mysql_statement.lo </span><br><span class="line">cc -shared  .libs/pdo_mysql.o .libs/mysql_driver.o .libs/mysql_statement.o   -Wl,-soname -Wl,pdo_mysql.so -o .libs/pdo_mysql.so</span><br><span class="line">creating pdo_mysql.la</span><br><span class="line">(cd .libs &amp;&amp; rm -f pdo_mysql.la &amp;&amp; ln -s ../pdo_mysql.la pdo_mysql.la)</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=install cp ./pdo_mysql.la /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line">cp ./.libs/pdo_mysql.so /usr/local/src/php-7.0.14/ext/pdo_mysql/modules/pdo_mysql.so</span><br><span class="line">cp ./.libs/pdo_mysql.lai /usr/local/src/php-7.0.14/ext/pdo_mysql/modules/pdo_mysql.la</span><br><span class="line">PATH=&quot;$PATH:/sbin&quot; ldconfig -n /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Libraries have been installed in:</span><br><span class="line">   /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line"></span><br><span class="line">If you ever happen to want to link against installed libraries</span><br><span class="line">in a given directory, LIBDIR, you must either use libtool, and</span><br><span class="line">specify the full pathname of the library, or use the `-LLIBDIR&#x27;</span><br><span class="line">flag during linking and do at least one of the following:</span><br><span class="line">   - add LIBDIR to the `LD_LIBRARY_PATH&#x27; environment variable</span><br><span class="line">     during execution</span><br><span class="line">   - add LIBDIR to the `LD_RUN_PATH&#x27; environment variable</span><br><span class="line">     during linking</span><br><span class="line">   - use the `-Wl,--rpath -Wl,LIBDIR&#x27; linker flag</span><br><span class="line">   - have your system administrator add LIBDIR to `/etc/ld.so.conf&#x27;</span><br><span class="line"></span><br><span class="line">See any operating system documentation about shared libraries for</span><br><span class="line">more information, such as the ld(1) and ld.so(8) manual pages.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build complete.</span><br><span class="line">Don&#x27;t forget to run &#x27;make test&#x27;.</span><br></pre></td></tr></table></figure>

<p>这样就成功了。接下来我们就可以继续<code>make install</code>进行安装了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make install</span><br><span class="line">Installing shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/</span><br></pre></td></tr></table></figure>

<p>我们修改一下配置文件，添加下面的内容到配置文件中：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extension</span>=pdo_mysql.so</span><br></pre></td></tr></table></figure>

<p>然后我们测试扩展是否安装成功了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# php -m</span><br><span class="line">PHP Warning:  Module &#x27;PDO&#x27; already loaded in Unknown on line 0</span><br><span class="line"></span><br><span class="line">Warning: Module &#x27;PDO&#x27; already loaded in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so&#x27; - /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so: undefined symbol: mysqlnd_allocator in Unknown on line 0</span><br><span class="line"></span><br><span class="line">Warning: PHP Startup: Unable to load dynamic library &#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so&#x27; - /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so: undefined symbol: mysqlnd_allocator in Unknown on line 0</span><br></pre></td></tr></table></figure>

<p>报错了。看来我们还需要mysqlnd扩展：</p>
<p>然后还是提示找不到openssl的错误。</p>
<p>我接着去网上搜了一下。</p>
<p>还是找不到答案，我查了一下，这个好像是一个bug，一直没有修复。</p>
<p>解决办法只能是重装php来解决了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/nginx-manager-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/nginx-manager-command/" class="post-title-link" itemprop="url">nginx 设置管理命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:36" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:36+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">web服务器</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="nginx管理命令："><a href="#nginx管理命令：" class="headerlink" title="nginx管理命令："></a>nginx管理命令：</h2><blockquote>
<p>我不是生产者，我只是大自然的搬运工。<br>以下脚本来自<a target="_blank" rel="noopener" href="https://lnmp.org/">LNMP一键安装包</a>中军哥的一键安装脚本。感谢军哥的辛勤劳动。</p>
</blockquote>
<p>首先我们先用<strong>vim</strong>或者<strong>vi</strong>打开<code>/etc/init.d/nginx</code>;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure>

<p>然后按<strong>i</strong>进入编辑模式，将以下内容复制到该文件里面：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 2345 55 25</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description: Startup script <span class="keyword">for</span> nginx webserver on Debian. Place <span class="keyword">in</span> /etc/init.d and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run <span class="string">&#x27;update-rc.d -f nginx defaults&#x27;</span>, or use the appropriate <span class="built_in">command</span> on your</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distro. For CentOS/RedHat run: <span class="string">&#x27;chkconfig --add nginx&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Provides:          nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Required-Start:    <span class="variable">$all</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Required-Stop:     <span class="variable">$all</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Stop:      0 1 6</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Short-Description: starts the nginx web server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description:       starts nginx using start-stop-daemon</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Author:   licess</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">website:  http://lnmp.org</span></span><br><span class="line"></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">NAME=nginx</span><br><span class="line">NGINX_BIN=/usr/local/nginx/sbin/$NAME</span><br><span class="line">CONFIGFILE=/usr/local/nginx/conf/$NAME.conf</span><br><span class="line">PIDFILE=/usr/local/nginx/logs/$NAME.pid</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        echo -n &quot;Starting $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if netstat -tnpl | grep -q nginx;then</span><br><span class="line">            echo &quot;$NAME (pid `pidof $NAME`) already running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -c $CONFIGFILE</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    stop)</span><br><span class="line">        echo -n &quot;Stoping $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if ! netstat -tnpl | grep -q nginx; then</span><br><span class="line">            echo &quot;$NAME is not running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -s stop</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed. Use force-quit&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    status)</span><br><span class="line">        if netstat -tnpl | grep -q nginx; then</span><br><span class="line">            PID=`pidof nginx`</span><br><span class="line">            echo &quot;$NAME (pid $PID) is running...&quot;</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$NAME is stopped&quot;</span><br><span class="line">            exit 0</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    force-quit)</span><br><span class="line">        echo -n &quot;Terminating $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if ! netstat -tnpl | grep -q nginx; then</span><br><span class="line">            echo &quot;$NAME is not running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        kill `pidof $NAME`</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    restart)</span><br><span class="line">        $0 stop</span><br><span class="line">        sleep 1</span><br><span class="line">        $0 start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    reload)</span><br><span class="line">        echo -n &quot;Reload service $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if netstat -tnpl | grep -q nginx; then</span><br><span class="line">            $NGINX_BIN -s reload</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$NAME is not running, can&#x27;t reload.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    configtest)</span><br><span class="line">        echo -n &quot;Test $NAME configure files... &quot;</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -t</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Usage: $0 &#123;start|stop|force-quit|restart|reload|status|configtest&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>然后保存退出。接着执行赋予执行权限命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/init.d/nginx</span><br></pre></td></tr></table></figure>

<p>这样我们就可以执行管理命令了。比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx start</span><br><span class="line">service nginx stop</span><br></pre></td></tr></table></figure>

<p>具体我们可以执行<code>service nginx</code>查看。</p>
<p>我们还可以设置开机启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig nginx on</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/sql-sql-doubly-linked-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/sql-sql-doubly-linked-list/" class="post-title-link" itemprop="url">SPL标准库之SplDoublyLinkedList（双向链表）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:13" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:13+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>双向链表其实就是数据本身具备了左边和右边的双向指针。类似Redis的列表，它就是双向链表。</p>
<p>我们现在就学习一下SPL内置的SplDoublyLinkedList类。</p>
<p>首先介绍一下这个类都有哪些方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化方法</span></span><br><span class="line"><span class="variable">$dll</span> = <span class="keyword">new</span> <span class="built_in">SplDoublyLinkedList</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//尾部增加数据,类似array_push()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">push</span>(<span class="variable">$value</span>);</span><br><span class="line"><span class="comment">//开头插入数据,类似array_unshift()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">unshift</span>(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//检测指定位置是否存在值,类似array_key_exists()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetExists</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="comment">//获取指定位置的值,类似$dll[$key]</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetGet</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="comment">//修改指定位置的值,类似$dll[$key] = $value</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetSet</span>(<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line"><span class="comment">//删除指定位置的值,类似unset($dll[$key])</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetUnset</span>(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取双向链表中值的数量</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">count</span>();</span><br><span class="line"><span class="comment">//检测双向链表是否为空</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">isEmpty</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//序列化存储,类似serialize()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">serialize</span>();</span><br><span class="line"><span class="comment">//存储反序列化类似unserialize()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置迭代器模式</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">setIteratorMode</span>(<span class="variable">$mode</span>);</span><br><span class="line"><span class="comment">//获取迭代器模式</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">getIteratorMode</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化链表,只有先执行此方法，才能使用操作游标的方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">rewind</span>();</span><br><span class="line"><span class="comment">//获取当前游标的索引</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">key</span>();</span><br><span class="line"><span class="comment">//获取当前游标的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">current</span>();</span><br><span class="line"><span class="comment">//将游标移动到下一个节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">next</span>();</span><br><span class="line"><span class="comment">//将游标移动到上一个节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">prev</span>();</span><br><span class="line"><span class="comment">//检测当前游标后面是否还有节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">valid</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回第一个节点的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">bottom</span>();</span><br><span class="line"><span class="comment">//返回最后一个节点的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">top</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//将双向链表中的最后一个节点弹出,类似array_pop()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">pop</span>();</span><br><span class="line"><span class="comment">//将双向链表中的第一个节点弹出,类似array_shift()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">shift</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//在双向链表的指定位置插入值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="variable">$index</span>, <span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Iterator-模式"><a href="#Iterator-模式" class="headerlink" title="Iterator 模式"></a>Iterator 模式</h2><ul>
<li>迭代的方向：<ul>
<li><code>SplDoublyLinkedList::IT_MODE_LIFO</code> (堆栈 style)</li>
<li><code>SplDoublyLinkedList::IT_MODE_FIFO</code> (队列 style)</li>
</ul>
</li>
<li>迭代器的行为<ul>
<li><code>SplDoublyLinkedList::IT_MODE_DELETE</code> (元素由迭代器删除)</li>
<li><code>SplDoublyLinkedList::IT_MODE_KEEP</code> (元素由迭代器遍历)</li>
</ul>
</li>
</ul>
<p>默认模式是：<code>SplDoublyLinkedList::IT_MODE_FIFO | SplDoublyLinkedList::IT_MODE_KEEP</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/centos-shell-install-php-composer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/centos-shell-install-php-composer/" class="post-title-link" itemprop="url">shell 安装 composer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:27:26" itemprop="dateCreated datePublished" datetime="2017-11-17T16:27:26+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>安装composer，最好需要有php的软连接。</p>
<p>先执行一下以下命令查看是否<code>php</code>命令已经软连接好了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@68 ~]# which php</span><br><span class="line">/usr/bin/which: no php in (/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin)</span><br></pre></td></tr></table></figure>

<p>如果是这样，表示并不能直接使用php。我们这个时候需要对<code>php</code>做软连接。</p>
<p>我的<code>php</code>的路径在**&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin&#x2F;php**。所以命令就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sf /usr/local/php/bin/php /usr/local/bin/php</span><br></pre></td></tr></table></figure>

<p>然后我再执行一下开头的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@68 bin]# which php</span><br><span class="line">/usr/local/bin/php</span><br></pre></td></tr></table></figure>

<p>好了。这样就可以进行安装了。我们仅仅需要下面这一条命令就可以了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer</span><br></pre></td></tr></table></figure>

<p>当显示如下效果的时候，就表示安装完成了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">All settings correct for using Composer</span><br><span class="line">Downloading...</span><br><span class="line"></span><br><span class="line">Composer (version 1.3.0) successfully installed to: /usr/local/bin/composer</span><br><span class="line">Use it: php /usr/local/bin/composer</span><br></pre></td></tr></table></figure>

<p>这样我们就可以使用composer进行类库安装了。</p>
<h2 id="修改为国内镜像"><a href="#修改为国内镜像" class="headerlink" title="修改为国内镜像"></a>修改为国内镜像</h2><p>全局修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://packagist.phpcomposer.com</span><br></pre></td></tr></table></figure>

<h2 id="碰到的问题"><a href="#碰到的问题" class="headerlink" title="碰到的问题"></a>碰到的问题</h2><ul>
<li><code>phar &quot;/usr/local/bin/composer&quot; has a broken signature</code> 错误:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PHP Fatal error:  Uncaught exception &#x27;PharException&#x27; with message &#x27;phar &quot;/usr/local/bin/composer&quot; has a broken signature&#x27; in /usr/local/bin/composer:23</span><br><span class="line">Stack trace:</span><br><span class="line">#0 /usr/local/bin/composer(23): Phar::mapPhar(&#x27;composer.phar&#x27;)</span><br><span class="line">#1 &#123;main&#125;</span><br><span class="line">  thrown in /usr/local/bin/composer on line 23</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>：删除文件包，重新安装。</p>
<ul>
<li>php缺失<code>openssl</code>扩展:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Some settings on your machine make Composer unable to work properly.</span><br><span class="line">Make sure that you fix the issues listed below and run this script again:</span><br><span class="line"></span><br><span class="line">The openssl extension is missing, which means that secure HTTPS transfers are impossible.</span><br><span class="line">If possible you should enable it or recompile php with --with-openssl</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>: PHP安装<code>openssl</code>扩展。</p>
<ul>
<li>php缺失<code>zlib</code>扩展:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The zlib extension is not loaded, this can slow down Composer a lot.</span><br><span class="line">If possible, install it or recompile php with --with-zlib</span><br><span class="line"></span><br><span class="line">The php.ini used by your command-line PHP is: /usr/local/php/etc/php.ini</span><br><span class="line">If you can not modify the ini file, you can also run `php -d option=value` to modify ini values on the fly. You can use -d multiple times.</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>: PHP安装<code>zlib</code>扩展。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/elasticsearch-php-sdk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/elasticsearch-php-sdk/" class="post-title-link" itemprop="url">Elasticsearch（2）PHP驱动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:27:19" itemprop="dateCreated datePublished" datetime="2017-11-17T16:27:19+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>安装完成composer之后。我们需要安装php的类库来对Elasticsearch进行连接。</p>
<p>我们现在需要使用的是<a target="_blank" rel="noopener" href="https://packagist.org/packages/elasticsearch/elasticsearch">elasticsearch&#x2F;elasticsearch</a>。</p>
<p>比如我们的项目目录在 <strong>&#x2F;data&#x2F;project&#x2F;elastic</strong>。</p>
<p>我们就可以在这个目录下执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require elasticsearch/elasticsearch</span><br></pre></td></tr></table></figure>

<p>如果出现如下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Using version ^5.0 for elasticsearch/elasticsearch</span><br><span class="line">./composer.json has been updated</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Updating dependencies (including require-dev)</span><br><span class="line">Package operations: 5 installs, 0 updates, 0 removals</span><br><span class="line">  - Installing react/promise (v2.5.0) Downloading: 100%         </span><br><span class="line">  - Installing guzzlehttp/streams (3.0.0) Downloading: 100%         </span><br><span class="line">  - Installing guzzlehttp/ringphp (1.1.0) Downloading: 100%         </span><br><span class="line">  - Installing psr/log (1.0.2) Downloading: 100%         </span><br><span class="line">  - Installing elasticsearch/elasticsearch (v5.0.0) Downloading: 100%         </span><br><span class="line">elasticsearch/elasticsearch suggests installing monolog/monolog (Allows for client-level logging and tracing)</span><br><span class="line">Writing lock file</span><br><span class="line">Generating autoload files</span><br></pre></td></tr></table></figure>

<p>就表示已经安装成功了。</p>
<p>接下来我们编辑如下文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;./vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span> = <span class="title class_">Elasticsearch\ClientBuilder</span>::<span class="title function_ invoke__">create</span>();</span><br><span class="line"><span class="variable">$client</span>-&gt;<span class="title function_ invoke__">setHosts</span>([<span class="string">&#x27;127.0.0.1&#x27;</span>]);</span><br><span class="line"><span class="variable">$client</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">build</span>();</span><br><span class="line"><span class="variable">$info</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后保存为<strong>index.php</strong>。我们可以通过访问该文件来确认是否请求成功了。</p>
<p>然后我们执行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@68 elastic]# php index.php </span><br><span class="line">array(5) &#123;</span><br><span class="line">  [&quot;name&quot;]=&gt;</span><br><span class="line">  string(7) &quot;ZQZ38Da&quot;</span><br><span class="line">  [&quot;cluster_name&quot;]=&gt;</span><br><span class="line">  string(13) &quot;elasticsearch&quot;</span><br><span class="line">  [&quot;cluster_uuid&quot;]=&gt;</span><br><span class="line">  string(22) &quot;FuPCyv2ZSimGYxAo_nLvpw&quot;</span><br><span class="line">  [&quot;version&quot;]=&gt;</span><br><span class="line">  array(5) &#123;</span><br><span class="line">    [&quot;number&quot;]=&gt;</span><br><span class="line">    string(5) &quot;5.1.1&quot;</span><br><span class="line">    [&quot;build_hash&quot;]=&gt;</span><br><span class="line">    string(7) &quot;5395e21&quot;</span><br><span class="line">    [&quot;build_date&quot;]=&gt;</span><br><span class="line">    string(24) &quot;2016-12-06T12:36:15.409Z&quot;</span><br><span class="line">    [&quot;build_snapshot&quot;]=&gt;</span><br><span class="line">    bool(false)</span><br><span class="line">    [&quot;lucene_version&quot;]=&gt;</span><br><span class="line">    string(5) &quot;6.3.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;tagline&quot;]=&gt;</span><br><span class="line">  string(20) &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就表示我们的驱动已经安装并且连接完成了。</p>
<blockquote>
<p>具体的文档我们可点击：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/index.html">https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/index.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/javascript-time-string-to-timestamp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/javascript-time-string-to-timestamp/" class="post-title-link" itemprop="url">记一次js处理时间字符串转为时间戳的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:48" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:48+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天朋友问我，js应该如何将时间字符串转为时间戳。</p>
<p>我下意识就去百度，结果找到的，写法却是复杂无比，比如下面这个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">    $.<span class="title function_">extend</span>(&#123;</span><br><span class="line">        <span class="attr">myTime</span>: &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 当前时间戳</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> &lt;int&gt;        unix时间戳(秒)  </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">CurTime</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Date</span>.<span class="title function_">parse</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())/<span class="number">1000</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">/**              </span></span><br><span class="line"><span class="comment">             * 日期 转换为 UNIX时间戳</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;string&gt; 2014-01-01 20:20:20  日期格式              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> &lt;int&gt;        unix时间戳(秒)              </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">DateToUnix</span>: <span class="keyword">function</span>(<span class="params">string</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> f = string.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>, <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">var</span> d = (f[<span class="number">0</span>] ? f[<span class="number">0</span>] : <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="keyword">var</span> t = (f[<span class="number">1</span>] ? f[<span class="number">1</span>] : <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Date</span>(</span><br><span class="line">                        <span class="built_in">parseInt</span>(d[<span class="number">0</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        (<span class="built_in">parseInt</span>(d[<span class="number">1</span>], <span class="number">10</span>) || <span class="number">1</span>) - <span class="number">1</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(d[<span class="number">2</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">0</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">1</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">2</span>], <span class="number">10</span>) || <span class="literal">null</span></span><br><span class="line">                        )).<span class="title function_">getTime</span>() / <span class="number">1000</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">/**              </span></span><br><span class="line"><span class="comment">             * 时间戳转换日期              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;int&gt; unixTime    待时间戳(秒)              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;bool&gt; isFull    返回完整时间(Y-m-d 或者 Y-m-d H:i:s)              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;int&gt;  timeZone   时区              </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">UnixToDate</span>: <span class="keyword">function</span>(<span class="params">unixTime, isFull, timeZone</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (timeZone) == <span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    unixTime = <span class="built_in">parseInt</span>(unixTime) + <span class="built_in">parseInt</span>(timeZone) * <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="title class_">Date</span>(unixTime * <span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">var</span> ymdhis = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                ymdhis += time.<span class="title function_">getUTCFullYear</span>() + <span class="string">&quot;-&quot;</span>;</span><br><span class="line">                ymdhis += (time.<span class="title function_">getUTCMonth</span>()+<span class="number">1</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line">                ymdhis += time.<span class="title function_">getUTCDate</span>();</span><br><span class="line">                <span class="keyword">if</span> (isFull === <span class="literal">true</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    ymdhis += <span class="string">&quot; &quot;</span> + time.<span class="title function_">getUTCHours</span>() + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">                    ymdhis += time.<span class="title function_">getUTCMinutes</span>() + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">                    ymdhis += time.<span class="title function_">getUTCSeconds</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ymdhis;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>

<p>看起来就非常的麻烦。于是我想到去官方文档去了一下，还真让我找到了。于是写了这么一个demo，这里我们并不需要将时间戳转化为字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//时间字符串转化为时间戳</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">str2time</span>(<span class="params">data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span> (data.<span class="property">length</span> == <span class="number">10</span>) &#123;</span><br><span class="line">		data += <span class="string">&#x27; 00:00:00&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(data);</span><br><span class="line">	<span class="keyword">return</span> (date.<span class="title function_">getTime</span>() / <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么一个简单的工作就完成了。</p>
<p>在这里要注意的一个坑就是，注意服务器的时区是否跟浏览器的时区相同，如果不同，那么显示的时间跟服务器就会有几个小时的误差。具体的误差就看差着几个时区了。</p>
<p>我这里对于这个也是抛砖引玉。</p>
<p>具体复杂的，可以看看我列出的参考连接。就是在<code>new Date</code>注意看看传入的值就好了。</p>
<blockquote>
<p>参考文档：</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/jquery-form-input-to-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/jquery-form-input-to-object/" class="post-title-link" itemprop="url">jq将form 表单数据转为object</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:22" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:22+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/jquery/" itemprop="url" rel="index"><span itemprop="name">jquery</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我平常上传数据都是使用<code>$(this).serialize()</code>，但是这次我需要使用上传数据的对象。结果这个方法给我转成了字符串。特别不方便。于是找到一个插件。就可以实现，获取的时候，获取到的是对象而不是字符串了。</p>
<p>首先，我们先加载jquery;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在后面写一个js方法就好了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$.fn.<span class="property">serializeObject</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> o = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> a = <span class="variable language_">this</span>.<span class="title function_">serializeArray</span>();</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">each</span>(a, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (o[<span class="variable language_">this</span>.<span class="property">name</span>] !== <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!o[<span class="variable language_">this</span>.<span class="property">name</span>].<span class="property">push</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                o[<span class="variable language_">this</span>.<span class="property">name</span>] = [o[<span class="variable language_">this</span>.<span class="property">name</span>]];</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            o[<span class="variable language_">this</span>.<span class="property">name</span>].<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">value</span> || <span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            o[<span class="variable language_">this</span>.<span class="property">name</span>] = <span class="variable language_">this</span>.<span class="property">value</span> || <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> o;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样我们直接就可以获取对象了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(form).<span class="title function_">serializeObject</span>();</span><br></pre></td></tr></table></figure>

<p>这样我们获取到的数据直接就是对象了。</p>
<blockquote>
<p>参考资料：</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery">http://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery</a></li>
<li><a target="_blank" rel="noopener" href="http://www.thinksaas.cn/topics/0/345/345610.html">http://www.thinksaas.cn/topics/0/345/345610.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/sublime-text-3-install-package-control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/sublime-text-3-install-package-control/" class="post-title-link" itemprop="url">sublime text 3 安装 package control</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:17" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:17+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/sublime-text/" itemprop="url" rel="index"><span itemprop="name">sublime text</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我使用sublime，想要使用插件，还是得使用它的商店。</p>
<p>商店默认是不会安装的，于是我就是网上搜索，尝试安装一下。</p>
<p>我用的是这个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">&#x27;2915d1851351e5ee549c20394736b442&#x27;</span> + <span class="string">&#x27;8bc59f460fa1548d1514676163dafc88&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="built_in">open</span>(os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by)</span><br></pre></td></tr></table></figure>

<p>结果我执行之后，发现提示这个错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error validating download (got df21e130d211cfc94d9b0905775a7c0f1e3d39e33b79698005270310898eea76 instead of 2915d1851351e5ee549c20394736b4428bc59f460fa1548d1514676163dafc88), please <span class="keyword">try</span> manual install</span><br></pre></td></tr></table></figure>

<p>顿时觉得不行了。我觉得我还是得找谷歌，于是我去外国网站，找了一个，嘿嘿，还真安装上了。现提供命令如下：</p>
<p>sublime3：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">&#x27;df21e130d211cfc94d9b0905775a7c0f&#x27;</span> + <span class="string">&#x27;1e3d39e33b79698005270310898eea76&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="built_in">open</span>(os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by)</span><br></pre></td></tr></table></figure>

<p>sublime2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2,os,hashlib; h = <span class="string">&#x27;df21e130d211cfc94d9b0905775a7c0f&#x27;</span> + <span class="string">&#x27;1e3d39e33b79698005270310898eea76&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); os.makedirs( ipp ) <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ipp) <span class="keyword">else</span> <span class="literal">None</span>; urllib2.install_opener( urllib2.build_opener( urllib2.ProxyHandler()) ); by = urllib2.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">open</span>( os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by) <span class="keyword">if</span> dh == h <span class="keyword">else</span> <span class="literal">None</span>; <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="string">&#x27;Please restart Sublime Text to finish installation&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>完毕，收工。</p>
<p>参考网址：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://packagecontrol.io/installation#st2">https://packagecontrol.io/installation#st2</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/mysql-reset-password/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/mysql-reset-password/" class="post-title-link" itemprop="url">mysql 重置密码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:49" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:49+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-02 15:01:13" itemprop="dateModified" datetime="2022-05-02T15:01:13+08:00">2022-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>当我们安装了mysql或者mariadb的时候，一不小心，就把密码给忘记了。这个时候，我们不管怎么尝试密码，都是错误的，都会显示如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ28zkjw87oZ ~]<span class="comment"># mysql -uroot -p</span></span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> (using password: YES)</span><br></pre></td></tr></table></figure>

<p>这个问题特别的头疼。<br>但是如果我们用如下方法就可以迎刃而解了。<br>首先我们先修改配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>

<p>然后在<code>mysqld</code>节中增加下面一行代码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-grant-tables <span class="comment"># 这个是要加入的内容</span></span><br></pre></td></tr></table></figure>

<p>然后重启mysql&#x2F;mariadb之后，就可以不用密码而直接进去了。<br>这个时候我们就可以执行命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> mysql.user <span class="keyword">SET</span> Password<span class="operator">=</span>PASSWORD(<span class="operator">&amp;</span>#<span class="number">039</span>;your password<span class="operator">&amp;</span>#<span class="number">039</span>;) <span class="keyword">WHERE</span> <span class="keyword">User</span><span class="operator">=</span><span class="operator">&amp;</span>#<span class="number">039</span>;root<span class="operator">&amp;</span>#<span class="number">039</span>;;</span><br></pre></td></tr></table></figure>
<p>这样就把密码给修改了。修改之后。然后我们将<code>my.cnf</code>中的这行注释掉：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#skip-grant-tables</span></span><br></pre></td></tr></table></figure>
<p>然后重启就可以了。<br>这样就实现了我们mysql&#x2F;mariadb的重置密码功能了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/2017/11/17/mongodb-replica-set/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/17/mongodb-replica-set/" class="post-title-link" itemprop="url">MongoDB副本集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:18" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:18+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/" itemprop="url" rel="index"><span itemprop="name">mongodb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于副本集的理论我就不介绍了。下面说下如何实现副本集的操作。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><ol>
<li>首先就是要安装MongoDB服务器了。我建议按照我之前写的<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000005176288">这篇文章</a>进行安装。</li>
<li>准备三台以上的服务器。然后同时安装MongoDB。我们三台服务器的IP分别是（10.55.160.91，10.55.160.92，10.55.160.93）</li>
</ol>
<h2 id="部署一个副本集"><a href="#部署一个副本集" class="headerlink" title="部署一个副本集"></a>部署一个副本集</h2><ol>
<li><p>修改配置文件。<br> 首先我们打开配置文件。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br></pre></td></tr></table></figure>
<p> 找到<code>bindIp: 127.0.0.1</code>这行，我们需要对这行进行注释。变成如下这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bindIp: 127.0.0.1  # Listen to local interface only, comment to listen on all interfaces.</span></span><br></pre></td></tr></table></figure>
<p> 因为这个<code>bindIp</code>代表只允许本机进行连接，然后不允许其他服务器进行连接，那么，下面就没有办法继续执行了。</p>
<p> 找到<code>#replication:</code>这行我们将其注释去掉，然后下面增加一行，变成下面这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replication:</span><br><span class="line">  replSetName: test</span><br></pre></td></tr></table></figure>
<p> <code>replSetName</code>表示副本集组的名字(<code>test</code>是我自己写的，你们也可以写你们自己的喜欢的名字)，比如，我们要将三台服务器进行关联，那么我们就要将三台服务器都设置为相同的名字。</p>
<p> 然后如果三台服务器的MongoDB都已经启动了，那么就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod restart</span><br></pre></td></tr></table></figure>
<p> 如果没有启动就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod start</span><br></pre></td></tr></table></figure>
</li>
<li><p>链接到任意一台服务器。<br> 我选择的是链接到<code>10.55.160.91</code>。也就是我现在正在操作的这一台服务器。然后登录：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure></li>
<li><p>初始化副本集。<br> 初始化副本集，我们需要使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.initiate/#rs.initiate"><code>rs.initiate()</code></a>方法。<br> 我现在需要添加的是三台服务器，我们可以执行以下方法：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">initiate</span>(&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">version</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">members</span>: [</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">0</span>, host : <span class="string">&quot;10.55.160.91:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">1</span>, host : <span class="string">&quot;10.55.160.92:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">2</span>, host : <span class="string">&quot;10.55.160.93:27017&quot;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p> 当返回值显示为如下的时候，就代表成功了：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ok&quot;</span> : <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>这样就完成了，是不是很简单。哈哈。</p>
</li>
</ol>
<p>然后你就发现你的输入命令的标题就变了。变成如下这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test</span>:<span class="variable constant_">OTHER</span>&gt;</span><br></pre></td></tr></table></figure>
<p>不管它，我们继续执行操作，执行<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>，查看当前状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">status</span>()</span><br></pre></td></tr></table></figure>
<p>查看返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:36.607Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">154</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;infoMessage&quot;</span> : <span class="string">&quot;could not find member to sync from&quot;</span>,</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531709</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:29Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们主要是看<code>members</code>字段里面的<code>stateStr</code>的值。</p>
<p>很幸运，我当前执行命令的服务器被推举为主服务器。</p>
<p>如果你们现在服务器显示当前的服务器的状态是:<code>SECONDARY</code>。表示该服务器是从服务器，我们需要查看哪台服务器为主服务器，也就是<code>&quot;stateStr&quot; : &quot;PRIMARY&quot;</code>。我们需要在主服务器才进行进行操作，当然，也有强行在从服务器进行操作的办法。这里先不说。</p>
<p>这样我们就可以在主服务器进行操作了。比如存储数据。</p>
<h2 id="添加成员"><a href="#添加成员" class="headerlink" title="添加成员"></a>添加成员</h2><p>比如现在又有了一台服务器(10.55.160.94)需要加入到这个副本集中。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.add/#rs.add"><code>rs.add()</code></a>进行添加服务器。</p>
<p>首先我们还是别忘了修改配置文件的步骤。。。。。。修改完成配置文件之后重启Mongod，然后在主服务器执行如下命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">add</span>(<span class="string">&quot;10.55.160.94:27017&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在执行该命令之后，可能会出现主服务器的选择，我们要注意主服务器是否已经变成了别的服务器。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>查看新的主服务器是什么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:53.913Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1207</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536383</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:26:23Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">71</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.059Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改服务器的优先级"><a href="#修改服务器的优先级" class="headerlink" title="修改服务器的优先级"></a>修改服务器的优先级</h2><p>比如我们新添加的服务器(10.55.160.94)，这个服务器的配置较高。我希望优先让它成为主服务器。我们可以通过如下方式进行修改：</p>
<p>首先我们可以通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.conf/#rs.conf"><code>rs.conf</code></a>来查看是第几个游标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">conf</span>()</span><br></pre></td></tr></table></figure>
<p>返回值如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;version&quot;</span> : <span class="number">6</span>,</span><br><span class="line">	<span class="string">&quot;protocolVersion&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;chainingAllowed&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="number">2000</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatTimeoutSecs&quot;</span> : <span class="number">10</span>,</span><br><span class="line">		<span class="string">&quot;electionTimeoutMillis&quot;</span> : <span class="number">10000</span>,</span><br><span class="line">		<span class="string">&quot;getLastErrorModes&quot;</span> : &#123;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;getLastErrorDefaults&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;w&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;wtimeout&quot;</span> : <span class="number">0</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;replicaSetId&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57e391736b7581c82cc75a83&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到它的游标是第3个(从0开始计算)。<br>我们可以这样进行修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">3</span>].<span class="property">priority</span> = <span class="number">10</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>过了一会，我们就看到主服务器变成(10.55.160.94)了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:48.348Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.535Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.674Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">3066</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:47.546Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加仲裁者服务器"><a href="#添加仲裁者服务器" class="headerlink" title="添加仲裁者服务器"></a>添加仲裁者服务器</h2><p>仲裁者服务器只参与投票，而不是进行数据的存储。别忘了定义副本集名称。</p>
<p>我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.addArb/#rs.addArb"><code>rs.addArb()</code></a>来进行添加一台新的服务器（10.55.160.95）为仲裁服务器。</p>
<p>命令如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">addArb</span>(<span class="string">&#x27;10.55.160.95&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>返回<code>&#123; &quot;ok&quot; : 1 &#125;</code>就正常执行了。这时我们通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>来看一下服务器的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.854Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">141</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">95</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.091Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">86</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.121Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">83</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.134Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">79</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:42.775Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到IP为<code>10.55.160.95</code>这台服务器，它的<code>stateStr</code>的值是<code>ARBITER</code>。这个就代表是仲裁者的角色。</p>
<h2 id="移除成员"><a href="#移除成员" class="headerlink" title="移除成员"></a>移除成员</h2><p>移除成员我们使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.remove/#rs.remove"><code>rs.remove()</code></a>方法就可以了。</p>
<p>比如我们要移除10.55.160.93。我们可以使用如下命令:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">remove</span>(<span class="string">&#x27;10.55.160.93:27017&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>rs.status()</code>查看一下返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:21Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1377</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1331</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.593Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.592Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1319</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.595Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.582Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1315</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.596Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:17.585Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现10.55.160.93这个服务器已经从副本集中消失了。</p>
<h2 id="更换副本集成员"><a href="#更换副本集成员" class="headerlink" title="更换副本集成员"></a>更换副本集成员</h2><p>我们可以使用如下办法进行快速更换成员：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">0</span>].<span class="property">host</span> = <span class="string">&quot;10.55.160.93&quot;</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>我们看之前被替换走的成员，它的状态已经变成这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;state&quot;</span> : <span class="number">10</span>,</span><br><span class="line">	<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;REMOVED&quot;</span>,</span><br><span class="line">	<span class="string">&quot;uptime&quot;</span> : <span class="number">3162</span>,</span><br><span class="line">	<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474602195</span>, <span class="number">1</span>),</span><br><span class="line">		<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:43:15Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">0</span>,</span><br><span class="line">	<span class="string">&quot;errmsg&quot;</span> : <span class="string">&quot;Our replica set config is invalid or we are not a member of it&quot;</span>,</span><br><span class="line">	<span class="string">&quot;code&quot;</span> : <span class="number">93</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备13027795号-1 </a>
  </div>

<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魔王卷子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
