<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.baoguoxiao.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="记录我的工作中碰到的坑">
<meta property="og:type" content="website">
<meta property="og:title" content="魔王卷子">
<meta property="og:url" content="http://www.baoguoxiao.com/page/5/index.html">
<meta property="og:site_name" content="魔王卷子">
<meta property="og:description" content="记录我的工作中碰到的坑">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="魔王卷子">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.baoguoxiao.com/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>魔王卷子</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">魔王卷子</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-about"><a href="/about.html" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">魔王卷子</p>
  <div class="site-description" itemprop="description">记录我的工作中碰到的坑</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">97</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">109</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/simple-template-separation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/simple-template-separation/" class="post-title-link" itemprop="url">实现一个最简单的模板分离</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:51" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:51+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天看到以前知乎上别人提问的关于模板和逻辑进行分离的问题。</p>
<p>一直都没有回答过。</p>
<p>今天终于回答了。我来记录以下：</p>
<p>首先是模板文件，我定义他为<code>index.html</code>，内容如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;<span class="meta">&lt;?=</span><span class="variable">$title</span><span class="meta">?&gt;</span>&lt;/h1&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">foreach</span>(<span class="variable">$list</span> <span class="keyword">as</span> <span class="variable">$value</span>): <span class="meta">?&gt;</span></span><br><span class="line">        &lt;li&gt;<span class="meta">&lt;?=</span><span class="variable">$value</span><span class="meta">?&gt;</span>&lt;/li&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endforeach</span>; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<p>这里我们就不用自定义标签啊，之类的等等，我相信鸟哥的那句话，PHP本身就是一个非常好的模板引擎，我们没有必要再去造一个轮子。</p>
<p>所以，我们直接来写PHP的解析：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板解析</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$path</span>;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$vars</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$vars</span> = []</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">is_file</span>(<span class="variable">$path</span>)) &#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;path = <span class="variable">$path</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;vars = <span class="variable">$vars</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">		<span class="title function_ invoke__">ob_implicit_flush</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="title function_ invoke__">extract</span>(<span class="variable">$this</span>-&gt;vars, EXTR_OVERWRITE);</span><br><span class="line">		<span class="keyword">require_once</span> <span class="variable language_">$this</span>-&gt;path;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$view</span> = <span class="keyword">new</span> <span class="title class_">View</span>(<span class="string">&#x27;./index.html&#x27;</span>, [<span class="string">&#x27;title&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;list&#x27;</span> =&gt; [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$view</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>好了。直接运行一下，就能看到结果了。</p>
<p>不写了。太晚了。晚安。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/php-compile-pdo-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/php-compile-pdo-mysql/" class="post-title-link" itemprop="url">php编译pdo_mysql扩展记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:44" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:44+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/centos/" itemprop="url" rel="index"><span itemprop="name">centos</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这次作死，直接用默认配置安装了php。什么扩展都没有添加。结果一直在编译缺失的各种扩展。但是最后还是失败了，仅用做记录用。</p>
<p>在编译到pdo_mysql扩展的时候，就搞不定了。</p>
<p>在进行<code>make</code>操作的时候，出现了如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/php_pdo_mysql_int.h:27:34: 致命错误：ext/mysqlnd/mysqlnd.h：没有那个文件或目录</span><br><span class="line"> # include &quot;ext/mysqlnd/mysqlnd.h&quot;</span><br><span class="line">                                  ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<h2 id="这是走的弯路"><a href="#这是走的弯路" class="headerlink" title="这是走的弯路"></a>这是走的弯路</h2><p>我以为是mysqlnd没有编译，我接着去编译mysqlnd扩展了。</p>
<p>然后在<code>./configure</code>的时候，结果又提示我：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configure: error: Cannot find OpenSSL&#x27;s &lt;evp.h&gt;</span><br></pre></td></tr></table></figure>

<p>我以为是openssl-devel没有安装，我接着安装openssl-devel:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon mysqlnd]# yum install openssl openssl-devel</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.bit.edu.cn</span><br><span class="line"> * epel: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * extras: mirror.bit.edu.cn</span><br><span class="line"> * updates: mirror.bit.edu.cn</span><br><span class="line">软件包 1:openssl-1.0.1e-60.el7.x86_64 已安装并且是最新版本</span><br><span class="line">软件包 1:openssl-devel-1.0.1e-60.el7.x86_64 已安装并且是最新版本</span><br><span class="line">无须任何处理</span><br></pre></td></tr></table></figure>

<p>结果提示我已经安装了，那我强行指定路径吧：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon mysqlnd]# ./configure --with-openssl=/usr/include/openssl</span><br><span class="line">configure: WARNING: unrecognized options: --with-openssl</span><br><span class="line">checking for grep that handles long lines and -e... /usr/bin/grep</span><br><span class="line">checking for egrep... /usr/bin/grep -E</span><br><span class="line">checking for a sed that does not truncate output... /usr/bin/sed</span><br><span class="line">checking for cc... cc</span><br><span class="line">checking whether the C compiler works... yes</span><br><span class="line">checking for C compiler default output file name... a.out</span><br><span class="line">checking for suffix of executables... </span><br><span class="line">checking whether we are cross compiling... no</span><br><span class="line">checking for suffix of object files... o</span><br><span class="line">checking whether we are using the GNU C compiler... yes</span><br><span class="line">checking whether cc accepts -g... yes</span><br><span class="line">checking for cc option to accept ISO C89... none needed</span><br><span class="line">checking how to run the C preprocessor... cc -E</span><br><span class="line">checking for icc... no</span><br><span class="line">checking for suncc... no</span><br><span class="line">checking whether cc understands -c and -o together... yes</span><br><span class="line">checking for system library directory... lib</span><br><span class="line">checking if compiler supports -R... no</span><br><span class="line">checking if compiler supports -Wl,-rpath,... yes</span><br><span class="line">checking build system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking host system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking target system type... x86_64-unknown-linux-gnu</span><br><span class="line">checking for PHP prefix... /usr/local/php</span><br><span class="line">checking for PHP includes... -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib</span><br><span class="line">checking for PHP extension directory... /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012</span><br><span class="line">checking for PHP installed headers prefix... /usr/local/php/include/php</span><br><span class="line">checking if debug is enabled... no</span><br><span class="line">checking if zts is enabled... no</span><br><span class="line">checking for re2c... no</span><br><span class="line">configure: WARNING: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers.</span><br><span class="line">checking for gawk... gawk</span><br><span class="line">checking whether to enable mysqlnd... yes, shared</span><br><span class="line">checking whether to disable compressed protocol support in mysqlnd... yes</span><br><span class="line">checking for the location of libz... no</span><br><span class="line">checking for DSA_get_default_method in -lssl... no</span><br><span class="line">checking for X509_free in -lcrypto... yes</span><br><span class="line">checking for pkg-config... /usr/bin/pkg-config</span><br><span class="line">configure: error: Cannot find OpenSSL&#x27;s &lt;evp.h&gt;</span><br></pre></td></tr></table></figure>

<p>结果还是不行，这下两边路都走不通了，我就去网上查询了。结果还是查询不到什么有用的资料</p>
<h2 id="转回正道"><a href="#转回正道" class="headerlink" title="转回正道"></a>转回正道</h2><p>我后来想，我直接改源码试试看呢，把<code>include</code>加载文件写成绝对目录。</p>
<p>说干就干</p>
<p>我先看看这个报错的地方。</p>
<p>文件在**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;php_pdo_mysql_int.h:27:34**</p>
<p>我打开该文件，修改第27行的内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;ext/mysqlnd/mysqlnd.h&quot;</span></span></span><br><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;ext/mysqlnd/mysqlnd_libmysql_compat.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我的源代码的目录是**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;**，于是我就改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd.h&quot;</span></span></span><br><span class="line"><span class="meta">#       <span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_libmysql_compat.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我再进行编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">In file included from /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c:32:0:</span><br><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/php_pdo_mysql_int.h:69:39: 致命错误：ext/mysqlnd/mysqlnd_debug.h：没有那个文件或目录</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">include <span class="string">&quot;ext/mysqlnd/mysqlnd_debug.h&quot;</span></span></span><br><span class="line">                                       ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<p>发现有效果，报错的地方变了，我接着改，这里提示报错的地方还是：**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;php_pdo_mysql_int.h:69:39**，但是行数编程69了，我把69行改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_debug.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>继续，发现报错信息又变了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make </span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">/usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c:64:45: 致命错误：ext/mysqlnd/mysqlnd_reverse_api.h：没有那个文件或目录</span><br><span class="line"> #include &quot;ext/mysqlnd/mysqlnd_reverse_api.h&quot;</span><br><span class="line">                                             ^</span><br><span class="line">编译中断。</span><br><span class="line">make: *** [pdo_mysql.lo] 错误 1</span><br></pre></td></tr></table></figure>

<p>我将文件**&#x2F;usr&#x2F;local&#x2F;src&#x2F;php-7.0.14&#x2F;ext&#x2F;pdo_mysql&#x2F;pdo_mysql.c:64:45**改成如下所示：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;/usr/local/src/php-7.0.14/ext/mysqlnd/mysqlnd_reverse_api.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>继续编译：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make clean</span><br><span class="line">find . -name \*.gcno -o -name \*.gcda | xargs rm -f</span><br><span class="line">find . -name \*.lo -o -name \*.o | xargs rm -f</span><br><span class="line">find . -name \*.la -o -name \*.a | xargs rm -f </span><br><span class="line">find . -name \*.so | xargs rm -f</span><br><span class="line">find . -name .libs -a -type d|xargs rm -rf</span><br><span class="line">rm -f libphp.la       modules/* libs/*</span><br><span class="line">[root@bogon pdo_mysql]# make </span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c -o pdo_mysql.lo </span><br><span class="line">mkdir .libs</span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/pdo_mysql.c  -fPIC -DPIC -o .libs/pdo_mysql.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_driver.c -o mysql_driver.lo </span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_driver.c  -fPIC -DPIC -o .libs/mysql_driver.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=compile cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_statement.c -o mysql_statement.lo </span><br><span class="line"> cc -I/usr/local/php/include/php/ext -I -DZEND_ENABLE_STATIC_TSRMLS_CACHE=1 -I. -I/usr/local/src/php-7.0.14/ext/pdo_mysql -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /usr/local/src/php-7.0.14/ext/pdo_mysql/mysql_statement.c  -fPIC -DPIC -o .libs/mysql_statement.o</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=link cc -DPHP_ATOM_INC -I/usr/local/src/php-7.0.14/ext/pdo_mysql/include -I/usr/local/src/php-7.0.14/ext/pdo_mysql/main -I/usr/local/src/php-7.0.14/ext/pdo_mysql -I/usr/local/php/include/php -I/usr/local/php/include/php/main -I/usr/local/php/include/php/TSRM -I/usr/local/php/include/php/Zend -I/usr/local/php/include/php/ext -I/usr/local/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -o pdo_mysql.la -export-dynamic -avoid-version -prefer-pic -module -rpath /usr/local/src/php-7.0.14/ext/pdo_mysql/modules  pdo_mysql.lo mysql_driver.lo mysql_statement.lo </span><br><span class="line">cc -shared  .libs/pdo_mysql.o .libs/mysql_driver.o .libs/mysql_statement.o   -Wl,-soname -Wl,pdo_mysql.so -o .libs/pdo_mysql.so</span><br><span class="line">creating pdo_mysql.la</span><br><span class="line">(cd .libs &amp;&amp; rm -f pdo_mysql.la &amp;&amp; ln -s ../pdo_mysql.la pdo_mysql.la)</span><br><span class="line">/bin/sh /usr/local/src/php-7.0.14/ext/pdo_mysql/libtool --mode=install cp ./pdo_mysql.la /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line">cp ./.libs/pdo_mysql.so /usr/local/src/php-7.0.14/ext/pdo_mysql/modules/pdo_mysql.so</span><br><span class="line">cp ./.libs/pdo_mysql.lai /usr/local/src/php-7.0.14/ext/pdo_mysql/modules/pdo_mysql.la</span><br><span class="line">PATH=&quot;$PATH:/sbin&quot; ldconfig -n /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Libraries have been installed in:</span><br><span class="line">   /usr/local/src/php-7.0.14/ext/pdo_mysql/modules</span><br><span class="line"></span><br><span class="line">If you ever happen to want to link against installed libraries</span><br><span class="line">in a given directory, LIBDIR, you must either use libtool, and</span><br><span class="line">specify the full pathname of the library, or use the `-LLIBDIR&#x27;</span><br><span class="line">flag during linking and do at least one of the following:</span><br><span class="line">   - add LIBDIR to the `LD_LIBRARY_PATH&#x27; environment variable</span><br><span class="line">     during execution</span><br><span class="line">   - add LIBDIR to the `LD_RUN_PATH&#x27; environment variable</span><br><span class="line">     during linking</span><br><span class="line">   - use the `-Wl,--rpath -Wl,LIBDIR&#x27; linker flag</span><br><span class="line">   - have your system administrator add LIBDIR to `/etc/ld.so.conf&#x27;</span><br><span class="line"></span><br><span class="line">See any operating system documentation about shared libraries for</span><br><span class="line">more information, such as the ld(1) and ld.so(8) manual pages.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Build complete.</span><br><span class="line">Don&#x27;t forget to run &#x27;make test&#x27;.</span><br></pre></td></tr></table></figure>

<p>这样就成功了。接下来我们就可以继续<code>make install</code>进行安装了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# make install</span><br><span class="line">Installing shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/</span><br></pre></td></tr></table></figure>

<p>我们修改一下配置文件，添加下面的内容到配置文件中：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">extension</span>=pdo_mysql.so</span><br></pre></td></tr></table></figure>

<p>然后我们测试扩展是否安装成功了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon pdo_mysql]# php -m</span><br><span class="line">PHP Warning:  Module &#x27;PDO&#x27; already loaded in Unknown on line 0</span><br><span class="line"></span><br><span class="line">Warning: Module &#x27;PDO&#x27; already loaded in Unknown on line 0</span><br><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so&#x27; - /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so: undefined symbol: mysqlnd_allocator in Unknown on line 0</span><br><span class="line"></span><br><span class="line">Warning: PHP Startup: Unable to load dynamic library &#x27;/usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so&#x27; - /usr/local/php/lib/php/extensions/no-debug-non-zts-20151012/pdo_mysql.so: undefined symbol: mysqlnd_allocator in Unknown on line 0</span><br></pre></td></tr></table></figure>

<p>报错了。看来我们还需要mysqlnd扩展：</p>
<p>然后还是提示找不到openssl的错误。</p>
<p>我接着去网上搜了一下。</p>
<p>还是找不到答案，我查了一下，这个好像是一个bug，一直没有修复。</p>
<p>解决办法只能是重装php来解决了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/nginx-manager-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nginx-manager-command/" class="post-title-link" itemprop="url">nginx 设置管理命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:36" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:36+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">web服务器</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="nginx管理命令："><a href="#nginx管理命令：" class="headerlink" title="nginx管理命令："></a>nginx管理命令：</h2><blockquote>
<p>我不是生产者，我只是大自然的搬运工。<br>以下脚本来自<a target="_blank" rel="noopener" href="https://lnmp.org/">LNMP一键安装包</a>中军哥的一键安装脚本。感谢军哥的辛勤劳动。</p>
</blockquote>
<p>首先我们先用<strong>vim</strong>或者<strong>vi</strong>打开<code>/etc/init.d/nginx</code>;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/init.d/nginx</span><br></pre></td></tr></table></figure>

<p>然后按<strong>i</strong>进入编辑模式，将以下内容复制到该文件里面：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">! /bin/sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">chkconfig: 2345 55 25</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description: Startup script <span class="keyword">for</span> nginx webserver on Debian. Place <span class="keyword">in</span> /etc/init.d and</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run <span class="string">&#x27;update-rc.d -f nginx defaults&#x27;</span>, or use the appropriate <span class="built_in">command</span> on your</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">distro. For CentOS/RedHat run: <span class="string">&#x27;chkconfig --add nginx&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Provides:          nginx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Required-Start:    <span class="variable">$all</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Required-Stop:     <span class="variable">$all</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Stop:      0 1 6</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Short-Description: starts the nginx web server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description:       starts nginx using start-stop-daemon</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Author:   licess</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">website:  http://lnmp.org</span></span><br><span class="line"></span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line">NAME=nginx</span><br><span class="line">NGINX_BIN=/usr/local/nginx/sbin/$NAME</span><br><span class="line">CONFIGFILE=/usr/local/nginx/conf/$NAME.conf</span><br><span class="line">PIDFILE=/usr/local/nginx/logs/$NAME.pid</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        echo -n &quot;Starting $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if netstat -tnpl | grep -q nginx;then</span><br><span class="line">            echo &quot;$NAME (pid `pidof $NAME`) already running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -c $CONFIGFILE</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    stop)</span><br><span class="line">        echo -n &quot;Stoping $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if ! netstat -tnpl | grep -q nginx; then</span><br><span class="line">            echo &quot;$NAME is not running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -s stop</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed. Use force-quit&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    status)</span><br><span class="line">        if netstat -tnpl | grep -q nginx; then</span><br><span class="line">            PID=`pidof nginx`</span><br><span class="line">            echo &quot;$NAME (pid $PID) is running...&quot;</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$NAME is stopped&quot;</span><br><span class="line">            exit 0</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    force-quit)</span><br><span class="line">        echo -n &quot;Terminating $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if ! netstat -tnpl | grep -q nginx; then</span><br><span class="line">            echo &quot;$NAME is not running.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        kill `pidof $NAME`</span><br><span class="line"></span><br><span class="line">        if [ &quot;$?&quot; != 0 ] ; then</span><br><span class="line">            echo &quot; failed&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        else</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    restart)</span><br><span class="line">        $0 stop</span><br><span class="line">        sleep 1</span><br><span class="line">        $0 start</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    reload)</span><br><span class="line">        echo -n &quot;Reload service $NAME... &quot;</span><br><span class="line"></span><br><span class="line">        if netstat -tnpl | grep -q nginx; then</span><br><span class="line">            $NGINX_BIN -s reload</span><br><span class="line">            echo &quot; done&quot;</span><br><span class="line">        else</span><br><span class="line">            echo &quot;$NAME is not running, can&#x27;t reload.&quot;</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    configtest)</span><br><span class="line">        echo -n &quot;Test $NAME configure files... &quot;</span><br><span class="line"></span><br><span class="line">        $NGINX_BIN -t</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Usage: $0 &#123;start|stop|force-quit|restart|reload|status|configtest&#125;&quot;</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>然后保存退出。接着执行赋予执行权限命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/init.d/nginx</span><br></pre></td></tr></table></figure>

<p>这样我们就可以执行管理命令了。比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service nginx start</span><br><span class="line">service nginx stop</span><br></pre></td></tr></table></figure>

<p>具体我们可以执行<code>service nginx</code>查看。</p>
<p>我们还可以设置开机启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig nginx on</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sql-sql-doubly-linked-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sql-sql-doubly-linked-list/" class="post-title-link" itemprop="url">SPL标准库之SplDoublyLinkedList（双向链表）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:28:13" itemprop="dateCreated datePublished" datetime="2017-11-17T16:28:13+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>双向链表其实就是数据本身具备了左边和右边的双向指针。类似Redis的列表，它就是双向链表。</p>
<p>我们现在就学习一下SPL内置的SplDoublyLinkedList类。</p>
<p>首先介绍一下这个类都有哪些方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实例化方法</span></span><br><span class="line"><span class="variable">$dll</span> = <span class="keyword">new</span> <span class="built_in">SplDoublyLinkedList</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//尾部增加数据,类似array_push()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">push</span>(<span class="variable">$value</span>);</span><br><span class="line"><span class="comment">//开头插入数据,类似array_unshift()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">unshift</span>(<span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//检测指定位置是否存在值,类似array_key_exists()方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetExists</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="comment">//获取指定位置的值,类似$dll[$key]</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetGet</span>(<span class="variable">$key</span>);</span><br><span class="line"><span class="comment">//修改指定位置的值,类似$dll[$key] = $value</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetSet</span>(<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line"><span class="comment">//删除指定位置的值,类似unset($dll[$key])</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">offsetUnset</span>(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取双向链表中值的数量</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">count</span>();</span><br><span class="line"><span class="comment">//检测双向链表是否为空</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">isEmpty</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//序列化存储,类似serialize()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">serialize</span>();</span><br><span class="line"><span class="comment">//存储反序列化类似unserialize()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置迭代器模式</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">setIteratorMode</span>(<span class="variable">$mode</span>);</span><br><span class="line"><span class="comment">//获取迭代器模式</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">getIteratorMode</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化链表,只有先执行此方法，才能使用操作游标的方法</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">rewind</span>();</span><br><span class="line"><span class="comment">//获取当前游标的索引</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">key</span>();</span><br><span class="line"><span class="comment">//获取当前游标的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">current</span>();</span><br><span class="line"><span class="comment">//将游标移动到下一个节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">next</span>();</span><br><span class="line"><span class="comment">//将游标移动到上一个节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">prev</span>();</span><br><span class="line"><span class="comment">//检测当前游标后面是否还有节点</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">valid</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回第一个节点的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">bottom</span>();</span><br><span class="line"><span class="comment">//返回最后一个节点的值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">top</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//将双向链表中的最后一个节点弹出,类似array_pop()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">pop</span>();</span><br><span class="line"><span class="comment">//将双向链表中的第一个节点弹出,类似array_shift()</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">shift</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//在双向链表的指定位置插入值</span></span><br><span class="line"><span class="variable">$dll</span>-&gt;<span class="title function_ invoke__">add</span>(<span class="variable">$index</span>, <span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Iterator-模式"><a href="#Iterator-模式" class="headerlink" title="Iterator 模式"></a>Iterator 模式</h2><ul>
<li>迭代的方向：<ul>
<li><code>SplDoublyLinkedList::IT_MODE_LIFO</code> (堆栈 style)</li>
<li><code>SplDoublyLinkedList::IT_MODE_FIFO</code> (队列 style)</li>
</ul>
</li>
<li>迭代器的行为<ul>
<li><code>SplDoublyLinkedList::IT_MODE_DELETE</code> (元素由迭代器删除)</li>
<li><code>SplDoublyLinkedList::IT_MODE_KEEP</code> (元素由迭代器遍历)</li>
</ul>
</li>
</ul>
<p>默认模式是：<code>SplDoublyLinkedList::IT_MODE_FIFO | SplDoublyLinkedList::IT_MODE_KEEP</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/linux-install-composer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/linux-install-composer/" class="post-title-link" itemprop="url">Linux 下安装 Composer</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:27:26" itemprop="dateCreated datePublished" datetime="2017-11-17T16:27:26+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-20 16:28:10" itemprop="dateModified" datetime="2022-08-20T16:28:10+08:00">2022-08-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h2><p>使用 Composer 需要先安装 PHP。</p>
<p>可以参考如下几篇进行安装：</p>
<ul>
<li><a href="/centos-build-lnmp-environment/">如何搭建 LNMP 环境【编译版】</a></li>
<li><a href="/yum-install-php/">DNF 安装 PHP</a></li>
</ul>
<h2 id="项目内"><a href="#项目内" class="headerlink" title="项目内"></a>项目内</h2><p>其实我们可以在项目根目录执行下列命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://getcomposer.org/download/latest-stable/composer.phar</span><br><span class="line">php composer.phar</span><br></pre></td></tr></table></figure>

<h2 id="全局手动安装"><a href="#全局手动安装" class="headerlink" title="全局手动安装"></a>全局手动安装</h2><p>将文件下载到 <code>/usr/local/bin</code> 并修改名称为 <code>composer</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /usr/local/bin/composer https://getcomposer.org/download/latest-stable/composer.phar</span><br></pre></td></tr></table></figure>

<p>添加执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> +x /usr/local/bin/composer</span><br></pre></td></tr></table></figure>

<p>就可以直接通过如下方式执行了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># composer -V</span></span><br><span class="line">Composer version 2.4.0 2022-08-16 16:10:48</span><br></pre></td></tr></table></figure>

<h2 id="系统包管理安装"><a href="#系统包管理安装" class="headerlink" title="系统包管理安装"></a>系统包管理安装</h2><p>我个人不是很推荐，具体原因还是因为我使用 Ubuntu 的时候，会依赖一些 PHP 扩展，但是如果是使用第三方库安装的 PHP，那么安装 Composer 的扩展却不是自己能够控制的，以为很可能会依赖系统自带的 PHP 版本。</p>
<p>下面就列一下命令：</p>
<p>CentOS&#x2F;Rocky&#x2F;RedHat:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install composer</span><br></pre></td></tr></table></figure>

<p>Debian&#x2F;Ubuntu:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install composer</span><br></pre></td></tr></table></figure>

<h2 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo composer self-update</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此内容仅手动安装的可以使用，因为包管理没有该命令。</p>
</blockquote>
<h2 id="修改镜像"><a href="#修改镜像" class="headerlink" title="修改镜像"></a>修改镜像</h2><p>全局设置腾讯云镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repos.packagist composer https://mirrors.tencent.com/composer/</span><br></pre></td></tr></table></figure>

<p>全局设置阿里云镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>

<p>全局取消镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g --<span class="built_in">unset</span> repos.packagist</span><br></pre></td></tr></table></figure>

<p>项目内设置腾讯云镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config repos.packagist composer https://mirrors.tencent.com/composer/</span><br></pre></td></tr></table></figure>

<p>项目内设置阿里云镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config repo.packagist composer https://mirrors.aliyun.com/composer/</span><br></pre></td></tr></table></figure>

<p>项目内取消镜像：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer config -g --<span class="built_in">unset</span> repos.packagist</span><br></pre></td></tr></table></figure>

<h2 id="碰到的问题"><a href="#碰到的问题" class="headerlink" title="碰到的问题"></a>碰到的问题</h2><ul>
<li><code>phar &quot;/usr/local/bin/composer&quot; has a broken signature</code> 错误:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PHP Fatal error:  Uncaught exception &#x27;PharException&#x27; with message &#x27;phar &quot;/usr/local/bin/composer&quot; has a broken signature&#x27; in /usr/local/bin/composer:23</span><br><span class="line">Stack trace:</span><br><span class="line">#0 /usr/local/bin/composer(23): Phar::mapPhar(&#x27;composer.phar&#x27;)</span><br><span class="line">#1 &#123;main&#125;</span><br><span class="line">  thrown in /usr/local/bin/composer on line 23</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>：删除文件包，重新安装。</p>
<ul>
<li>PHP 缺失 <code>openssl</code> 扩展:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Some settings on your machine make Composer unable to work properly.</span><br><span class="line">Make sure that you fix the issues listed below and run this script again:</span><br><span class="line"></span><br><span class="line">The openssl extension is missing, which means that secure HTTPS transfers are impossible.</span><br><span class="line">If possible you should enable it or recompile php with --with-openssl</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>: PHP 安装 <code>openssl</code> 扩展。</p>
<ul>
<li>PHP 缺失 <code>zlib</code> 扩展:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The zlib extension is not loaded, this can slow down Composer a lot.</span><br><span class="line">If possible, install it or recompile php with --with-zlib</span><br><span class="line"></span><br><span class="line">The php.ini used by your command-line PHP is: /usr/local/php/etc/php.ini</span><br><span class="line">If you can not modify the ini file, you can also run `php -d option=value` to modify ini values on the fly. You can use -d multiple times.</span><br></pre></td></tr></table></figure>

<p><strong>解决办法</strong>: PHP 安装 <code>zlib</code> 扩展。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/elasticsearch-php-sdk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/elasticsearch-php-sdk/" class="post-title-link" itemprop="url">Elasticsearch（2）PHP驱动</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:27:19" itemprop="dateCreated datePublished" datetime="2017-11-17T16:27:19+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>安装完成composer之后。我们需要安装php的类库来对Elasticsearch进行连接。</p>
<p>我们现在需要使用的是<a target="_blank" rel="noopener" href="https://packagist.org/packages/elasticsearch/elasticsearch">elasticsearch&#x2F;elasticsearch</a>。</p>
<p>比如我们的项目目录在 <strong>&#x2F;data&#x2F;project&#x2F;elastic</strong>。</p>
<p>我们就可以在这个目录下执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require elasticsearch/elasticsearch</span><br></pre></td></tr></table></figure>

<p>如果出现如下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Using version ^5.0 for elasticsearch/elasticsearch</span><br><span class="line">./composer.json has been updated</span><br><span class="line">Loading composer repositories with package information</span><br><span class="line">Updating dependencies (including require-dev)</span><br><span class="line">Package operations: 5 installs, 0 updates, 0 removals</span><br><span class="line">  - Installing react/promise (v2.5.0) Downloading: 100%         </span><br><span class="line">  - Installing guzzlehttp/streams (3.0.0) Downloading: 100%         </span><br><span class="line">  - Installing guzzlehttp/ringphp (1.1.0) Downloading: 100%         </span><br><span class="line">  - Installing psr/log (1.0.2) Downloading: 100%         </span><br><span class="line">  - Installing elasticsearch/elasticsearch (v5.0.0) Downloading: 100%         </span><br><span class="line">elasticsearch/elasticsearch suggests installing monolog/monolog (Allows for client-level logging and tracing)</span><br><span class="line">Writing lock file</span><br><span class="line">Generating autoload files</span><br></pre></td></tr></table></figure>

<p>就表示已经安装成功了。</p>
<p>接下来我们编辑如下文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;./vendor/autoload.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span> = <span class="title class_">Elasticsearch\ClientBuilder</span>::<span class="title function_ invoke__">create</span>();</span><br><span class="line"><span class="variable">$client</span>-&gt;<span class="title function_ invoke__">setHosts</span>([<span class="string">&#x27;127.0.0.1&#x27;</span>]);</span><br><span class="line"><span class="variable">$client</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">build</span>();</span><br><span class="line"><span class="variable">$info</span> = <span class="variable">$client</span>-&gt;<span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$info</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后保存为<strong>index.php</strong>。我们可以通过访问该文件来确认是否请求成功了。</p>
<p>然后我们执行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@68 elastic]# php index.php </span><br><span class="line">array(5) &#123;</span><br><span class="line">  [&quot;name&quot;]=&gt;</span><br><span class="line">  string(7) &quot;ZQZ38Da&quot;</span><br><span class="line">  [&quot;cluster_name&quot;]=&gt;</span><br><span class="line">  string(13) &quot;elasticsearch&quot;</span><br><span class="line">  [&quot;cluster_uuid&quot;]=&gt;</span><br><span class="line">  string(22) &quot;FuPCyv2ZSimGYxAo_nLvpw&quot;</span><br><span class="line">  [&quot;version&quot;]=&gt;</span><br><span class="line">  array(5) &#123;</span><br><span class="line">    [&quot;number&quot;]=&gt;</span><br><span class="line">    string(5) &quot;5.1.1&quot;</span><br><span class="line">    [&quot;build_hash&quot;]=&gt;</span><br><span class="line">    string(7) &quot;5395e21&quot;</span><br><span class="line">    [&quot;build_date&quot;]=&gt;</span><br><span class="line">    string(24) &quot;2016-12-06T12:36:15.409Z&quot;</span><br><span class="line">    [&quot;build_snapshot&quot;]=&gt;</span><br><span class="line">    bool(false)</span><br><span class="line">    [&quot;lucene_version&quot;]=&gt;</span><br><span class="line">    string(5) &quot;6.3.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">  [&quot;tagline&quot;]=&gt;</span><br><span class="line">  string(20) &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就表示我们的驱动已经安装并且连接完成了。</p>
<blockquote>
<p>具体的文档我们可点击：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/index.html">https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/index.html</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/javascript-time-string-to-timestamp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/javascript-time-string-to-timestamp/" class="post-title-link" itemprop="url">记一次js处理时间字符串转为时间戳的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:48" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:48+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天朋友问我，js应该如何将时间字符串转为时间戳。</p>
<p>我下意识就去百度，结果找到的，写法却是复杂无比，比如下面这个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">    $.<span class="title function_">extend</span>(&#123;</span><br><span class="line">        <span class="attr">myTime</span>: &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 当前时间戳</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> &lt;int&gt;        unix时间戳(秒)  </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">CurTime</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Date</span>.<span class="title function_">parse</span>(<span class="keyword">new</span> <span class="title class_">Date</span>())/<span class="number">1000</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">/**              </span></span><br><span class="line"><span class="comment">             * 日期 转换为 UNIX时间戳</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;string&gt; 2014-01-01 20:20:20  日期格式              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> &lt;int&gt;        unix时间戳(秒)              </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">DateToUnix</span>: <span class="keyword">function</span>(<span class="params">string</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> f = string.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>, <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">var</span> d = (f[<span class="number">0</span>] ? f[<span class="number">0</span>] : <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;-&#x27;</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="keyword">var</span> t = (f[<span class="number">1</span>] ? f[<span class="number">1</span>] : <span class="string">&#x27;&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>, <span class="number">3</span>);</span><br><span class="line">                <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">Date</span>(</span><br><span class="line">                        <span class="built_in">parseInt</span>(d[<span class="number">0</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        (<span class="built_in">parseInt</span>(d[<span class="number">1</span>], <span class="number">10</span>) || <span class="number">1</span>) - <span class="number">1</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(d[<span class="number">2</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">0</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">1</span>], <span class="number">10</span>) || <span class="literal">null</span>,</span><br><span class="line">                        <span class="built_in">parseInt</span>(t[<span class="number">2</span>], <span class="number">10</span>) || <span class="literal">null</span></span><br><span class="line">                        )).<span class="title function_">getTime</span>() / <span class="number">1000</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">/**              </span></span><br><span class="line"><span class="comment">             * 时间戳转换日期              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;int&gt; unixTime    待时间戳(秒)              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;bool&gt; isFull    返回完整时间(Y-m-d 或者 Y-m-d H:i:s)              </span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &lt;int&gt;  timeZone   时区              </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="title class_">UnixToDate</span>: <span class="keyword">function</span>(<span class="params">unixTime, isFull, timeZone</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (timeZone) == <span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    unixTime = <span class="built_in">parseInt</span>(unixTime) + <span class="built_in">parseInt</span>(timeZone) * <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> time = <span class="keyword">new</span> <span class="title class_">Date</span>(unixTime * <span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">var</span> ymdhis = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                ymdhis += time.<span class="title function_">getUTCFullYear</span>() + <span class="string">&quot;-&quot;</span>;</span><br><span class="line">                ymdhis += (time.<span class="title function_">getUTCMonth</span>()+<span class="number">1</span>) + <span class="string">&quot;-&quot;</span>;</span><br><span class="line">                ymdhis += time.<span class="title function_">getUTCDate</span>();</span><br><span class="line">                <span class="keyword">if</span> (isFull === <span class="literal">true</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    ymdhis += <span class="string">&quot; &quot;</span> + time.<span class="title function_">getUTCHours</span>() + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">                    ymdhis += time.<span class="title function_">getUTCMinutes</span>() + <span class="string">&quot;:&quot;</span>;</span><br><span class="line">                    ymdhis += time.<span class="title function_">getUTCSeconds</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ymdhis;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>

<p>看起来就非常的麻烦。于是我想到去官方文档去了一下，还真让我找到了。于是写了这么一个demo，这里我们并不需要将时间戳转化为字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//时间字符串转化为时间戳</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">str2time</span>(<span class="params">data</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span> (data.<span class="property">length</span> == <span class="number">10</span>) &#123;</span><br><span class="line">		data += <span class="string">&#x27; 00:00:00&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>(data);</span><br><span class="line">	<span class="keyword">return</span> (date.<span class="title function_">getTime</span>() / <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么一个简单的工作就完成了。</p>
<p>在这里要注意的一个坑就是，注意服务器的时区是否跟浏览器的时区相同，如果不同，那么显示的时间跟服务器就会有几个小时的误差。具体的误差就看差着几个时区了。</p>
<p>我这里对于这个也是抛砖引玉。</p>
<p>具体复杂的，可以看看我列出的参考连接。就是在<code>new Date</code>注意看看传入的值就好了。</p>
<blockquote>
<p>参考文档：</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getTime</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/jquery-form-input-to-object/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/jquery-form-input-to-object/" class="post-title-link" itemprop="url">jq将form 表单数据转为object</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:22" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:22+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/javascript/jquery/" itemprop="url" rel="index"><span itemprop="name">jquery</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我平常上传数据都是使用<code>$(this).serialize()</code>，但是这次我需要使用上传数据的对象。结果这个方法给我转成了字符串。特别不方便。于是找到一个插件。就可以实现，获取的时候，获取到的是对象而不是字符串了。</p>
<p>首先，我们先加载jquery;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在后面写一个js方法就好了：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">$.fn.<span class="property">serializeObject</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> o = &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> a = <span class="variable language_">this</span>.<span class="title function_">serializeArray</span>();</span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">each</span>(a, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (o[<span class="variable language_">this</span>.<span class="property">name</span>] !== <span class="literal">undefined</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!o[<span class="variable language_">this</span>.<span class="property">name</span>].<span class="property">push</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                o[<span class="variable language_">this</span>.<span class="property">name</span>] = [o[<span class="variable language_">this</span>.<span class="property">name</span>]];</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            o[<span class="variable language_">this</span>.<span class="property">name</span>].<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">value</span> || <span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            o[<span class="variable language_">this</span>.<span class="property">name</span>] = <span class="variable language_">this</span>.<span class="property">value</span> || <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> o;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样我们直接就可以获取对象了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(form).<span class="title function_">serializeObject</span>();</span><br></pre></td></tr></table></figure>

<p>这样我们获取到的数据直接就是对象了。</p>
<blockquote>
<p>参考资料：</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery">http://stackoverflow.com/questions/1184624/convert-form-data-to-javascript-object-with-jquery</a></li>
<li><a target="_blank" rel="noopener" href="http://www.thinksaas.cn/topics/0/345/345610.html">http://www.thinksaas.cn/topics/0/345/345610.html</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/sublime-text-3-install-package-control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/sublime-text-3-install-package-control/" class="post-title-link" itemprop="url">sublime text 3 安装 package control</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:26:17" itemprop="dateCreated datePublished" datetime="2017-11-17T16:26:17+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/sublime-text/" itemprop="url" rel="index"><span itemprop="name">sublime text</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我使用sublime，想要使用插件，还是得使用它的商店。</p>
<p>商店默认是不会安装的，于是我就是网上搜索，尝试安装一下。</p>
<p>我用的是这个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">&#x27;2915d1851351e5ee549c20394736b442&#x27;</span> + <span class="string">&#x27;8bc59f460fa1548d1514676163dafc88&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="built_in">open</span>(os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by)</span><br></pre></td></tr></table></figure>

<p>结果我执行之后，发现提示这个错误：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error validating download (got df21e130d211cfc94d9b0905775a7c0f1e3d39e33b79698005270310898eea76 instead of 2915d1851351e5ee549c20394736b4428bc59f460fa1548d1514676163dafc88), please <span class="keyword">try</span> manual install</span><br></pre></td></tr></table></figure>

<p>顿时觉得不行了。我觉得我还是得找谷歌，于是我去外国网站，找了一个，嘿嘿，还真安装上了。现提供命令如下：</p>
<p>sublime3：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os,hashlib; h = <span class="string">&#x27;df21e130d211cfc94d9b0905775a7c0f&#x27;</span> + <span class="string">&#x27;1e3d39e33b79698005270310898eea76&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h)) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="built_in">open</span>(os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by)</span><br></pre></td></tr></table></figure>

<p>sublime2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2,os,hashlib; h = <span class="string">&#x27;df21e130d211cfc94d9b0905775a7c0f&#x27;</span> + <span class="string">&#x27;1e3d39e33b79698005270310898eea76&#x27;</span>; pf = <span class="string">&#x27;Package Control.sublime-package&#x27;</span>; ipp = sublime.installed_packages_path(); os.makedirs( ipp ) <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(ipp) <span class="keyword">else</span> <span class="literal">None</span>; urllib2.install_opener( urllib2.build_opener( urllib2.ProxyHandler()) ); by = urllib2.urlopen( <span class="string">&#x27;http://packagecontrol.io/&#x27;</span> + pf.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;%20&#x27;</span>)).read(); dh = hashlib.sha256(by).hexdigest(); <span class="built_in">open</span>( os.path.join( ipp, pf), <span class="string">&#x27;wb&#x27;</span> ).write(by) <span class="keyword">if</span> dh == h <span class="keyword">else</span> <span class="literal">None</span>; <span class="built_in">print</span>(<span class="string">&#x27;Error validating download (got %s instead of %s), please try manual install&#x27;</span> % (dh, h) <span class="keyword">if</span> dh != h <span class="keyword">else</span> <span class="string">&#x27;Please restart Sublime Text to finish installation&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>完毕，收工。</p>
<p>参考网址：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://packagecontrol.io/installation#st2">https://packagecontrol.io/installation#st2</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/mysql-reset-password/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/mysql-reset-password/" class="post-title-link" itemprop="url">mysql 重置密码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:49" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:49+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>当我们安装了mysql或者mariadb的时候，一不小心，就把密码给忘记了。这个时候，我们不管怎么尝试密码，都是错误的，都会显示如下错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ28zkjw87oZ ~]<span class="comment"># mysql -uroot -p</span></span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> (using password: YES)</span><br></pre></td></tr></table></figure>

<p>这个问题特别的头疼。<br>但是如果我们用如下方法就可以迎刃而解了。<br>首先我们先修改配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>

<p>然后在<code>mysqld</code>节中增加下面一行代码：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-grant-tables <span class="comment"># 这个是要加入的内容</span></span><br></pre></td></tr></table></figure>

<p>然后重启mysql&#x2F;mariadb之后，就可以不用密码而直接进去了。<br>这个时候我们就可以执行命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> mysql.user <span class="keyword">SET</span> Password<span class="operator">=</span>PASSWORD(<span class="operator">&amp;</span>#<span class="number">039</span>;your password<span class="operator">&amp;</span>#<span class="number">039</span>;) <span class="keyword">WHERE</span> <span class="keyword">User</span><span class="operator">=</span><span class="operator">&amp;</span>#<span class="number">039</span>;root<span class="operator">&amp;</span>#<span class="number">039</span>;;</span><br></pre></td></tr></table></figure>
<p>这样就把密码给修改了。修改之后。然后我们将<code>my.cnf</code>中的这行注释掉：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#skip-grant-tables</span></span><br></pre></td></tr></table></figure>
<p>然后重启就可以了。<br>这样就实现了我们mysql&#x2F;mariadb的重置密码功能了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/mongodb-replica-set/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/mongodb-replica-set/" class="post-title-link" itemprop="url">MongoDB副本集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:18" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:18+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mongodb/" itemprop="url" rel="index"><span itemprop="name">mongodb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于副本集的理论我就不介绍了。下面说下如何实现副本集的操作。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><ol>
<li>首先就是要安装MongoDB服务器了。我建议按照我之前写的<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000005176288">这篇文章</a>进行安装。</li>
<li>准备三台以上的服务器。然后同时安装MongoDB。我们三台服务器的IP分别是（10.55.160.91，10.55.160.92，10.55.160.93）</li>
</ol>
<h2 id="部署一个副本集"><a href="#部署一个副本集" class="headerlink" title="部署一个副本集"></a>部署一个副本集</h2><ol>
<li><p>修改配置文件。<br> 首先我们打开配置文件。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/mongod.conf</span><br></pre></td></tr></table></figure>
<p> 找到<code>bindIp: 127.0.0.1</code>这行，我们需要对这行进行注释。变成如下这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bindIp: 127.0.0.1  # Listen to local interface only, comment to listen on all interfaces.</span></span><br></pre></td></tr></table></figure>
<p> 因为这个<code>bindIp</code>代表只允许本机进行连接，然后不允许其他服务器进行连接，那么，下面就没有办法继续执行了。</p>
<p> 找到<code>#replication:</code>这行我们将其注释去掉，然后下面增加一行，变成下面这样：</p>
 <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">replication:</span><br><span class="line">  replSetName: test</span><br></pre></td></tr></table></figure>
<p> <code>replSetName</code>表示副本集组的名字(<code>test</code>是我自己写的，你们也可以写你们自己的喜欢的名字)，比如，我们要将三台服务器进行关联，那么我们就要将三台服务器都设置为相同的名字。</p>
<p> 然后如果三台服务器的MongoDB都已经启动了，那么就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod restart</span><br></pre></td></tr></table></figure>
<p> 如果没有启动就执行以下命令：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mongod start</span><br></pre></td></tr></table></figure>
</li>
<li><p>链接到任意一台服务器。<br> 我选择的是链接到<code>10.55.160.91</code>。也就是我现在正在操作的这一台服务器。然后登录：</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo</span><br></pre></td></tr></table></figure></li>
<li><p>初始化副本集。<br> 初始化副本集，我们需要使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.initiate/#rs.initiate"><code>rs.initiate()</code></a>方法。<br> 我现在需要添加的是三台服务器，我们可以执行以下方法：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">initiate</span>(&#123;</span><br><span class="line">    <span class="attr">_id</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">version</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">members</span>: [</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">0</span>, host : <span class="string">&quot;10.55.160.91:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">1</span>, host : <span class="string">&quot;10.55.160.92:27017&quot;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">_id</span>: <span class="number">2</span>, host : <span class="string">&quot;10.55.160.93:27017&quot;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p> 当返回值显示为如下的时候，就代表成功了：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ok&quot;</span> : <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>这样就完成了，是不是很简单。哈哈。</p>
</li>
</ol>
<p>然后你就发现你的输入命令的标题就变了。变成如下这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test</span>:<span class="variable constant_">OTHER</span>&gt;</span><br></pre></td></tr></table></figure>
<p>不管它，我们继续执行操作，执行<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>，查看当前状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">status</span>()</span><br></pre></td></tr></table></figure>
<p>查看返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:36.607Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">154</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;infoMessage&quot;</span> : <span class="string">&quot;could not find member to sync from&quot;</span>,</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531709</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:29Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">17</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474531710</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:30Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:35.966Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T08:08:32.078Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们主要是看<code>members</code>字段里面的<code>stateStr</code>的值。</p>
<p>很幸运，我当前执行命令的服务器被推举为主服务器。</p>
<p>如果你们现在服务器显示当前的服务器的状态是:<code>SECONDARY</code>。表示该服务器是从服务器，我们需要查看哪台服务器为主服务器，也就是<code>&quot;stateStr&quot; : &quot;PRIMARY&quot;</code>。我们需要在主服务器才进行进行操作，当然，也有强行在从服务器进行操作的办法。这里先不说。</p>
<p>这样我们就可以在主服务器进行操作了。比如存储数据。</p>
<h2 id="添加成员"><a href="#添加成员" class="headerlink" title="添加成员"></a>添加成员</h2><p>比如现在又有了一台服务器(10.55.160.94)需要加入到这个副本集中。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.add/#rs.add"><code>rs.add()</code></a>进行添加服务器。</p>
<p>首先我们还是别忘了修改配置文件的步骤。。。。。。修改完成配置文件之后重启Mongod，然后在主服务器执行如下命令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">add</span>(<span class="string">&quot;10.55.160.94:27017&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在执行该命令之后，可能会出现主服务器的选择，我们要注意主服务器是否已经变成了别的服务器。我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>查看新的主服务器是什么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:53.913Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">1</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>),</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.095Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1207</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536383</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:26:23Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">71</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474536460</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">6</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:27:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.089Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T09:28:52.059Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">6</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改服务器的优先级"><a href="#修改服务器的优先级" class="headerlink" title="修改服务器的优先级"></a>修改服务器的优先级</h2><p>比如我们新添加的服务器(10.55.160.94)，这个服务器的配置较高。我希望优先让它成为主服务器。我们可以通过如下方式进行修改：</p>
<p>首先我们可以通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.conf/#rs.conf"><code>rs.conf</code></a>来查看是第几个游标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">conf</span>()</span><br></pre></td></tr></table></figure>
<p>返回值如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;version&quot;</span> : <span class="number">6</span>,</span><br><span class="line">	<span class="string">&quot;protocolVersion&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">1</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;host&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;arbiterOnly&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;buildIndexes&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">&quot;hidden&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">&quot;priority&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;tags&quot;</span> : &#123;</span><br><span class="line">				</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;slaveDelay&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;votes&quot;</span> : <span class="number">1</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;chainingAllowed&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="number">2000</span>,</span><br><span class="line">		<span class="string">&quot;heartbeatTimeoutSecs&quot;</span> : <span class="number">10</span>,</span><br><span class="line">		<span class="string">&quot;electionTimeoutMillis&quot;</span> : <span class="number">10000</span>,</span><br><span class="line">		<span class="string">&quot;getLastErrorModes&quot;</span> : &#123;</span><br><span class="line">			</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;getLastErrorDefaults&quot;</span> : &#123;</span><br><span class="line">			<span class="string">&quot;w&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;wtimeout&quot;</span> : <span class="number">0</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="string">&quot;replicaSetId&quot;</span> : <span class="title class_">ObjectId</span>(<span class="string">&quot;57e391736b7581c82cc75a83&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到它的游标是第3个(从0开始计算)。<br>我们可以这样进行修改：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">3</span>].<span class="property">priority</span> = <span class="number">10</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>过了一会，我们就看到主服务器变成(10.55.160.94)了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:48.348Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.535Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4197</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.674Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">4202</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">3066</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">2</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">7</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:46.676Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:18:47.546Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474539241</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-22T10:14:01Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">7</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="添加仲裁者服务器"><a href="#添加仲裁者服务器" class="headerlink" title="添加仲裁者服务器"></a>添加仲裁者服务器</h2><p>仲裁者服务器只参与投票，而不是进行数据的存储。别忘了定义副本集名称。</p>
<p>我们可以使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.addArb/#rs.addArb"><code>rs.addArb()</code></a>来进行添加一台新的服务器（10.55.160.95）为仲裁服务器。</p>
<p>命令如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">addArb</span>(<span class="string">&#x27;10.55.160.95&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>返回<code>&#123; &quot;ok&quot; : 1 &#125;</code>就正常执行了。这时我们通过<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.status/#rs.status"><code>rs.status()</code></a>来看一下服务器的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.854Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">141</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">95</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:44.091Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.93:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">86</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.121Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">83</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599221</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:41Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.134Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">79</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:43.113Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:54:42.775Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">8</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到IP为<code>10.55.160.95</code>这台服务器，它的<code>stateStr</code>的值是<code>ARBITER</code>。这个就代表是仲裁者的角色。</p>
<h2 id="移除成员"><a href="#移除成员" class="headerlink" title="移除成员"></a>移除成员</h2><p>移除成员我们使用<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/rs.remove/#rs.remove"><code>rs.remove()</code></a>方法就可以了。</p>
<p>比如我们要移除10.55.160.93。我们可以使用如下命令:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rs.<span class="title function_">remove</span>(<span class="string">&#x27;10.55.160.93:27017&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>我们可以使用<code>rs.status()</code>查看一下返回值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;set&quot;</span> : <span class="string">&quot;test&quot;</span>,</span><br><span class="line">	<span class="string">&quot;date&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:21Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;myState&quot;</span> : <span class="number">2</span>,</span><br><span class="line">	<span class="string">&quot;term&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>),</span><br><span class="line">	<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">	<span class="string">&quot;heartbeatIntervalMillis&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">2000</span>),</span><br><span class="line">	<span class="string">&quot;members&quot;</span> : [</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.91:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1377</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span>,</span><br><span class="line">			<span class="string">&quot;self&quot;</span> : <span class="literal">true</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.92:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">2</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;SECONDARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1331</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.593Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.592Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;syncingTo&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">3</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.94:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;PRIMARY&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1319</span>,</span><br><span class="line">			<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">				<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474600512</span>, <span class="number">1</span>),</span><br><span class="line">				<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:12Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.595Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.582Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;electionTime&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474599220</span>, <span class="number">1</span>),</span><br><span class="line">			<span class="string">&quot;electionDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T02:53:40Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;_id&quot;</span> : <span class="number">4</span>,</span><br><span class="line">			<span class="string">&quot;name&quot;</span> : <span class="string">&quot;10.55.160.95:27017&quot;</span>,</span><br><span class="line">			<span class="string">&quot;health&quot;</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;state&quot;</span> : <span class="number">7</span>,</span><br><span class="line">			<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;ARBITER&quot;</span>,</span><br><span class="line">			<span class="string">&quot;uptime&quot;</span> : <span class="number">1315</span>,</span><br><span class="line">			<span class="string">&quot;lastHeartbeat&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:20.596Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;lastHeartbeatRecv&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:15:17.585Z&quot;</span>),</span><br><span class="line">			<span class="string">&quot;pingMs&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">0</span>),</span><br><span class="line">			<span class="string">&quot;configVersion&quot;</span> : <span class="number">9</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现10.55.160.93这个服务器已经从副本集中消失了。</p>
<h2 id="更换副本集成员"><a href="#更换副本集成员" class="headerlink" title="更换副本集成员"></a>更换副本集成员</h2><p>我们可以使用如下办法进行快速更换成员：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cfg = rs.<span class="title function_">conf</span>()</span><br><span class="line">cfg.<span class="property">members</span>[<span class="number">0</span>].<span class="property">host</span> = <span class="string">&quot;10.55.160.93&quot;</span></span><br><span class="line">rs.<span class="title function_">reconfig</span>(cfg)</span><br></pre></td></tr></table></figure>
<p>我们看之前被替换走的成员，它的状态已经变成这样了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;state&quot;</span> : <span class="number">10</span>,</span><br><span class="line">	<span class="string">&quot;stateStr&quot;</span> : <span class="string">&quot;REMOVED&quot;</span>,</span><br><span class="line">	<span class="string">&quot;uptime&quot;</span> : <span class="number">3162</span>,</span><br><span class="line">	<span class="string">&quot;optime&quot;</span> : &#123;</span><br><span class="line">		<span class="string">&quot;ts&quot;</span> : <span class="title class_">Timestamp</span>(<span class="number">1474602195</span>, <span class="number">1</span>),</span><br><span class="line">		<span class="string">&quot;t&quot;</span> : <span class="title class_">NumberLong</span>(<span class="number">9</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;optimeDate&quot;</span> : <span class="title class_">ISODate</span>(<span class="string">&quot;2016-09-23T03:43:15Z&quot;</span>),</span><br><span class="line">	<span class="string">&quot;ok&quot;</span> : <span class="number">0</span>,</span><br><span class="line">	<span class="string">&quot;errmsg&quot;</span> : <span class="string">&quot;Our replica set config is invalid or we are not a member of it&quot;</span>,</span><br><span class="line">	<span class="string">&quot;code&quot;</span> : <span class="number">93</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/python3-interaction-back-button/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/python3-interaction-back-button/" class="post-title-link" itemprop="url">centos上Python3交互模式无法使用后退键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:25:04" itemprop="dateCreated datePublished" datetime="2017-11-17T16:25:04+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/python/pip/" itemprop="url" rel="index"><span itemprop="name">pip</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在CentOS（7.2）上安装了Python3用来学习，在进入交互模式之后，发现无法使用后退键。这特别的不方便。可以使用以下方法来解决问题：</p>
<p>首先安装一个包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install patch ncurses ncurses-devel</span><br></pre></td></tr></table></figure>

<p>然后使用pip安装包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install readline</span><br></pre></td></tr></table></figure>

<p>安装完成以后，我们就可以正常使用python了。也可以使用后退键和方向键了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/mysql-replicate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/mysql-replicate/" class="post-title-link" itemprop="url">mysql 复制</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:24:36" itemprop="dateCreated datePublished" datetime="2017-11-17T16:24:36+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>MySQL的复制功能是构建基于MySQL的大规模、高性能应用的基础。复制功能不仅有利于构建高性能的应用，同时也是高可用性、可扩展性、灾难恢复、备份以及数据仓库等工作的基础。</p>
<p>本文主要讲述复制如何工作，基本的复制如何搭建，复制的相关配置和优化复制服务器。</p>
<h2 id="复制的工作原理："><a href="#复制的工作原理：" class="headerlink" title="复制的工作原理："></a>复制的工作原理：</h2><p>简单来说，复制分为下面三个步骤：</p>
<ol>
<li>在主库上把数据更改记录到二进制日志中（这些记录被称为二进制日志事件）。</li>
<li>备库将主库上的日志复制到自己的中继日志（relay log）中。</li>
<li>备库读取中继日志中的事件，将其重放到备库数据之上。</li>
</ol>
<h2 id="配置复制"><a href="#配置复制" class="headerlink" title="配置复制"></a>配置复制</h2><p>为MySQL服务器配置复制非常简单。最基本的场景是新安装的主库和备库，总的来说分为以下几步：</p>
<ol>
<li>在每台服务器上创建复制账号。</li>
<li>配置主库和备库。</li>
<li>通知备库连接到主库并从主库复制数据。</li>
</ol>
<h3 id="创建复制账号"><a href="#创建复制账号" class="headerlink" title="创建复制账号"></a>创建复制账号</h3><p>MySQL 会赋予一个特殊的权限给复制线程。在备库运行的I&#x2F;O线程会建立一个到主库的TCP&#x2F;IP连接。这意味着必须在主库创建一个用户，并赋予一个合适的权限。</p>
<p>通过如下语句创建用户账号：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave, replication client on *.* to repl@<span class="string">&#x27;10.55.160.%&#x27;</span> identified by <span class="string">&#x27;Pw12345.&#x27;</span>;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>请注意我们将这个账户限制在本地网络。因为这是一个特权账号。</p>
<p>复制账户只需要有主库上的 replication slave 权限，并不需要每一端都赋予 replication client 权限，为啥两端都要赋予呢：</p>
<ul>
<li>用来监控和管理复制的账号需要 replication client 权限，并且针对两个目的使用同一个账号更加容易。</li>
<li>如果在主库上建立了账号，然后从主库将数据克隆到备库上时，备库也就设置了 ———— 变成主库所需要的角色，方便后续有需要进行转换角色。</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在主库的 <code>my.cnf</code> 文件中增加或者修改如下内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log_bin</span>=mysql-bin</span><br><span class="line"><span class="attr">server_id</span>=<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>必须明确的指定一个唯一的服务器ID，默认服务器ID为1，使用默认值可能会导致和其它服务器的ID产生冲突，所以我们选择10来作为ID，一般的做法时使用服务器的末8位，但要保证它是不变且唯一的。最好选择一些有意义的约定并遵循。</p>
<p>如果之前没有在MySQL的配置中指定<code>log_bin</code>选项，需要重新启动MySQL。为了确认二进制日志文件是否已经创建，我们使用以下命令进行查看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">             File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">         Position: <span class="number">154</span></span><br><span class="line">     Binlog_Do_DB: </span><br><span class="line"> Binlog_Ignore_DB: </span><br><span class="line">Executed_Gtid_Set: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>需要在备库上的<code>my.cnf</code>文件中增加类似的配置，并且同样需要重启服务器：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log_bin<span class="operator">=</span>mysql<span class="operator">-</span>bin</span><br><span class="line">server_id<span class="operator">=</span><span class="number">11</span></span><br><span class="line">relay_log<span class="operator">=</span><span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysql<span class="operator">-</span>relay<span class="operator">-</span>bin</span><br><span class="line">log_slave_updates<span class="operator">=</span><span class="number">1</span></span><br><span class="line">read_only<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>从技术上来说，这些选项都不是必须的。其中一些选项只是显式的列出了默认值。事实上只有<code>server_id</code>时必需的。</p>
<p><code>log_bin</code>：默认情况下，它是根据机器名来命名的，但是如果机器名变化了可能会出现问题，为了简便起见，我们在主库和备库设置了同样的值。<br><code>relay_log</code>：指定中继日志的位置和命名。<br><code>slave_updates</code>：允许备库将其重放的事件也记录到自身的二进制日志中。<br><code>read_only</code>：该选项会阻止没有任何特权权限的线程修改数据。所以最好不要给用户超出需要的权限。但是并不是很实用，特别是那些需要在备库建表的应用。</p>
<h3 id="启动复制"><a href="#启动复制" class="headerlink" title="启动复制"></a>启动复制</h3><p>下面我们告诉备库如何连接到主库并重放其二进制日志。这一步不要通过<strong>my.cnf</strong>来配置，而是使用 <code>change master to</code> 语句。因为该语句完全替代了<strong>my.cnf</strong>中相应的配置而且允许以后指向别的主库的时候无需重启备库。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;10.55.160.91&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;repl&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;Pw12345.&#x27;</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">2</span> warnings (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<p><strong>master_log_pos</strong>参数倍设置成0，因为要从日志的开头读起。我们可以通过<code>show slave status</code>语句来检查复制是否正确执行了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: <span class="keyword">No</span></span><br><span class="line">            Slave_SQL_Running: <span class="keyword">No</span></span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">              Relay_Log_Space: <span class="number">154</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="keyword">NULL</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">0</span></span><br><span class="line">                  Master_UUID: </span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: </span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p><code>Slave_IO_State</code>、<code>Slave_IO_Running</code>、<code>Slave_SQL_Running</code>这三列显式当前备库尚未运行。</p>
<p>运行下面的命令进行复制：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>执行该命令没有显示错误，我们再用<code>show slave status</code>命令检查一下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: </span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">4</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: <span class="keyword">No</span></span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">4</span></span><br><span class="line">              Relay_Log_Space: <span class="number">154</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="keyword">NULL</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">1593</span></span><br><span class="line">                Last_IO_Error: Fatal error: The slave I<span class="operator">/</span>O thread stops because master <span class="keyword">and</span> slave have equal MySQL server UUIDs; these UUIDs must be different <span class="keyword">for</span> replication <span class="keyword">to</span> work.</span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">10</span></span><br><span class="line">                  Master_UUID: </span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: Slave has read <span class="keyword">all</span> relay log; waiting <span class="keyword">for</span> more updates</span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: <span class="number">161114</span> <span class="number">15</span>:<span class="number">28</span>:<span class="number">07</span></span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>看到这里报出一个错误：<code>Fatal error: The slave I/O thread stops because master and slave have equal MySQL server UUIDs; these UUIDs must be different for replication to work.</code>，其实这是因为我是用的虚拟机，然后直接进行复制的，倒是UUID相同，解决办法就是删除<code>auto.cnf</code>就好了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld stop</span><br><span class="line">Redirecting to /bin/systemctl stop  mysqld.service</span><br><span class="line">[root@localhost ~]# \rm /var/lib/mysql/auto.cnf </span><br><span class="line">[root@localhost ~]# service mysqld start</span><br><span class="line">Redirecting to /bin/systemctl start  mysqld.service</span><br></pre></td></tr></table></figure>

<p>然后我们继续上面的操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> slave;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> slave status\G</span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span> <span class="number">1.</span> <span class="type">row</span> <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master <span class="keyword">to</span> send event</span><br><span class="line">                  Master_Host: <span class="number">10.55</span><span class="number">.160</span><span class="number">.91</span></span><br><span class="line">                  Master_User: repl</span><br><span class="line">                  Master_Port: <span class="number">3306</span></span><br><span class="line">                Connect_Retry: <span class="number">60</span></span><br><span class="line">              Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">          Read_Master_Log_Pos: <span class="number">472</span></span><br><span class="line">               Relay_Log_File: mysql<span class="operator">-</span>relay<span class="operator">-</span>bin<span class="number">.000003</span></span><br><span class="line">                Relay_Log_Pos: <span class="number">685</span></span><br><span class="line">        Relay_Master_Log_File: mysql<span class="operator">-</span>bin<span class="number">.000001</span></span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: <span class="number">0</span></span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: <span class="number">0</span></span><br><span class="line">          Exec_Master_Log_Pos: <span class="number">472</span></span><br><span class="line">              Relay_Log_Space: <span class="number">892</span></span><br><span class="line">              Until_Condition: <span class="keyword">None</span></span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: <span class="number">0</span></span><br><span class="line">           Master_SSL_Allowed: <span class="keyword">No</span></span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: <span class="number">0</span></span><br><span class="line">Master_SSL_Verify_Server_Cert: <span class="keyword">No</span></span><br><span class="line">                Last_IO_Errno: <span class="number">0</span></span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: <span class="number">0</span></span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: <span class="number">10</span></span><br><span class="line">                  Master_UUID: a901199b<span class="operator">-</span>aa23<span class="number">-11e6</span><span class="number">-862e-000</span>c2943e6a3</span><br><span class="line">             Master_Info_File: <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>master.info</span><br><span class="line">                    SQL_Delay: <span class="number">0</span></span><br><span class="line">          SQL_Remaining_Delay: <span class="keyword">NULL</span></span><br><span class="line">      Slave_SQL_Running_State: Slave has read <span class="keyword">all</span> relay log; waiting <span class="keyword">for</span> more updates</span><br><span class="line">           Master_Retry_Count: <span class="number">86400</span></span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: <span class="number">0</span></span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>这样就正常了。Slave_IO_State 显示正在等待从主库传递过来的事件，这意味着I&#x2F;O线程已经读取了主库所有的事件。</p>
<p>到此，一个全新的复制就搞定了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/yum-install-mysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/yum-install-mysql/" class="post-title-link" itemprop="url">yum 安装 mysql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:23:11" itemprop="dateCreated datePublished" datetime="2017-11-17T16:23:11+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>提示：以下命令都是在 <code>root</code> 账户下执行的命令。</p>
</blockquote>
<p>每次安装mysql的时候都非常痛苦。因为至少要编译半个小时，在想有没有什么简单的办法，我一查官方文档，真让我看到一个简单的yum的安装办法。现在步骤如下：</p>
<h2 id="删除已经存在的mysql"><a href="#删除已经存在的mysql" class="headerlink" title="删除已经存在的mysql"></a>删除已经存在的mysql</h2><p>我们执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mysql</span><br><span class="line">rpm -e mysql mysql-libs</span><br><span class="line">yum -y remove mysql-server mysql mysql-libs</span><br></pre></td></tr></table></figure>

<h2 id="配置源"><a href="#配置源" class="headerlink" title="配置源"></a>配置源</h2><p>首先我们需要获取分发源的地址（<a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/repo/yum/">点击此处</a>）。我现在提供 Red Hat&#x2F;CentOS 连接如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat7/CentOS7</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat6/CentOS6</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el6-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Red Hat5/CentOS5</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-el5-7.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 24</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc24-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 23</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc23-9.noarch.rpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Fedora 22</span></span><br><span class="line">http://dev.mysql.com/get/mysql57-community-release-fc22-8.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>比如说我现在的系统是CentOS7，那么我就使用如下方法进行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -ivh http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line">获取http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</span><br><span class="line">警告：/var/tmp/rpm-tmp.yIWWrJ: 头V3 DSA/SHA1 Signature, 密钥 ID 5072e1f5: NOKEY</span><br><span class="line">准备中...                          ################################# [100%]</span><br><span class="line">正在升级/安装...</span><br><span class="line">   1:mysql57-community-release-el7-9  ################################# [100%]</span><br></pre></td></tr></table></figure>

<p>我们可以通过以下方法检测是否已经成功安装了rpm源：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br><span class="line">mysql-connectors-community/x86_64        MySQL Connectors Community           24</span><br><span class="line">mysql-tools-community/x86_64             MySQL Tools Community                38</span><br><span class="line">mysql57-community/x86_64                 MySQL 5.7 Community Server          146</span><br></pre></td></tr></table></figure>

<p>出现最后一行内容就表示已经安装成功了。</p>
<h2 id="选择安装版本"><a href="#选择安装版本" class="headerlink" title="选择安装版本"></a>选择安装版本</h2><blockquote>
<p>注意，默认安装源之后自动开启5.7系列的安装。如果你要安装的MySQL低于5.7那么可以通过本节来进行修改源，否则跳过本节即可。</p>
</blockquote>
<p>当你使用此方法进行安装MySQL的时候，会默认安装mysql的最新稳定版本（在我现在安装的时候，最新版本为5.7.16）。如果这就是你想要安装的，那么你就可以忽略这步了。如果想要安装以前的版本，比如5.6或者5.5，那么就可以用下面的方法来配置了。</p>
<p>首先我们先查看MySQL的那些源被禁用或者启用了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist all | grep mysql</span><br><span class="line">mysql-connectors-community/x86_64 MySQL Connectors Community         启用:    24</span><br><span class="line">mysql-connectors-community-source MySQL Connectors Community - Sourc 禁用</span><br><span class="line">mysql-tools-community/x86_64      MySQL Tools Community              启用:    38</span><br><span class="line">mysql-tools-community-source      MySQL Tools Community - Source     禁用</span><br><span class="line">mysql-tools-preview/x86_64        MySQL Tools Preview                禁用</span><br><span class="line">mysql-tools-preview-source        MySQL Tools Preview - Source       禁用</span><br><span class="line">mysql55-community/x86_64          MySQL 5.5 Community Server         禁用</span><br><span class="line">mysql55-community-source          MySQL 5.5 Community Server - Sourc 禁用</span><br><span class="line">mysql56-community/x86_64          MySQL 5.6 Community Server         禁用</span><br><span class="line">mysql56-community-source          MySQL 5.6 Community Server - Sourc 禁用</span><br><span class="line">mysql57-community/x86_64          MySQL 5.7 Community Server         启用:   146</span><br><span class="line">mysql57-community-source          MySQL 5.7 Community Server - Sourc 禁用</span><br><span class="line">mysql80-community/x86_64          MySQL 8.0 Community Server         禁用</span><br><span class="line">mysql80-community-source          MySQL 8.0 Community Server - Sourc 禁用</span><br></pre></td></tr></table></figure>

<p>比如我们看到现在启用的是5.7版本系列的。我们需要安装的是5.6系列的。那么我们就可以执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum-config-manager --disable mysql57-community</span><br><span class="line">-bash: yum-config-manager: 未找到命令</span><br></pre></td></tr></table></figure>

<p>提示没有找到命令，那么我们就需要安装执行以下命令来安装一个包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils </span><br></pre></td></tr></table></figure>

<p>执行成功之后就好了，那么我们继续执行上面的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --disable mysql57-community</span><br><span class="line">yum-config-manager --enable mysql56-community</span><br></pre></td></tr></table></figure>

<p>我们看看现在的系统配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum repolist enabled | grep mysql</span><br><span class="line">mysql-connectors-community/x86_64        MySQL Connectors Community           24</span><br><span class="line">mysql-tools-community/x86_64             MySQL Tools Community                38</span><br><span class="line">mysql56-community/x86_64                 MySQL 5.6 Community Server          289</span><br></pre></td></tr></table></figure>

<p>好了。下面就可以进行安装MySQL了。</p>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p>我这里也是使用MySQL5.7来安装的。</p>
<p>我们只需要执行以下命令就OK了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure>

<p>#MySQL 管理命令</p>
<p>使用下面的命令启动MySQL：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld start</span><br><span class="line">Redirecting to /bin/systemctl start  mysqld.service</span><br></pre></td></tr></table></figure>

<p>只要没有错误信息就表示已经正常启动了。</p>
<p>现在我们看以下MySQL的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service mysqld status</span><br><span class="line">Redirecting to /bin/systemctl status  mysqld.service</span><br><span class="line">● mysqld.service - MySQL Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 一 2016-11-14 12:34:44 CST; 5min ago</span><br><span class="line">  Process: 35494 ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 35421 ExecStartPre=/usr/bin/mysqld_pre_systemd (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 35498 (mysqld)</span><br><span class="line">   CGroup: /system.slice/mysqld.service</span><br><span class="line">           └─35498 /usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line">11月 14 12:34:39 localhost.localdomain systemd[1]: Starting MySQL Server...</span><br><span class="line">11月 14 12:34:44 localhost.localdomain systemd[1]: Started MySQL Server.</span><br></pre></td></tr></table></figure>

<p>这样表示已经正常启动了。</p>
<p>停止：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br></pre></td></tr></table></figure>

<p>重启：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>

<h2 id="修改MySQL密码"><a href="#修改MySQL密码" class="headerlink" title="修改MySQL密码"></a>修改MySQL密码</h2><p>我们首先查找一下MySQL的密码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br><span class="line">2016-11-14T04:34:41.742516Z 1 [Note] A temporary password is generated for root@localhost: sNKz9yEdzw%/</span><br></pre></td></tr></table></figure>

<p>我们就可以看到我们的密码就是： **sNKz9yEdzw%&#x2F;**。</p>
<p>首先启动MySQL client:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.16</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span></span><br></pre></td></tr></table></figure>

<p>首先我们先查看一下数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line">ERROR <span class="number">1820</span> (HY000): You must reset your password <span class="keyword">using</span> <span class="keyword">ALTER</span> <span class="keyword">USER</span> statement before executing this statement.</span><br></pre></td></tr></table></figure>

<p>这里提示我们需要修改密码：</p>
<p>这里MySQL安装了 <a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/refman/5.7/en/validate-password-plugin.html">validate_password</a>。这个插件要求密码至少包含一个大写字母，一个小写字母，一个数字和一个特殊字符，并且密码长度至少8个字符。</p>
<p>比如我们定义密码为 **Pw12345.**。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> password <span class="operator">=</span> password(<span class="string">&#x27;Pw12345.&#x27;</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<p>然后我们就可以正常的执行SQL命令了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="使用Yum-安装其它的MySQL产品和组件"><a href="#使用Yum-安装其它的MySQL产品和组件" class="headerlink" title="使用Yum 安装其它的MySQL产品和组件"></a>使用Yum 安装其它的MySQL产品和组件</h2><p>我们查看一下有什么可以安装的MySQL产品和组件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum --disablerepo=\* --enablerepo=&#x27;mysql*-community*&#x27; list available</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">可安装的软件包</span><br><span class="line">mysql-community-bench.x86_64                                     5.6.34-2.el7                             mysql56-community         </span><br><span class="line">mysql-community-client.i686                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-client.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-common.i686                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-common.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-devel.i686                                       8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-devel.x86_64                                     8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded.i686                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded.x86_64                                  8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-compat.i686                             8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-compat.x86_64                           8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-devel.i686                              8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-embedded-devel.x86_64                            8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs.i686                                        8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs.x86_64                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs-compat.i686                                 8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-libs-compat.x86_64                               8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-release.noarch                                   el7-7                                    mysql57-community         </span><br><span class="line">mysql-community-server.x86_64                                    8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-community-test.x86_64                                      8.0.0-0.1.dmr.el7                        mysql80-community         </span><br><span class="line">mysql-connector-odbc.x86_64                                      5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-odbc-debuginfo.x86_64                            5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-odbc-setup.x86_64                                5.3.6-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python.noarch                                    2.0.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python.x86_64                                    2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python-cext.x86_64                               2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-connector-python-debuginfo.x86_64                          2.1.4-1.el7                              mysql-connectors-community</span><br><span class="line">mysql-router.x86_64                                              2.0.3-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-router-debuginfo.x86_64                                    2.0.3-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-utilities.noarch                                           1.6.4-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-utilities-extra.noarch                                     1.5.6-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-workbench-community.x86_64                                 6.3.8-1.el7                              mysql-tools-community     </span><br><span class="line">mysql-workbench-community-debuginfo.x86_64                       6.3.8-1.el7                              mysql-tools-community</span><br></pre></td></tr></table></figure>

<p>我们可以使用以下命令来安装任何一个软件包，替换 <em>package-name</em> 为你要安装的软件包的名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install package-name</span><br></pre></td></tr></table></figure>

<p>例如：我们要安装 <code>mysql-community-libs</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-libs</span><br></pre></td></tr></table></figure>

<h2 id="禁止更新"><a href="#禁止更新" class="headerlink" title="禁止更新"></a>禁止更新</h2><p>我们在安装之后，为了能够正常运行，我们会禁止MySQL进行更新。因为在yum更新了MySQL之后，MySQL会自动重启。这对于我们来说是没有必要的，所以我们可以屏蔽更新。我们可以这样，将下列指定放到你的<code>/etc/yum.conf</code>文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exclude=mysql-community-client,mysql-community-common,mysql-community-libs,mysql-community-server</span><br></pre></td></tr></table></figure>

<h2 id="更新MySQL"><a href="#更新MySQL" class="headerlink" title="更新MySQL"></a>更新MySQL</h2><p>一般在生产环境，我们都是禁用更新的。所以说，这里只是作为一个参考。<br>我们需要执行的命令就是：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update mysql-server</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： 在使用 yum 更新之后，MySQL服务器会自动重启。</p>
</blockquote>
<h2 id="更新单个组件"><a href="#更新单个组件" class="headerlink" title="更新单个组件"></a>更新单个组件</h2><p>我们也可以指定更新单个组件。首先我们先运行以下命令来查看MySQL的组件列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@baoguoxiao ~]# yum list installed | grep &quot;^mysql&quot;</span><br><span class="line">mysql-community-client.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-common.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-libs.x86_64      5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql-community-server.x86_64    5.7.17-1.el7                   @mysql57-community</span><br><span class="line">mysql57-community-release.noarch el7-9                          installed</span><br></pre></td></tr></table></figure>

<p>我们可以使用以下命令来更新任何一个软件包，替换 <em>package-name</em> 为你要安装的软件包的名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update package-name</span><br></pre></td></tr></table></figure>

<p>例如：我们要安装 <code>mysql-community-client</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update mysql-community-client</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面实现了MySQL的默认安装，命令管理，修改密码，屏蔽更新以及更新。希望能对大家有所帮助。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/redis-geo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/redis-geo/" class="post-title-link" itemprop="url">Redis 的 GEO 特性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 16:14:41" itemprop="dateCreated datePublished" datetime="2017-11-17T16:14:41+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-12 23:48:00" itemprop="dateModified" datetime="2022-04-12T23:48:00+08:00">2022-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%93%E5%AD%98/" itemprop="url" rel="index"><span itemprop="name">缓存</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%93%E5%AD%98/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">服务器端</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%93%E5%AD%98/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天看文档，无意中发现了 Redis 的一个新功能。<br>Redis 在 3.2 版本实现了一个地理位置计算的特性。</p>
<h2 id="版本要求"><a href="#版本要求" class="headerlink" title="版本要求"></a>版本要求</h2><p>Redis 3.2 或者更新</p>
<h2 id="添加和获取位置"><a href="#添加和获取位置" class="headerlink" title="添加和获取位置"></a>添加和获取位置</h2><h3 id="geoadd-添加位置"><a href="#geoadd-添加位置" class="headerlink" title="geoadd (添加位置)"></a>geoadd (添加位置)</h3><p>这个命令对于经纬度是有要求的:</p>
<ul>
<li>有效的经度从-180度到180度。</li>
<li>有效的纬度从-85.05112878度到85.05112878度。</li>
</ul>
<p>如果超出返回，那么命令就会返回一个错误.</p>
<p>添加命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD location-set longitude latitude name [longitude latitude name ...]</span><br></pre></td></tr></table></figure>

<p>这个可以同时添加多个位置。其中 <strong>location-set</strong> 是存储地理位置的集合名称，<strong>longitude</strong>，<strong>latitude</strong> 和 <strong>name</strong> 则是地理位置的精度、纬度、名字。</p>
<p>下面添加北京的地铁站的坐标：</p>
<p>添加单个位置如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd subways 116.404269 39.906543 qianmen</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>添加多个位置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geoadd subways 116.409465 39.939578 nanluoguxiang 116.402549 39.944163 shichahai 116.315934 40.005471 yuanmingyuan 116.399279 40.007208 aolinpikegongyuan</span><br><span class="line">(integer) 4</span><br></pre></td></tr></table></figure>

<p>将坐标记录到位置集合之后，我们使用 <code>geopos</code> 命令来获取位置的名字和具体经纬度</p>
<p>获取命令如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOPOS location-set name [name ...]</span><br></pre></td></tr></table></figure>

<p>比如说，如果我们想要获取圆明园、前门的经纬度，那么我们就可以执行以下代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos subways yuanmingyuan qianmen</span><br><span class="line">1) 1) &quot;116.31593316793441772&quot;</span><br><span class="line">   2) &quot;40.00546983911101506&quot;</span><br><span class="line">2) 1) &quot;116.40426903963088989&quot;</span><br><span class="line">   2) &quot;39.90654220698316834&quot;</span><br></pre></td></tr></table></figure>

<h2 id="计算两个点之前的距离"><a href="#计算两个点之前的距离" class="headerlink" title="计算两个点之前的距离"></a>计算两个点之前的距离</h2><p>命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEODIST location-set location-x location-y [unit]</span><br></pre></td></tr></table></figure>

<p>可选参数 <code>unit</code> 用于指定计算距离时的单位，它的值为下面的一个：</p>
<ul>
<li>m 表示单位为米。</li>
<li>km 表示单位为千米。</li>
<li>mi 表示单位为英里。</li>
<li>ft 表示单位为英尺。</li>
</ul>
<p>比如我们要计算奥林匹克公园和圆明园的距离：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist subways yuanmingyuan aolinpikegongyuan</span><br><span class="line">&quot;7103.4924&quot;</span><br></pre></td></tr></table></figure>

<p>如果我们指定单位为 <strong>km</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geodist subways yuanmingyuan aolinpikegongyuan km</span><br><span class="line">&quot;7.1035&quot;</span><br></pre></td></tr></table></figure>

<h2 id="获取指定范围内的元素"><a href="#获取指定范围内的元素" class="headerlink" title="获取指定范围内的元素"></a>获取指定范围内的元素</h2><p>Redis 提供了两种方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS location-set longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [ASC|DESC] [COUNT count]</span><br><span class="line"></span><br><span class="line">GEORADIUSBYMEMBER location-set location radius m|km|ft|mi [WITHCOORD] [WITHDIST] [ASC|DESC] [COUNT count]</span><br></pre></td></tr></table></figure>

<p>这两个命令都是用来查找特定范围地点的功能，但是指定中心点的方式不同：<code>georadius</code> 使用的是用户给定的经纬度，而 <code>georadiusbymember</code> 则使用存储在位置集合里面的某个地点作为中心点。</p>
<ul>
<li>m|km|ft|mi 指定的是计算范围时的单位；</li>
<li>如果给定了可选的 WITHCOORD ， 那么命令在返回匹配的位置时会将位置的经纬度一并返回；</li>
<li>如果给定了可选的 WITHDIST ， 那么命令在返回匹配的位置时会将位置与中心点之间的距离一并返回；</li>
<li>在默认情况下， GEORADIUS 和 GEORADIUSBYMEMBER 的结果是未排序的， ASC 可以让查找结果根据距离从近到远排序， 而 DESC 则可以让查找结果根据从远到近排序；</li>
<li>COUNT 参数指定要返回的结果数量。</li>
</ul>
<p>命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：</p>
<ul>
<li>ASC: 根据中心的位置， 按照从近到远的方式返回位置元素。</li>
<li>DESC: 根据中心的位置， 按照从远到近的方式返回位置元素。</li>
</ul>
<p>比如说我们要返回指定坐标的10km内的位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km</span><br><span class="line">1) &quot;qianmen&quot;</span><br><span class="line">2) &quot;nanluoguxiang&quot;</span><br><span class="line">3) &quot;shichahai&quot;</span><br></pre></td></tr></table></figure>

<p>我们还需要获取位置与中心点的距离:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist</span><br><span class="line">1) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">3) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br></pre></td></tr></table></figure>

<p>我们需要返回按照最远距离排序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist desc</span><br><span class="line">1) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">3) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br></pre></td></tr></table></figure>

<p>我们只需要两个就够了，三个太多了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist desc count 2</span><br><span class="line">1) 1) &quot;shichahai&quot;</span><br><span class="line">   2) &quot;3.2521&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br><span class="line">127.0.0.1:6379&gt; georadius subways 116.403878 39.914942 10 km withdist count 2</span><br><span class="line">1) 1) &quot;qianmen&quot;</span><br><span class="line">   2) &quot;0.9349&quot;</span><br><span class="line">2) 1) &quot;nanluoguxiang&quot;</span><br><span class="line">   2) &quot;2.7812&quot;</span><br></pre></td></tr></table></figure>

<p>获取前门10km附近的位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; georadiusbymember subways qianmen 10 km</span><br><span class="line">1) &quot;qianmen&quot;</span><br><span class="line">2) &quot;nanluoguxiang&quot;</span><br><span class="line">3) &quot;shichahai&quot;</span><br></pre></td></tr></table></figure>

<p>我们只是需要将其坐标换成集合名称中的会员名称就好了，用法跟之前的<code>georadius</code>相同。</p>
<p><code>georadius</code>和<code>georadiusbymember</code>执行的代价并不低，因此强烈建议为查询结果创建缓存。</p>
<h2 id="geohash"><a href="#geohash" class="headerlink" title="geohash"></a><code>geohash</code></h2><p>这个会返回一个11个字符的geohash字符串，使用内部52位表示。返回的geohashes具有以下特性:</p>
<ul>
<li>他们可以缩短从右边的字符。它将失去精度，但仍将指向同一地区。</li>
<li>它可以在 geohash.org 网站使用，网址<a target="_blank" rel="noopener" href="http://geohash.org/">http://geohash.org/</a><geohash-string>。查询例子：<a target="_blank" rel="noopener" href="http://geohash.org/sqdtr74hyu0">http://geohash.org/sqdtr74hyu0</a>.</li>
<li>与类似的前缀字符串是附近，但相反的是不正确的，这是可能的，用不同的前缀字符串附近。</li>
</ul>
<p>命令格式如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOHASH key member [member ...]</span><br></pre></td></tr></table></figure>

<p>例如我要查询前门的geohash:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geohash subways qianmen</span><br><span class="line">1) &quot;wx4g0bg02n0&quot;</span><br></pre></td></tr></table></figure>

<p>完了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/ubuntu-16-10-set-ssh-remote-access/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/ubuntu-16-10-set-ssh-remote-access/" class="post-title-link" itemprop="url">ubuntu 16.10 支持ssh远程访问</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 15:21:26" itemprop="dateCreated datePublished" datetime="2017-11-17T15:21:26+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-10-09 16:07:33" itemprop="dateModified" datetime="2022-10-09T16:07:33+08:00">2022-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>hell<br>sudo apt-get install openssh-server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后执行启动命令：</span><br><span class="line"></span><br><span class="line">````shell</span><br><span class="line">sudo systemctl start ssh</span><br></pre></td></tr></table></figure>

<h2 id="开机启动"><a href="#开机启动" class="headerlink" title="开机启动"></a>开机启动</h2><p>我们打开<code>/etc/rc.local</code>，加入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable ssh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果文件中如果有<code>exit 0</code>，一定要在其之前加入。</p>
</blockquote>
<p>这样我们的ubuntu就能正常远程访问了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://www.baoguoxiao.com/centos-build-lnmp-environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="魔王卷子">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="魔王卷子">
      <meta itemprop="description" content="记录我的工作中碰到的坑">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 魔王卷子">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/centos-build-lnmp-environment/" class="post-title-link" itemprop="url">如何搭建 LNMP 环境【编译版】</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-17 07:57:05" itemprop="dateCreated datePublished" datetime="2017-11-17T07:57:05+08:00">2017-11-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-08-14 01:00:08" itemprop="dateModified" datetime="2022-08-14T01:00:08+08:00">2022-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="本次教程使用的版本"><a href="#本次教程使用的版本" class="headerlink" title="本次教程使用的版本"></a>本次教程使用的版本</h2><ul>
<li><code>Rocky-9.0</code></li>
<li><code>Nginx-1.23.1</code></li>
<li><code>PHP-8.1.9</code></li>
<li><code>MySQL-8.0.30</code></li>
</ul>
<h2 id="添加指定用户"><a href="#添加指定用户" class="headerlink" title="添加指定用户"></a>添加指定用户</h2><p>添加用户（添加用户和用户组 <code>www</code> 和 <code>mysql</code>，并且禁止登录）。</p>
<p><code>www</code> 用户主要是用来赋予 <code>Nginx</code> 和 <code>PHP</code> 执行权限，<code>mysql</code> 主要是赋予给 <code>MySQL</code> 权限，禁止登录是为了防止用户有权限去操作 <code>www</code> 和 <code>mysql</code>，一切为了安全。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin www</span><br><span class="line">useradd -s /sbin/nologin mysql</span><br></pre></td></tr></table></figure>

<h2 id="添加预安装包"><a href="#添加预安装包" class="headerlink" title="添加预安装包"></a>添加预安装包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf install -y wget tar gcc gcc-c++ cmake pcre-devel openssl-devel zlib-devel libxml2-devel sqlite-devel libcurl-devel libpng-devel libwebp-devel libjpeg-devel freetype-devel libxslt-devel ncurses-devel libtirpc libudev-devel rpcgen</span><br></pre></td></tr></table></figure>

<h2 id="下载源码包"><a href="#下载源码包" class="headerlink" title="下载源码包"></a>下载源码包</h2><p>我一般都会将安装包放到 <code>/usr/local/src</code> 目录中，所以先执行下面的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/src</span><br></pre></td></tr></table></figure>

<p>首先我们先下载必需的安装包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget -c http://nginx.org/download/nginx-1.23.1.tar.gz</span><br><span class="line">wget -c http://www.php.net/distributions/php-8.1.9.tar.gz</span><br><span class="line">wget -c https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.30-linux-glibc2.17-x86_64-minimal.tar.xz</span><br></pre></td></tr></table></figure>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><ul>
<li><code>configure: error: Package requirements (oniguruma) were not met: </code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz</span><br><span class="line">tar zxf onig-6.9.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> onig-6.9.8</span><br><span class="line">./configure --libdir=/lib64</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<ul>
<li><code>error: Package requirements (libsodium &gt;= 1.0.8) were not met:</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://github.com/jedisct1/libsodium/releases/download/1.0.18-RELEASE/libsodium-1.0.18.tar.gz</span><br><span class="line">tar zxf libsodium-1.0.18.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libsodium-1.0.18</span><br><span class="line">./configure --libdir=/lib64</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<ul>
<li><code>error: Package requirements (libzip &gt;= 0.11 libzip != 1.3.1 libzip != 1.7.0) were not met:</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://libzip.org/download/libzip-1.9.2.tar.gz</span><br><span class="line">tar zxf libzip-1.9.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libzip-1.9.2</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../../</span><br><span class="line"><span class="built_in">ln</span> -sf /usr/local/lib64/libzip.so.5 /usr/local/lib/</span><br><span class="line">ldconfig /usr/local/lib</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Package &#39;libtirpc&#39;, required by &#39;virtual:world&#39;, not found</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -hvi https://dl.rockylinux.org/pub/rocky/9/CRB/x86_64/os/Packages/l/libtirpc-devel-1.3.2-1.el9.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h2 id="安装-PHP"><a href="#安装-PHP" class="headerlink" title="安装 PHP"></a>安装 PHP</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxf php-8.1.9.tar.gz</span><br><span class="line">cd php-8.1.9</span><br><span class="line">./configure --prefix=/usr/local/php --with-config-file-path=/usr/local/php/etc --with-config-file-scan-dir=/usr/local/php/conf.d --enable-fpm --with-fpm-user=www --with-fpm-group=www --enable-mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-iconv --with-freetype --with-jpeg --with-zlib --enable-xml --disable-rpath --enable-bcmath --enable-shmop --enable-sysvsem --with-curl --enable-mbregex --enable-mbstring --enable-intl --enable-pcntl --enable-ftp --enable-gd --with-openssl --with-mhash --enable-pcntl --enable-sockets --with-zip --enable-soap --with-gettext --enable-opcache --with-xsl --with-pear --with-webp --enable-exif --with-sodium</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cd ../</span><br></pre></td></tr></table></figure>

<h2 id="配置-PHP"><a href="#配置-PHP" class="headerlink" title="配置 PHP"></a>配置 PHP</h2><p>复制 <code>php.ini</code> 配置文件。下面的命令默认就是复制的开发模式的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/src/php-8.1.9/php.ini-development /usr/local/php/etc/php.ini</span><br></pre></td></tr></table></figure>

<p>如果是复制生产模式的配置文件，则命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/src/php-8.1.9/php.ini-production /usr/local/php/etc/php.ini</span><br></pre></td></tr></table></figure>

<p>修改 FPM 的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf</span><br><span class="line"><span class="built_in">cp</span> /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>

<p>接下来就是配置 PHP-FPM 服务并启动。</p>
<p>首先以下内容保存在 <code>/etc/systemd/system/php-fpm.service</code> 文件中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The PHP FastCGI Process Manager</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">PIDFile=/usr/local/php/var/run/php-fpm.pid</span><br><span class="line">ExecStart=/usr/local/php/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php/etc/php-fpm.conf</span><br><span class="line">ExecReload=/bin/kill -USR2 <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">PrivateTmp=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>这样就可以通过如下命令来控制 FPM：</p>
<ul>
<li>查看当前运行状态</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status php-fpm</span><br></pre></td></tr></table></figure>

<ul>
<li>启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start php-fpm</span><br></pre></td></tr></table></figure>

<ul>
<li>停止</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop php-fpm</span><br></pre></td></tr></table></figure>

<ul>
<li>重启</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart php-fpm</span><br></pre></td></tr></table></figure>

<ul>
<li>重载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload php-fpm</span><br></pre></td></tr></table></figure>

<h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxf nginx-1.23.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.23.1</span><br><span class="line">./configure --user=www --group=www --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-http_gzip_static_module --with-http_sub_module --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-pcre --with-pcre-jit</span><br><span class="line">make &amp;&amp; make install </span><br><span class="line"><span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure>

<h2 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h2><p>首先以下内容保存在 <code>/etc/systemd/system/nginx.service</code> 文件中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The NGINX HTTP and reverse proxy server</span><br><span class="line">After=network.target remote-fs.target nss-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/usr/local/nginx/logs/nginx.pid</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/bin/kill -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">PrivateTmp=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>这样就可以通过如下命令来控制 FPM：</p>
<ul>
<li>查看当前运行状态</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>停止</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>重启</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>

<ul>
<li>重载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure>

<p>安装完成后，编译形成的配置文件，都在 <code>nginx.conf</code> 里，会显得杂乱与臃肿，扩展起来也不方便，所以这里我建议对其进行分拆。</p>
<h2 id="Nginx-分拆"><a href="#Nginx-分拆" class="headerlink" title="Nginx 分拆"></a>Nginx 分拆</h2><p>主要是将 <code>http</code> 中的每个 <code>server</code> 都作为一个单独文件进行保存。</p>
<p>修改如下，首先是 <code>nginx.conf</code> 的修改：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注意这里 `server` 已经移动到其他的文件，后面会进行介绍</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">include</span> vhost/<span class="regexp">*.conf</span>; <span class="comment"># 注意添加了这行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对拆分出来的 <code>server</code> 保存到 <code>/usr/local/nginx/conf/vhost/default.conf</code> 中。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">       <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">       <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">       <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">       <span class="section">location</span> / &#123;</span><br><span class="line">           <span class="attribute">root</span>   html;</span><br><span class="line">           <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">       <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">           <span class="attribute">root</span>   html;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">       <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">       <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">       <span class="comment">#    root           html;</span></span><br><span class="line">       <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">       <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">       <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">       <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">       <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">       <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">       <span class="comment">#    deny  all;</span></span><br><span class="line">       <span class="comment">#&#125;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置-Nginx-与-PHP-FPM-进行网络通信"><a href="#配置-Nginx-与-PHP-FPM-进行网络通信" class="headerlink" title="配置 Nginx 与 PHP-FPM 进行网络通信"></a>配置 Nginx 与 PHP-FPM 进行网络通信</h2><p>这里需要指定项目地址。我已经默认访问的目录地址是 <code>/home/www/default</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u www <span class="built_in">mkdir</span> /home/www/default</span><br></pre></td></tr></table></figure>

<p>然后再里面填充以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;&lt;?php\nphpinfo();&quot;</span> | sudo -u www <span class="built_in">tee</span> /home/www/default/index.php</span><br></pre></td></tr></table></figure>

<p>这里还是要进行修改 <code>/usr/local/nginx/conf/vhost/default.conf</code>。修改后的内容如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">       <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">       <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">       <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">       <span class="attribute">root</span>   /home/www/default; <span class="comment"># 这里设置访问的目录</span></span><br><span class="line">       <span class="attribute">index</span>  index.html index.php; <span class="comment"># 这里设置默认入口文件</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">       <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">           <span class="attribute">root</span>   html;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">       <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">       <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">       <span class="comment"># 这里这一段都开发</span></span><br><span class="line">       <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">           <span class="attribute">fastcgi_pass</span>   <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">           <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">           <span class="attribute">fastcgi_param</span>  SCRIPT_FILENAME  <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>; <span class="comment"># 这里注意替换 $document_root</span></span><br><span class="line">           <span class="attribute">include</span>        fastcgi_params;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">       <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">       <span class="comment">#    deny  all;</span></span><br><span class="line">       <span class="comment">#&#125;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>修改完成之后，先执行 Nginx 配置检测命令，如果没有错误就执行重新加载配置文件的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -t <span class="comment"># 配置检测命令</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s reload <span class="comment"># 动态加载配置命令</span></span><br></pre></td></tr></table></figure>

<p>在访问的时候你就会发现，如果你使用非本机操作（例如虚拟机），则会出现访问无响应的情况，这是因为 Rocky 更换了防火墙工具，所以需要使用下列命令进行放开端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>如果不出问题，访问 <a target="_blank" rel="noopener" href="http://localhost/">http://localhost</a> 就可以看到经典的 <code>phpinfo</code> 相关信息了。</p>
<p>如果有任何问题，可以联系我。</p>
<h2 id="安装-MySQL"><a href="#安装-MySQL" class="headerlink" title="安装 MySQL"></a>安装 MySQL</h2><p>MySQL 5.7.5 之后版本都要安装 <code>boost</code> 包。这里选择的是已自带 <code>boost</code> 安装包的 MySQL 安装包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf mysql-boost-8.0.30.tar.gz</span><br><span class="line"><span class="built_in">mkdir</span> mysql-8.0.30/build</span><br><span class="line"><span class="built_in">cd</span> mysql-8.0.30/build</span><br><span class="line">cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DSYSCONFDIR=/etc -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_PARTITION_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DEXTRA_CHARSETS=all -DDEFAULT_CHARSET=utf8mb4 -DDEFAULT_COLLATION=utf8mb4_general_ci -DWITH_EMBEDDED_SERVER=1 -DENABLED_LOCAL_INFILE=1 -DWITH_BOOST=/usr/local/src -DDOWNLOAD_BOOST=1</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /usr/local/mysql <span class="comment">#对mysql目录进行赋予权限</span></span><br><span class="line"><span class="built_in">cd</span> ../../</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在国内下载 <code>bootst</code> 通常都会失败，比如说看我这里的安装错误日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- Downloading boost_1_77_0.tar.bz2 to /usr/local/src</span><br><span class="line">-- [download 0% complete]</span><br><span class="line">-- [download 1% complete]</span><br><span class="line">-- [download 2% complete]</span><br><span class="line">-- Download failed, error: 28;<span class="string">&quot;Timeout was reached&quot;</span></span><br><span class="line">CMake Error at cmake/boost.cmake:226 (MESSAGE):</span><br><span class="line">  You can try downloading</span><br><span class="line">  https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2</span><br><span class="line">  manually using curl/wget or a similar tool, or increase the value of</span><br><span class="line">  DOWNLOAD_BOOST_TIMEOUT (<span class="built_in">which</span> is now 600 seconds)</span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  CMakeLists.txt:1543 (INCLUDE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also <span class="string">&quot;/usr/local/src/mysql-8.0.30/build/CMakeFiles/CMakeOutput.log&quot;</span>.</span><br><span class="line">See also <span class="string">&quot;/usr/local/src/mysql-8.0.30/build/CMakeFiles/CMakeError.log&quot;</span>.</span><br></pre></td></tr></table></figure>

<p>可以看到这里已经提示了下载地址。那么可以通过开启 VPN 下载完成后，就可以通过 FTP 软件或者 <code>scp</code> 命令将其同步到指定位置。这里就提供一个 <code>scp</code> 同步命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp D:\迅雷下载\boost_1_77_0.tar.bz2 root@192.168.1.8:/usr/local/src</span><br></pre></td></tr></table></figure>
</blockquote>
<p>MySQL <code>configure</code> 安装参数解释：</p>
<table>
<thead>
<tr>
<th align="center">配置项</th>
<th align="center">值</th>
<th align="center">注释</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>-DCMAKE_INSTALL_PREFIX</code></td>
<td align="center"><code>/usr/local/mysql</code></td>
<td align="center">指定安装路径</td>
</tr>
<tr>
<td align="center"><code>-DSYSCONFDIR</code></td>
<td align="center"><code>/etc</code></td>
<td align="center">默认 <code>my.cnf</code> 选项文件的目录</td>
</tr>
<tr>
<td align="center"><code>-DWITH_MYISAM_STORAGE_ENGINE</code></td>
<td align="center"><code>1</code></td>
<td align="center">开启 <code>MyISAM</code> 存储引擎</td>
</tr>
<tr>
<td align="center"><code>DWITH_INNOBASE_STORAGE_ENGINE</code></td>
<td align="center"><code>1</code></td>
<td align="center">开启 <code>innobase</code> 存储引擎</td>
</tr>
<tr>
<td align="center"><code>DWITH_PARTITION_STORAGE_ENGINE</code></td>
<td align="center"><code>1</code></td>
<td align="center">开启分区存储引擎</td>
</tr>
<tr>
<td align="center"><code>DWITH_FEDERATED_STORAGE_ENGINE</code></td>
<td align="center"><code>1</code></td>
<td align="center">开启 <code>Federated</code> 存储引擎</td>
</tr>
<tr>
<td align="center"><code>DEXTRA_CHARSETS</code></td>
<td align="center"><code>all</code></td>
<td align="center">安装所有扩展字符集</td>
</tr>
<tr>
<td align="center"><code>DDEFAULT_CHARSET</code></td>
<td align="center"><code>utf8mb4</code></td>
<td align="center">设置字符集</td>
</tr>
<tr>
<td align="center"><code>DDEFAULT_COLLATION</code></td>
<td align="center"><code>utf8mb4_general_ci</code></td>
<td align="center">设置字符排序规则</td>
</tr>
<tr>
<td align="center"><code>DWITH_EMBEDDED_SERVER</code></td>
<td align="center"><code>1</code></td>
<td align="center">是否构建 <code>libmysqld</code> 嵌入式服务器库</td>
</tr>
<tr>
<td align="center"><code>DENABLED_LOCAL_INFILE</code></td>
<td align="center"><code>1</code></td>
<td align="center">是否允许使用 <code>LOAD DATA LOCAL INFILE</code> 命令导入存放于客户端的数据文件</td>
</tr>
<tr>
<td align="center"><code>DWITH_BOOST</code></td>
<td align="center"><code>/usr/local/src</code></td>
<td align="center">设置下载 <code>boost</code> 要存放的位置。可以提前使用其它方式下载该文件，然后安装程序就会直接使用，而不会再次下载</td>
</tr>
<tr>
<td align="center"><code>DDOWNLOAD_BOOST</code></td>
<td align="center"><code>1</code></td>
<td align="center">是否要下载 <code>boost</code>。</td>
</tr>
</tbody></table>
<h2 id="MySQL-配置"><a href="#MySQL-配置" class="headerlink" title="MySQL 配置"></a>MySQL 配置</h2><p>创建 MySQL 配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf&lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[client]</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">socket=/tmp/mysql.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">socket=/tmp/mysql.sock</span></span><br><span class="line"><span class="string">key_buffer_size=16M</span></span><br><span class="line"><span class="string">max_allowed_packet=128M</span></span><br><span class="line"><span class="string">pid-file=/usr/local/mysql/var/mysqld.pid</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysqldump]</span></span><br><span class="line"><span class="string">quick</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>更改数据库相关目录权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R mysql:mysql /usr/local/mysql</span><br></pre></td></tr></table></figure>

<p>对数据库进行初始化：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysqld --initialize --user=mysql</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行初始化命令时，如果日志提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2022-08-13T13:04:11.920018Z 0 [ERROR] [MY-010457] [Server] --initialize specified but the data directory has files <span class="keyword">in</span> it. Aborting.</span><br><span class="line">2022-08-13T13:04:11.920038Z 0 [ERROR] [MY-013236] [Server] The designated data directory /usr/local/mysql/var/ is unusable. You can remove all files that the server added to it.</span><br></pre></td></tr></table></figure>

<p>原因是存在空目录 <code>/usr/local/mysql/var/lib/mysqlrouter/</code>，原因暂时未知。可以使用如下方式解决：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/local/mysql/var/*</span><br></pre></td></tr></table></figure>
</blockquote>
<p>执行完成后注意看最后一条日志信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2022-08-13T15:39:52.858029Z 6 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: r?u3kx1jr+!E</span><br></pre></td></tr></table></figure>

<p>这里已经出现了生成的密码。</p>
<p>接下来就是配置 MySQL 服务并启动。</p>
<ul>
<li><code>mysql_safe</code> 服务管理</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/local/mysql/support-files/mysql.server</span></span><br><span class="line">Usage: mysql.server  &#123;start|stop|restart|reload|force-reload|status&#125;  [ MySQL server options ]</span><br></pre></td></tr></table></figure>

<ul>
<li>Systemctl 服务管理</li>
</ul>
<p>首先以下内容保存在 <code>/etc/systemd/system/mysql.service</code> 文件中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=MySQL Community Server</span><br><span class="line">After=network.target syslog.target</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Have mysqld write its state to the systemd notify socket</span></span><br><span class="line">Type=notify</span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable service start and stop timeout logic of systemd for mysqld service.</span></span><br><span class="line">TimeoutSec=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start main service</span></span><br><span class="line">ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf <span class="variable">$MYSQLD_OPTS</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Use this to switch malloc implementation</span></span><br><span class="line">EnvironmentFile=-/etc/sysconfig/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets open_files_limit</span></span><br><span class="line">LimitNOFILE = 10000</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">RestartPreventExitStatus=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set environment variable MYSQLD_PARENT_PID. This is required for restart.</span></span><br><span class="line">Environment=MYSQLD_PARENT_PID=1</span><br><span class="line"></span><br><span class="line">PrivateTmp=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>这样就可以通过如下命令来控制 MySQL：</p>
<ul>
<li>查看当前运行状态</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>启动</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>停止</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>重启</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysql</span><br></pre></td></tr></table></figure>

<ul>
<li>重载</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload mysql</span><br></pre></td></tr></table></figure>

<h2 id="修改数据库密码"><a href="#修改数据库密码" class="headerlink" title="修改数据库密码"></a>修改数据库密码</h2><p>在创建数据库时生成的密码实际上已经标记为过期。需要先登录数据库修改密码。</p>
<p>首先使用 <code>mysql</code> 命令登录账户：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/mysql/bin/mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>然后执行以下 SQL 命令修改密码（这里我图省事，就设置为 <code>root</code>）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>其实在生产环境，最好使用随机密码，该 SQL 会生成随机密码设置后并返回明文密码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SET</span> PASSWORD <span class="keyword">TO</span> RANDOM;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+----------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">user</span> <span class="operator">|</span> host      <span class="operator">|</span> generated password   <span class="operator">|</span> auth_factor <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+----------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> root <span class="operator">|</span> localhost <span class="operator">|</span> nOS5<span class="operator">+</span>yD:zoPQBXp,mN<span class="operator">+</span><span class="operator">+</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+----------------------+-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h2 id="PHP-测试连接-MySQL"><a href="#PHP-测试连接-MySQL" class="headerlink" title="PHP 测试连接 MySQL"></a>PHP 测试连接 MySQL</h2><p>编辑 PHP 脚本，测试是否能否正常连上 MySQL：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pdo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&quot;mysql:host=127.0.0.1;dbname=sys;port=3306&quot;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;nOS5+yD:zoPQBXp,mN++&#x27;</span>, <span class="keyword">array</span>(PDO::<span class="variable constant_">MYSQL_ATTR_INIT_COMMAND</span> =&gt; <span class="string">&#x27;set names utf8mb4&#x27;</span>, PDO::<span class="variable constant_">ATTR_TIMEOUT</span> =&gt; <span class="number">1</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$pdo</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果没有任何错误。那就表示 PHP 能够正常连接 MySQL。</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>如果不是为了更新这篇文章，打死我也不想编译环境了。太麻烦了。强烈推荐使用第三方别人预编译的包进行安装使用。</p>
<p>后续我也会对相关内容进行更新。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://lnmp.org/">LNMP.org 一键安装包</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9293ff079ab0">php依赖 libzip依赖 libzip.so.5: cannot open shared object file</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/mysql-secure-deployment-guide/8.0/en/secure-deployment-post-install.html#secure-deployment-startup-options">Chapter 5 Post Installation Setup</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/set-password.html">13.7.1.10 SET PASSWORD Statement</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备13027795号-1 </a>
  </div>

<div class="copyright">
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">魔王卷子</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
